(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])
return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports;}
__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0);})
([function(module,exports,__webpack_require__){"use strict";__webpack_require__(1);var _=__webpack_require__(2);var messageAction=__webpack_require__(5);var errorModalView=__webpack_require__(11);messageAction.onMODAL(function(msg){return errorModalView.show(msg);});var EditorContainerView=__webpack_require__(51);var FiletreeView=__webpack_require__(55);var Filetree=__webpack_require__(17);var menuView=__webpack_require__(58);var usersModel=__webpack_require__(20);var UserlistView=__webpack_require__(33);var MessagesView=__webpack_require__(26);var PanelView=__webpack_require__(52);var buffer=__webpack_require__(13);var editorAction=__webpack_require__(14);var handlerAction=__webpack_require__(15);var panel=__webpack_require__(50);var flux=__webpack_require__(7);var menu=__webpack_require__(60);var perms=__webpack_require__(22);var editorModels=__webpack_require__(16);var Terminals=__webpack_require__(32).Terminals;var BreadCrumbs=__webpack_require__(61);var FlooHandler=__webpack_require__(18);var prefs=__webpack_require__(10);var editorRoutes=__webpack_require__(62);var theme=__webpack_require__(63);var mugshot=__webpack_require__(28);var addFiles=__webpack_require__(64);var editorSettings=__webpack_require__(66);var editPermissions=__webpack_require__(67);var Theme=__webpack_require__(63);var solicit=__webpack_require__(41);var WorkerActions=__webpack_require__(68);var WebRTC=__webpack_require__(29);var webrtcActions=__webpack_require__(24);$(function web_editor(){flux.settings.debug=fl.editor_settings.debug;flux.settings.namespace=fl.editor_settings.path;var bufs=new buffer.Buffers();var editors=new editorModels.Editor([],bufs);editors.createEditor();var users=new usersModel.Users();var terminals=new Terminals([],{users:users});var me=new usersModel.User();var filetree=new Filetree();addFiles.init(fl.editor_settings.repo_info);editorSettings.init();editPermissions.init(fl.editor_settings.room_owner,fl.editor_settings.room,me);if(!(prefs.theme in Theme.theme)){prefs.theme="lowlight_customized";}
$(document.body).addClass("theme-"+prefs.theme);function mugHandler(){mugshot.stop();if(perms.indexOf("datamsg")<0){return;}
if(prefs.mugshots&&!prefs.dnd){mugshot.start(me.getMyConnection());}else{mugshot.cancelSnapshot();}}
WorkerActions.onMESSAGE(function(m){var data=m.data;switch(data.name){case"error":console.error(JSON.stringify(data.data));return;default:console.log(m);}});perms.on(mugHandler);prefs.on("dnd",mugHandler);prefs.on("mugshots",mugHandler);editorAction.set(bufs,terminals,prefs);handlerAction.setBuffers(bufs);var handler=new FlooHandler(fl.editor_settings,users,me,bufs,filetree,terminals);var webrtc=new WebRTC(users,me);console.debug("WebRTC:",webrtc);var panelHeight=$(window).outerHeight()-$("#editor-top-bar").outerHeight();var leftPanels=new panel.Panels({size:panelHeight,id:"leftPanels",items:[{headerClass:"sidebar-header sidebar-header-top",id:"FiletreeView",component:FiletreeView,props:{tree:filetree,name:fl.editor_settings.room,terminals:terminals}}]});leftPanels.load();var rightPanels=new panel.Panels({id:"rightPanels",size:panelHeight,items:[{headerClass:"sidebar-header sidebar-header-top",id:"UserlistView",component:UserlistView.UserlistView,props:{users:users,me:me,prefs:prefs}}]});rightPanels.load();var centerPanel=new panel.Panels({id:"centerPanel",size:panelHeight,items:[{id:"EditorView",component:EditorContainerView,props:{bufs:bufs,editors:editors},minSize:100},{headerClass:"sidebar-header",id:"MessagesView",defaultSize:145,minSize:5,component:MessagesView,props:{messages:messageAction.messages,users:users,focus:false}}]});centerPanel.load();var hPanels=new panel.Panels({size:$(window).width(),id:"hPanels",items:[{id:"leftPanels",component:PanelView.PanelViewVertical,props:{panels:leftPanels},defaultSize:225,minSize:5},{id:"centerPanels",component:PanelView.PanelViewVertical,props:{panels:centerPanel},minSize:262},{id:"rightPanels",component:PanelView.PanelViewVertical,props:{panels:rightPanels},defaultSize:228,minSize:5,grid:228}]},true);hPanels.load();var solicitation=new solicit.Model();solicitation.set({path:fl.editor_settings.path});var items=[{id:"hPanels",component:PanelView.PanelViewHorizontal,props:{panels:hPanels,size:panelHeight},size:panelHeight}];if(document.getElementById("go-pro-button")){items.push({id:"interactive",component:solicit.View,props:{solicitation:solicitation,users:users,me:me},size:0});}
var vPanels=new panel.Panels({size:panelHeight,id:"vPanels",items:items});vPanels.load();if(vPanels.items.get("interactive")){vPanels.items.get("interactive").size=0.001;}
React.render(React.createElement(PanelView.PanelViewHorizontal,{panels:vPanels}),document.getElementById("hPanels"));var FileMenu=new menu.Menu({name:"File",items:[{name:"Add files",icon:"upload",action:editorAction.upload},{name:"New File",icon:"plus",action:editorAction.new_file_prompt},{name:"Download",icon:"download",action:editorAction.download},{name:"Rename",icon:"pencil",action:editorAction.rename_prompt}]});var CollabMenu=new menu.Menu({name:"Collaborate",items:[{name:"Follow changes",icon:"magnet",action:editorAction.follow,pref:"following",selected:prefs.following},{name:"Summon",icon:"bullhorn",action:editorAction.summon,perm:"highlight"},{name:"Request Permission to Edit",icon:"comment",action:editorAction.request_perms,perm:"request_perms"},{name:"Workspace permissions",icon:"flag",action:handlerAction.edit_permissions,perm:"patch"},{name:"Open in Google Hangout",icon:"facetime-video",action:handlerAction.hangout,perm:"patch"},{name:"Start Screen Sharing",icon:"picture",action:webrtcActions.start_screen,perm:"patch"}]});var ThemeMenu=new menu.Menu({name:"Theme",items:_.map(theme.theme,function(name,id){return{name:name,action:editorAction.pref.bind(editorAction,"theme",id),theme:id,selected:prefs.theme===id};})});var SettingsMenu=new menu.Menu({name:"Settings",items:[{name:"Mugshots",icon:"user",action:function action(){editorAction.pref("mugshots",!prefs.mugshots);},pref:"mugshots",selected:prefs.mugshots},{name:"Notifications",icon:"bell",action:function action(){editorAction.pref("showNotifications",!prefs.showNotifications);messageAction.notify("Browser notifications "+(prefs.showNotifications?"enabled":"disabled"),true);},pref:"showNotifications",selected:prefs.showNotifications},{name:"Sound effects",icon:"volume-up",action:function action(){editorAction.pref("sound",!prefs.sound);},pref:"sound",selected:prefs.sound},{name:"Do not Disturb",icon:"ban-circle",action:function action(){editorAction.pref("dnd",!prefs.dnd);},pref:"dnd",selected:prefs.dnd},{name:"Reset UI",icon:"repeat",action:editorAction.reset_ui},{name:"Audio Only",icon:"eye-close",action:function action(){var audioOnly=!prefs.audioOnly;if(prefs.mugshots&&audioOnly){editorAction.pref("mugshots",false);}
editorAction.pref("audioOnly",audioOnly);},pref:"audioOnly",selected:prefs.audioOnly},{name:"Editor Settings",icon:"cog",action:editorAction.editor_settings}]});var ViewMenu=new menu.Menu({name:"View",items:[{name:"Split Vertical",icon:"resize-vertical",action:function action(){editorAction.split_editor("vertical");}},{name:"Split Horizontal",icon:"resize-horizontal",action:function action(){editorAction.split_editor("horizontal");}},{name:"Clear Splits",icon:"resize-small",action:function action(){editorAction.unsplit_editor();}}]});var HelpMenu=new menu.Menu({name:"Help",items:[{name:"WebRTC",icon:"facetime-video",href:"/help/webrtc"},{name:"FlooTTY",icon:"console",href:"/help/flootty"},{name:"Plugins",icon:"edit",href:"/help/plugins"}]});var menuBar=new menu.MenuBar([FileMenu,CollabMenu,ThemeMenu,SettingsMenu,ViewMenu,HelpMenu]);React.render(React.createElement(BreadCrumbs,null),document.getElementById("buf_path"));React.render(React.createElement(menuView.MenuBarView,{menubar:menuBar}),document.getElementById("floobits-menu"));var solicitationButton=document.getElementById("go-pro-button");if(solicitationButton){React.render(React.createElement(solicit.Button,{solicitation:solicitation}),solicitationButton);}
editorRoutes.initRoutes(fl.editor_settings.room_owner,fl.editor_settings.room);handler.go(fl.editor_settings.room_owner,fl.editor_settings.room,fl.editor_settings.path,fl.editor_settings.new_workspace);});},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var flio=__webpack_require__(4);var gl=self;var nativeConsole=console;var ignoredErrors=[];var FlErrors={};if(!console){gl.console={};}
_.each(["log","info","debug","error","table","trace","warn"],function(f){if(!_.isFunction(console[f])){console[f]=function(){};}});function sendToServer(level,subject,message){console.log("sending to server",level,subject,message);if(_.indexOf(ignoredErrors,subject)!==-1){console.log("Ignoring error.",subject);return;}
if(!self.window){self.postMessage({name:"error",data:{subject:subject,message:message}});return;}
$.ajax({type:"POST",url:flio.apiURL("log"),data:JSON.stringify({subject:subject,message:message}),success:function success(){},error:function error(xhr){if(xhr.status===400){console.log("Ignored error",xhr.responseJSON);ignoredErrors.push(subject);}},dataType:"json",contentType:"application/json"});}
function Log(){try{this.logLevel_=fl.editor_settings.logLevel;}catch(e){this.logLevel_=Log.Level.ERROR;console.log("Setting log level to error because of no editor_settings.logLevel.",e);}
try{this.traceLogs_=!!fl.editor_settings.traceLogs;}catch(e){this.traceLogs_=false;console.log("Disabling trace logging because of no editor_settings.traceLogs.",e);}
this.namespace_=null;}
Log.prototype.logLevel=function(){return this.logLevel_;};Log.prototype.setLogLevel=function(level){this.logLevel_=level;};Log.prototype.namespace=function(){return this.namespace_;};Log.prototype.setNamespace=function(namespace){this.namespace_=namespace;};Log.prototype.traceLogs=function(){return this.traceLogs_;};Log.prototype.setTraceLogs=function(traceLogs){this.traceLogs_=traceLogs;};Log.prototype.log_=function(logLevel,args){if(logLevel>this.logLevel()){return;}
if(this.traceLogs_){nativeConsole.log("tracing",this.traceLogs_);this.trace();}
args=_.toArray(args);if(this.namespace_){args.unshift(this.namespace_);}
switch(logLevel){case Log.Level.INFO:nativeConsole.info.apply(nativeConsole,args);break;case Log.Level.LOG:nativeConsole.log.apply(nativeConsole,args);break;case Log.Level.DIR:nativeConsole.dir.apply(nativeConsole,args);break;case Log.Level.ERROR:nativeConsole.error.apply(nativeConsole,args);break;case Log.Level.DEBUG:nativeConsole.debug.apply(nativeConsole,args);break;default:break;}};Log.prototype.table=function(){if(this.logLevel_>=Log.Level.LOG){nativeConsole.table.apply(nativeConsole,arguments);}};Log.prototype.trace=function(){if(this.logLevel_>=Log.Level.LOG){nativeConsole.trace.apply(nativeConsole,arguments);}};Log.prototype.log=function(){this.log_(Log.Level.LOG,arguments);};Log.prototype.dir=function(){this.log_(Log.Level.DIR,arguments);};Log.prototype.info=function(){this.log_(Log.Level.INFO,arguments);};Log.prototype.error=function(){this.log_(Log.Level.ERROR,arguments);};Log.prototype.debug=function(){this.log_(Log.Level.DEBUG,arguments);};Log.prototype.warn=function(){this.log_(Log.Level.INFO,arguments);};Log.prototype.sError=function(subject,message){sendToServer("ERROR",subject,message);};Log.prototype.triggerErrorOnPurpose=function(){_.defer(function(){gl.scream();});};Log.prototype.testIgnoredError=function(){_.defer(function(){throw new Error("Ignored terror test");});};Log.Level={ERROR:0,INFO:1,DIR:2,LOG:2,DEBUG:3};var flog=new Log();flog.ignoredErrors=ignoredErrors;gl.console=flog;function FlError(description,path,line,column,error){this.description=description||"";this.path=path||"";this.line=line||0;this.column=column||0;this.stack=error?error.stack:"";this.id=this.toString();this.ignored=false;this.occurrences=1;this.location=self.location.href;this.lastSent=0;this.sendingAt=0;if(line===0){this.ignored=true;}
if(path===""){this.ignored=true;}
this.traceLogs_=false;}
FlError.prototype.toJSON=function(){return{column:this.column,description:this.description,ignored:this.ignored,lastSent:this.lastSent,line:this.line,location:this.location,occurrences:this.occurrences,path:this.path,sendingAt:this.sendingAt,stack:this.stack};};FlError.prototype.scheduleSend=function(){var _this=this;var second,minute,hour,sendingAt,lastSent,now,delay;second=1000;minute=second*60;hour=minute*60;delay=hour;now=new Date().getTime();sendingAt=this.sendingAt;console.log("sendingAt?",sendingAt,this.id);if(sendingAt){return;}
console.log("scheduling sends");_.delay(function(){console.log("sending in a second");_this.send_();},second);lastSent=this.lastSent;sendingAt=now;sendingAt+=now-lastSent;if(sendingAt>now+delay){sendingAt=now+delay;}
this.sendingAt=sendingAt;_.delay(function(){console.log("sending from scheduleSend");_this.send_();_this.occurrences=0;_this.sendingAt=0;_this.lastSent=lastSent;},sendingAt-now);};FlError.prototype.send_=function(){if(!this.occurrences){return;}
flog.sError("JavaScript FlError: "+this.id,this.toJSON());};FlError.prototype.toString=function(){return[this.description,this.path,this.line.toString(),this.column.toString(),this.stack.toString()].join(" ");};module.exports={setNamespace:flog.setNamespace.bind(flog)};self.onerror=function handleError(description,path,line,column,opt_error){var error,id;if(!line){return;}
if(!path){return;}
error=new FlError(description,path,line,column,opt_error);id=error.toString();if(id in FlErrors){error=FlErrors[id];}else{FlErrors[id]=error;}
error.occurrences++;error.scheduleSend();};self.flog=flog;},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;(function(module,global){;(function(){var undefined;var VERSION='4.6.1';var LARGE_ARRAY_SIZE=200;var FUNC_ERROR_TEXT='Expected a function';var HASH_UNDEFINED='__lodash_hash_undefined__';var PLACEHOLDER='__lodash_placeholder__';var BIND_FLAG=1,BIND_KEY_FLAG=2,CURRY_BOUND_FLAG=4,CURRY_FLAG=8,CURRY_RIGHT_FLAG=16,PARTIAL_FLAG=32,PARTIAL_RIGHT_FLAG=64,ARY_FLAG=128,REARG_FLAG=256,FLIP_FLAG=512;var UNORDERED_COMPARE_FLAG=1,PARTIAL_COMPARE_FLAG=2;var DEFAULT_TRUNC_LENGTH=30,DEFAULT_TRUNC_OMISSION='...';var HOT_COUNT=150,HOT_SPAN=16;var LAZY_FILTER_FLAG=1,LAZY_MAP_FLAG=2,LAZY_WHILE_FLAG=3;var INFINITY=1/0,MAX_SAFE_INTEGER=9007199254740991,MAX_INTEGER=1.7976931348623157e+308,NAN=0/0;var MAX_ARRAY_LENGTH=4294967295,MAX_ARRAY_INDEX=MAX_ARRAY_LENGTH-1,HALF_MAX_ARRAY_LENGTH=MAX_ARRAY_LENGTH>>>1;var argsTag='[object Arguments]',arrayTag='[object Array]',boolTag='[object Boolean]',dateTag='[object Date]',errorTag='[object Error]',funcTag='[object Function]',genTag='[object GeneratorFunction]',mapTag='[object Map]',numberTag='[object Number]',objectTag='[object Object]',regexpTag='[object RegExp]',setTag='[object Set]',stringTag='[object String]',symbolTag='[object Symbol]',weakMapTag='[object WeakMap]',weakSetTag='[object WeakSet]';var arrayBufferTag='[object ArrayBuffer]',float32Tag='[object Float32Array]',float64Tag='[object Float64Array]',int8Tag='[object Int8Array]',int16Tag='[object Int16Array]',int32Tag='[object Int32Array]',uint8Tag='[object Uint8Array]',uint8ClampedTag='[object Uint8ClampedArray]',uint16Tag='[object Uint16Array]',uint32Tag='[object Uint32Array]';var reEmptyStringLeading=/\b__p \+= '';/g,reEmptyStringMiddle=/\b(__p \+=) '' \+/g,reEmptyStringTrailing=/(__e\(.*?\)|\b__t\)) \+\n'';/g;var reEscapedHtml=/&(?:amp|lt|gt|quot|#39|#96);/g,reUnescapedHtml=/[&<>"'`]/g,reHasEscapedHtml=RegExp(reEscapedHtml.source),reHasUnescapedHtml=RegExp(reUnescapedHtml.source);var reEscape=/<%-([\s\S]+?)%>/g,reEvaluate=/<%([\s\S]+?)%>/g,reInterpolate=/<%=([\s\S]+?)%>/g;var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]/g;var reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reHasRegExpChar=RegExp(reRegExpChar.source);var reTrim=/^\s+|\s+$/g,reTrimStart=/^\s+/,reTrimEnd=/\s+$/;var reEscapeChar=/\\(\\)?/g;var reEsTemplate=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g;var reFlags=/\w*$/;var reHasHexPrefix=/^0x/i;var reIsBadHex=/^[-+]0x[0-9a-f]+$/i;var reIsBinary=/^0b[01]+$/i;var reIsHostCtor=/^\[object .+?Constructor\]$/;var reIsOctal=/^0o[0-7]+$/i;var reIsUint=/^(?:0|[1-9]\d*)$/;var reLatin1=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g;var reNoMatch=/($^)/;var reUnescapedString=/['\n\r\u2028\u2029\\]/g;var rsAstralRange='\\ud800-\\udfff',rsComboMarksRange='\\u0300-\\u036f\\ufe20-\\ufe23',rsComboSymbolsRange='\\u20d0-\\u20f0',rsDingbatRange='\\u2700-\\u27bf',rsLowerRange='a-z\\xdf-\\xf6\\xf8-\\xff',rsMathOpRange='\\xac\\xb1\\xd7\\xf7',rsNonCharRange='\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf',rsQuoteRange='\\u2018\\u2019\\u201c\\u201d',rsSpaceRange=' \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000',rsUpperRange='A-Z\\xc0-\\xd6\\xd8-\\xde',rsVarRange='\\ufe0e\\ufe0f',rsBreakRange=rsMathOpRange+rsNonCharRange+rsQuoteRange+rsSpaceRange;var rsAstral='['+rsAstralRange+']',rsBreak='['+rsBreakRange+']',rsCombo='['+rsComboMarksRange+rsComboSymbolsRange+']',rsDigits='\\d+',rsDingbat='['+rsDingbatRange+']',rsLower='['+rsLowerRange+']',rsMisc='[^'+rsAstralRange+rsBreakRange+rsDigits+rsDingbatRange+rsLowerRange+rsUpperRange+']',rsFitz='\\ud83c[\\udffb-\\udfff]',rsModifier='(?:'+rsCombo+'|'+rsFitz+')',rsNonAstral='[^'+rsAstralRange+']',rsRegional='(?:\\ud83c[\\udde6-\\uddff]){2}',rsSurrPair='[\\ud800-\\udbff][\\udc00-\\udfff]',rsUpper='['+rsUpperRange+']',rsZWJ='\\u200d';var rsLowerMisc='(?:'+rsLower+'|'+rsMisc+')',rsUpperMisc='(?:'+rsUpper+'|'+rsMisc+')',reOptMod=rsModifier+'?',rsOptVar='['+rsVarRange+']?',rsOptJoin='(?:'+rsZWJ+'(?:'+[rsNonAstral,rsRegional,rsSurrPair].join('|')+')'+rsOptVar+reOptMod+')*',rsSeq=rsOptVar+reOptMod+rsOptJoin,rsEmoji='(?:'+[rsDingbat,rsRegional,rsSurrPair].join('|')+')'+rsSeq,rsSymbol='(?:'+[rsNonAstral+rsCombo+'?',rsCombo,rsRegional,rsSurrPair,rsAstral].join('|')+')';var reComboMark=RegExp(rsCombo,'g');var reComplexSymbol=RegExp(rsFitz+'(?='+rsFitz+')|'+rsSymbol+rsSeq,'g');var reHasComplexSymbol=RegExp('['+rsZWJ+rsAstralRange+rsComboMarksRange+rsComboSymbolsRange+rsVarRange+']');var reBasicWord=/[a-zA-Z0-9]+/g;var reComplexWord=RegExp([rsUpper+'?'+rsLower+'+(?='+[rsBreak,rsUpper,'$'].join('|')+')',rsUpperMisc+'+(?='+[rsBreak,rsUpper+rsLowerMisc,'$'].join('|')+')',rsUpper+'?'+rsLowerMisc+'+',rsUpper+'+',rsDigits,rsEmoji].join('|'),'g');var reHasComplexWord=/[a-z][A-Z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var contextProps=['Array','Buffer','Date','Error','Float32Array','Float64Array','Function','Int8Array','Int16Array','Int32Array','Map','Math','Object','Reflect','RegExp','Set','String','Symbol','TypeError','Uint8Array','Uint8ClampedArray','Uint16Array','Uint32Array','WeakMap','_','clearTimeout','isFinite','parseInt','setTimeout'];var templateCounter=-1;var typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=true;typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=false;var cloneableTags={};cloneableTags[argsTag]=cloneableTags[arrayTag]=cloneableTags[arrayBufferTag]=cloneableTags[boolTag]=cloneableTags[dateTag]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[mapTag]=cloneableTags[numberTag]=cloneableTags[objectTag]=cloneableTags[regexpTag]=cloneableTags[setTag]=cloneableTags[stringTag]=cloneableTags[symbolTag]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=true;cloneableTags[errorTag]=cloneableTags[funcTag]=cloneableTags[weakMapTag]=false;var deburredLetters={'\xc0':'A','\xc1':'A','\xc2':'A','\xc3':'A','\xc4':'A','\xc5':'A','\xe0':'a','\xe1':'a','\xe2':'a','\xe3':'a','\xe4':'a','\xe5':'a','\xc7':'C','\xe7':'c','\xd0':'D','\xf0':'d','\xc8':'E','\xc9':'E','\xca':'E','\xcb':'E','\xe8':'e','\xe9':'e','\xea':'e','\xeb':'e','\xcC':'I','\xcd':'I','\xce':'I','\xcf':'I','\xeC':'i','\xed':'i','\xee':'i','\xef':'i','\xd1':'N','\xf1':'n','\xd2':'O','\xd3':'O','\xd4':'O','\xd5':'O','\xd6':'O','\xd8':'O','\xf2':'o','\xf3':'o','\xf4':'o','\xf5':'o','\xf6':'o','\xf8':'o','\xd9':'U','\xda':'U','\xdb':'U','\xdc':'U','\xf9':'u','\xfa':'u','\xfb':'u','\xfc':'u','\xdd':'Y','\xfd':'y','\xff':'y','\xc6':'Ae','\xe6':'ae','\xde':'Th','\xfe':'th','\xdf':'ss'};var htmlEscapes={'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','`':'&#96;'};var htmlUnescapes={'&amp;':'&','&lt;':'<','&gt;':'>','&quot;':'"','&#39;':"'",'&#96;':'`'};var objectTypes={'function':true,'object':true};var stringEscapes={'\\':'\\',"'":"'",'\n':'n','\r':'r','\u2028':'u2028','\u2029':'u2029'};var freeParseFloat=parseFloat,freeParseInt=parseInt;var freeExports=(objectTypes[typeof exports]&&exports&&!exports.nodeType)?exports:undefined;var freeModule=(objectTypes[typeof module]&&module&&!module.nodeType)?module:undefined;var moduleExports=(freeModule&&freeModule.exports===freeExports)?freeExports:undefined;var freeGlobal=checkGlobal(freeExports&&freeModule&&typeof global=='object'&&global);var freeSelf=checkGlobal(objectTypes[typeof self]&&self);var freeWindow=checkGlobal(objectTypes[typeof window]&&window);var thisGlobal=checkGlobal(objectTypes[typeof this]&&this);var root=freeGlobal||((freeWindow!==(thisGlobal&&thisGlobal.window))&&freeWindow)||freeSelf||thisGlobal||Function('return this')();function addMapEntry(map,pair){map.set(pair[0],pair[1]);return map;}
function addSetEntry(set,value){set.add(value);return set;}
function apply(func,thisArg,args){var length=args.length;switch(length){case 0:return func.call(thisArg);case 1:return func.call(thisArg,args[0]);case 2:return func.call(thisArg,args[0],args[1]);case 3:return func.call(thisArg,args[0],args[1],args[2]);}
return func.apply(thisArg,args);}
function arrayAggregator(array,setter,iteratee,accumulator){var index=-1,length=array.length;while(++index<length){var value=array[index];setter(accumulator,value,iteratee(value),array);}
return accumulator;}
function arrayConcat(array,other){var index=-1,length=array.length,othIndex=-1,othLength=other.length,result=Array(length+othLength);while(++index<length){result[index]=array[index];}
while(++othIndex<othLength){result[index++]=other[othIndex];}
return result;}
function arrayEach(array,iteratee){var index=-1,length=array.length;while(++index<length){if(iteratee(array[index],index,array)===false){break;}}
return array;}
function arrayEachRight(array,iteratee){var length=array.length;while(length--){if(iteratee(array[length],length,array)===false){break;}}
return array;}
function arrayEvery(array,predicate){var index=-1,length=array.length;while(++index<length){if(!predicate(array[index],index,array)){return false;}}
return true;}
function arrayFilter(array,predicate){var index=-1,length=array.length,resIndex=0,result=[];while(++index<length){var value=array[index];if(predicate(value,index,array)){result[resIndex++]=value;}}
return result;}
function arrayIncludes(array,value){return!!array.length&&baseIndexOf(array,value,0)>-1;}
function arrayIncludesWith(array,value,comparator){var index=-1,length=array.length;while(++index<length){if(comparator(value,array[index])){return true;}}
return false;}
function arrayMap(array,iteratee){var index=-1,length=array.length,result=Array(length);while(++index<length){result[index]=iteratee(array[index],index,array);}
return result;}
function arrayPush(array,values){var index=-1,length=values.length,offset=array.length;while(++index<length){array[offset+index]=values[index];}
return array;}
function arrayReduce(array,iteratee,accumulator,initAccum){var index=-1,length=array.length;if(initAccum&&length){accumulator=array[++index];}
while(++index<length){accumulator=iteratee(accumulator,array[index],index,array);}
return accumulator;}
function arrayReduceRight(array,iteratee,accumulator,initAccum){var length=array.length;if(initAccum&&length){accumulator=array[--length];}
while(length--){accumulator=iteratee(accumulator,array[length],length,array);}
return accumulator;}
function arraySome(array,predicate){var index=-1,length=array.length;while(++index<length){if(predicate(array[index],index,array)){return true;}}
return false;}
function baseExtremum(array,iteratee,comparator){var index=-1,length=array.length;while(++index<length){var value=array[index],current=iteratee(value);if(current!=null&&(computed===undefined?current===current:comparator(current,computed))){var computed=current,result=value;}}
return result;}
function baseFind(collection,predicate,eachFunc,retKey){var result;eachFunc(collection,function(value,key,collection){if(predicate(value,key,collection)){result=retKey?key:value;return false;}});return result;}
function baseFindIndex(array,predicate,fromRight){var length=array.length,index=fromRight?length:-1;while((fromRight?index--:++index<length)){if(predicate(array[index],index,array)){return index;}}
return-1;}
function baseIndexOf(array,value,fromIndex){if(value!==value){return indexOfNaN(array,fromIndex);}
var index=fromIndex-1,length=array.length;while(++index<length){if(array[index]===value){return index;}}
return-1;}
function baseIndexOfWith(array,value,fromIndex,comparator){var index=fromIndex-1,length=array.length;while(++index<length){if(comparator(array[index],value)){return index;}}
return-1;}
function baseReduce(collection,iteratee,accumulator,initAccum,eachFunc){eachFunc(collection,function(value,index,collection){accumulator=initAccum?(initAccum=false,value):iteratee(accumulator,value,index,collection);});return accumulator;}
function baseSortBy(array,comparer){var length=array.length;array.sort(comparer);while(length--){array[length]=array[length].value;}
return array;}
function baseSum(array,iteratee){var result,index=-1,length=array.length;while(++index<length){var current=iteratee(array[index]);if(current!==undefined){result=result===undefined?current:(result+current);}}
return result;}
function baseTimes(n,iteratee){var index=-1,result=Array(n);while(++index<n){result[index]=iteratee(index);}
return result;}
function baseToPairs(object,props){return arrayMap(props,function(key){return[key,object[key]];});}
function baseUnary(func){return function(value){return func(value);};}
function baseValues(object,props){return arrayMap(props,function(key){return object[key];});}
function charsStartIndex(strSymbols,chrSymbols){var index=-1,length=strSymbols.length;while(++index<length&&baseIndexOf(chrSymbols,strSymbols[index],0)>-1){}
return index;}
function charsEndIndex(strSymbols,chrSymbols){var index=strSymbols.length;while(index--&&baseIndexOf(chrSymbols,strSymbols[index],0)>-1){}
return index;}
function checkGlobal(value){return(value&&value.Object===Object)?value:null;}
function compareAscending(value,other){if(value!==other){var valIsNull=value===null,valIsUndef=value===undefined,valIsReflexive=value===value;var othIsNull=other===null,othIsUndef=other===undefined,othIsReflexive=other===other;if((value>other&&!othIsNull)||!valIsReflexive||(valIsNull&&!othIsUndef&&othIsReflexive)||(valIsUndef&&othIsReflexive)){return 1;}
if((value<other&&!valIsNull)||!othIsReflexive||(othIsNull&&!valIsUndef&&valIsReflexive)||(othIsUndef&&valIsReflexive)){return-1;}}
return 0;}
function compareMultiple(object,other,orders){var index=-1,objCriteria=object.criteria,othCriteria=other.criteria,length=objCriteria.length,ordersLength=orders.length;while(++index<length){var result=compareAscending(objCriteria[index],othCriteria[index]);if(result){if(index>=ordersLength){return result;}
var order=orders[index];return result*(order=='desc'?-1:1);}}
return object.index-other.index;}
function countHolders(array,placeholder){var length=array.length,result=0;while(length--){if(array[length]===placeholder){result++;}}
return result;}
function deburrLetter(letter){return deburredLetters[letter];}
function escapeHtmlChar(chr){return htmlEscapes[chr];}
function escapeStringChar(chr){return'\\'+stringEscapes[chr];}
function indexOfNaN(array,fromIndex,fromRight){var length=array.length,index=fromIndex+(fromRight?0:-1);while((fromRight?index--:++index<length)){var other=array[index];if(other!==other){return index;}}
return-1;}
function isHostObject(value){var result=false;if(value!=null&&typeof value.toString!='function'){try{result=!!(value+'');}catch(e){}}
return result;}
function isIndex(value,length){value=(typeof value=='number'||reIsUint.test(value))?+value:-1;length=length==null?MAX_SAFE_INTEGER:length;return value>-1&&value%1==0&&value<length;}
function iteratorToArray(iterator){var data,result=[];while(!(data=iterator.next()).done){result.push(data.value);}
return result;}
function mapToArray(map){var index=-1,result=Array(map.size);map.forEach(function(value,key){result[++index]=[key,value];});return result;}
function replaceHolders(array,placeholder){var index=-1,length=array.length,resIndex=0,result=[];while(++index<length){var value=array[index];if(value===placeholder||value===PLACEHOLDER){array[index]=PLACEHOLDER;result[resIndex++]=index;}}
return result;}
function setToArray(set){var index=-1,result=Array(set.size);set.forEach(function(value){result[++index]=value;});return result;}
function stringSize(string){if(!(string&&reHasComplexSymbol.test(string))){return string.length;}
var result=reComplexSymbol.lastIndex=0;while(reComplexSymbol.test(string)){result++;}
return result;}
function stringToArray(string){return string.match(reComplexSymbol);}
function unescapeHtmlChar(chr){return htmlUnescapes[chr];}
function runInContext(context){context=context?_.defaults({},context,_.pick(root,contextProps)):root;var Date=context.Date,Error=context.Error,Math=context.Math,RegExp=context.RegExp,TypeError=context.TypeError;var arrayProto=context.Array.prototype,objectProto=context.Object.prototype;var funcToString=context.Function.prototype.toString;var hasOwnProperty=objectProto.hasOwnProperty;var idCounter=0;var objectCtorString=funcToString.call(Object);var objectToString=objectProto.toString;var oldDash=root._;var reIsNative=RegExp('^'+
funcToString.call(hasOwnProperty).replace(reRegExpChar,'\\$&').replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,'$1.*?')+'$');var Buffer=moduleExports?context.Buffer:undefined,Reflect=context.Reflect,Symbol=context.Symbol,Uint8Array=context.Uint8Array,clearTimeout=context.clearTimeout,enumerate=Reflect?Reflect.enumerate:undefined,getPrototypeOf=Object.getPrototypeOf,getOwnPropertySymbols=Object.getOwnPropertySymbols,iteratorSymbol=typeof(iteratorSymbol=Symbol&&Symbol.iterator)=='symbol'?iteratorSymbol:undefined,objectCreate=Object.create,propertyIsEnumerable=objectProto.propertyIsEnumerable,setTimeout=context.setTimeout,splice=arrayProto.splice;var nativeCeil=Math.ceil,nativeFloor=Math.floor,nativeIsFinite=context.isFinite,nativeJoin=arrayProto.join,nativeKeys=Object.keys,nativeMax=Math.max,nativeMin=Math.min,nativeParseInt=context.parseInt,nativeRandom=Math.random,nativeReverse=arrayProto.reverse;var Map=getNative(context,'Map'),Set=getNative(context,'Set'),WeakMap=getNative(context,'WeakMap'),nativeCreate=getNative(Object,'create');var metaMap=WeakMap&&new WeakMap;var nonEnumShadows=!propertyIsEnumerable.call({'valueOf':1},'valueOf');var realNames={};var mapCtorString=Map?funcToString.call(Map):'',setCtorString=Set?funcToString.call(Set):'',weakMapCtorString=WeakMap?funcToString.call(WeakMap):'';var symbolProto=Symbol?Symbol.prototype:undefined,symbolValueOf=symbolProto?symbolProto.valueOf:undefined,symbolToString=symbolProto?symbolProto.toString:undefined;function lodash(value){if(isObjectLike(value)&&!isArray(value)&&!(value instanceof LazyWrapper)){if(value instanceof LodashWrapper){return value;}
if(hasOwnProperty.call(value,'__wrapped__')){return wrapperClone(value);}}
return new LodashWrapper(value);}
function baseLodash(){}
function LodashWrapper(value,chainAll){this.__wrapped__=value;this.__actions__=[];this.__chain__=!!chainAll;this.__index__=0;this.__values__=undefined;}
lodash.templateSettings={'escape':reEscape,'evaluate':reEvaluate,'interpolate':reInterpolate,'variable':'','imports':{'_':lodash}};function LazyWrapper(value){this.__wrapped__=value;this.__actions__=[];this.__dir__=1;this.__filtered__=false;this.__iteratees__=[];this.__takeCount__=MAX_ARRAY_LENGTH;this.__views__=[];}
function lazyClone(){var result=new LazyWrapper(this.__wrapped__);result.__actions__=copyArray(this.__actions__);result.__dir__=this.__dir__;result.__filtered__=this.__filtered__;result.__iteratees__=copyArray(this.__iteratees__);result.__takeCount__=this.__takeCount__;result.__views__=copyArray(this.__views__);return result;}
function lazyReverse(){if(this.__filtered__){var result=new LazyWrapper(this);result.__dir__=-1;result.__filtered__=true;}else{result=this.clone();result.__dir__*=-1;}
return result;}
function lazyValue(){var array=this.__wrapped__.value(),dir=this.__dir__,isArr=isArray(array),isRight=dir<0,arrLength=isArr?array.length:0,view=getView(0,arrLength,this.__views__),start=view.start,end=view.end,length=end-start,index=isRight?end:(start-1),iteratees=this.__iteratees__,iterLength=iteratees.length,resIndex=0,takeCount=nativeMin(length,this.__takeCount__);if(!isArr||arrLength<LARGE_ARRAY_SIZE||(arrLength==length&&takeCount==length)){return baseWrapperValue(array,this.__actions__);}
var result=[];outer:while(length--&&resIndex<takeCount){index+=dir;var iterIndex=-1,value=array[index];while(++iterIndex<iterLength){var data=iteratees[iterIndex],iteratee=data.iteratee,type=data.type,computed=iteratee(value);if(type==LAZY_MAP_FLAG){value=computed;}else if(!computed){if(type==LAZY_FILTER_FLAG){continue outer;}else{break outer;}}}
result[resIndex++]=value;}
return result;}
function Hash(){}
function hashDelete(hash,key){return hashHas(hash,key)&&delete hash[key];}
function hashGet(hash,key){if(nativeCreate){var result=hash[key];return result===HASH_UNDEFINED?undefined:result;}
return hasOwnProperty.call(hash,key)?hash[key]:undefined;}
function hashHas(hash,key){return nativeCreate?hash[key]!==undefined:hasOwnProperty.call(hash,key);}
function hashSet(hash,key,value){hash[key]=(nativeCreate&&value===undefined)?HASH_UNDEFINED:value;}
function MapCache(values){var index=-1,length=values?values.length:0;this.clear();while(++index<length){var entry=values[index];this.set(entry[0],entry[1]);}}
function mapClear(){this.__data__={'hash':new Hash,'map':Map?new Map:[],'string':new Hash};}
function mapDelete(key){var data=this.__data__;if(isKeyable(key)){return hashDelete(typeof key=='string'?data.string:data.hash,key);}
return Map?data.map['delete'](key):assocDelete(data.map,key);}
function mapGet(key){var data=this.__data__;if(isKeyable(key)){return hashGet(typeof key=='string'?data.string:data.hash,key);}
return Map?data.map.get(key):assocGet(data.map,key);}
function mapHas(key){var data=this.__data__;if(isKeyable(key)){return hashHas(typeof key=='string'?data.string:data.hash,key);}
return Map?data.map.has(key):assocHas(data.map,key);}
function mapSet(key,value){var data=this.__data__;if(isKeyable(key)){hashSet(typeof key=='string'?data.string:data.hash,key,value);}else if(Map){data.map.set(key,value);}else{assocSet(data.map,key,value);}
return this;}
function SetCache(values){var index=-1,length=values?values.length:0;this.__data__=new MapCache;while(++index<length){this.push(values[index]);}}
function cacheHas(cache,value){var map=cache.__data__;if(isKeyable(value)){var data=map.__data__,hash=typeof value=='string'?data.string:data.hash;return hash[value]===HASH_UNDEFINED;}
return map.has(value);}
function cachePush(value){var map=this.__data__;if(isKeyable(value)){var data=map.__data__,hash=typeof value=='string'?data.string:data.hash;hash[value]=HASH_UNDEFINED;}
else{map.set(value,HASH_UNDEFINED);}}
function Stack(values){var index=-1,length=values?values.length:0;this.clear();while(++index<length){var entry=values[index];this.set(entry[0],entry[1]);}}
function stackClear(){this.__data__={'array':[],'map':null};}
function stackDelete(key){var data=this.__data__,array=data.array;return array?assocDelete(array,key):data.map['delete'](key);}
function stackGet(key){var data=this.__data__,array=data.array;return array?assocGet(array,key):data.map.get(key);}
function stackHas(key){var data=this.__data__,array=data.array;return array?assocHas(array,key):data.map.has(key);}
function stackSet(key,value){var data=this.__data__,array=data.array;if(array){if(array.length<(LARGE_ARRAY_SIZE-1)){assocSet(array,key,value);}else{data.array=null;data.map=new MapCache(array);}}
var map=data.map;if(map){map.set(key,value);}
return this;}
function assocDelete(array,key){var index=assocIndexOf(array,key);if(index<0){return false;}
var lastIndex=array.length-1;if(index==lastIndex){array.pop();}else{splice.call(array,index,1);}
return true;}
function assocGet(array,key){var index=assocIndexOf(array,key);return index<0?undefined:array[index][1];}
function assocHas(array,key){return assocIndexOf(array,key)>-1;}
function assocIndexOf(array,key){var length=array.length;while(length--){if(eq(array[length][0],key)){return length;}}
return-1;}
function assocSet(array,key,value){var index=assocIndexOf(array,key);if(index<0){array.push([key,value]);}else{array[index][1]=value;}}
function assignInDefaults(objValue,srcValue,key,object){if(objValue===undefined||(eq(objValue,objectProto[key])&&!hasOwnProperty.call(object,key))){return srcValue;}
return objValue;}
function assignMergeValue(object,key,value){if((value!==undefined&&!eq(object[key],value))||(typeof key=='number'&&value===undefined&&!(key in object))){object[key]=value;}}
function assignValue(object,key,value){var objValue=object[key];if(!(hasOwnProperty.call(object,key)&&eq(objValue,value))||(value===undefined&&!(key in object))){object[key]=value;}}
function baseAggregator(collection,setter,iteratee,accumulator){baseEach(collection,function(value,key,collection){setter(accumulator,value,iteratee(value),collection);});return accumulator;}
function baseAssign(object,source){return object&&copyObject(source,keys(source),object);}
function baseAt(object,paths){var index=-1,isNil=object==null,length=paths.length,result=Array(length);while(++index<length){result[index]=isNil?undefined:get(object,paths[index]);}
return result;}
function baseCastArrayLikeObject(value){return isArrayLikeObject(value)?value:[];}
function baseCastFunction(value){return typeof value=='function'?value:identity;}
function baseCastPath(value){return isArray(value)?value:stringToPath(value);}
function baseClamp(number,lower,upper){if(number===number){if(upper!==undefined){number=number<=upper?number:upper;}
if(lower!==undefined){number=number>=lower?number:lower;}}
return number;}
function baseClone(value,isDeep,isFull,customizer,key,object,stack){var result;if(customizer){result=object?customizer(value,key,object,stack):customizer(value);}
if(result!==undefined){return result;}
if(!isObject(value)){return value;}
var isArr=isArray(value);if(isArr){result=initCloneArray(value);if(!isDeep){return copyArray(value,result);}}else{var tag=getTag(value),isFunc=tag==funcTag||tag==genTag;if(isBuffer(value)){return cloneBuffer(value,isDeep);}
if(tag==objectTag||tag==argsTag||(isFunc&&!object)){if(isHostObject(value)){return object?value:{};}
result=initCloneObject(isFunc?{}:value);if(!isDeep){result=baseAssign(result,value);return isFull?copySymbols(value,result):result;}}else{if(!cloneableTags[tag]){return object?value:{};}
result=initCloneByTag(value,tag,isDeep);}}
stack||(stack=new Stack);var stacked=stack.get(value);if(stacked){return stacked;}
stack.set(value,result);(isArr?arrayEach:baseForOwn)(value,function(subValue,key){assignValue(result,key,baseClone(subValue,isDeep,isFull,customizer,key,value,stack));});return(isFull&&!isArr)?copySymbols(value,result):result;}
function baseConforms(source){var props=keys(source),length=props.length;return function(object){if(object==null){return!length;}
var index=length;while(index--){var key=props[index],predicate=source[key],value=object[key];if((value===undefined&&!(key in Object(object)))||!predicate(value)){return false;}}
return true;};}
function baseCreate(proto){return isObject(proto)?objectCreate(proto):{};}
function baseDelay(func,wait,args){if(typeof func!='function'){throw new TypeError(FUNC_ERROR_TEXT);}
return setTimeout(function(){func.apply(undefined,args);},wait);}
function baseDifference(array,values,iteratee,comparator){var index=-1,includes=arrayIncludes,isCommon=true,length=array.length,result=[],valuesLength=values.length;if(!length){return result;}
if(iteratee){values=arrayMap(values,baseUnary(iteratee));}
if(comparator){includes=arrayIncludesWith;isCommon=false;}
else if(values.length>=LARGE_ARRAY_SIZE){includes=cacheHas;isCommon=false;values=new SetCache(values);}
outer:while(++index<length){var value=array[index],computed=iteratee?iteratee(value):value;if(isCommon&&computed===computed){var valuesIndex=valuesLength;while(valuesIndex--){if(values[valuesIndex]===computed){continue outer;}}
result.push(value);}
else if(!includes(values,computed,comparator)){result.push(value);}}
return result;}
var baseEach=createBaseEach(baseForOwn);var baseEachRight=createBaseEach(baseForOwnRight,true);function baseEvery(collection,predicate){var result=true;baseEach(collection,function(value,index,collection){result=!!predicate(value,index,collection);return result;});return result;}
function baseFill(array,value,start,end){var length=array.length;start=toInteger(start);if(start<0){start=-start>length?0:(length+start);}
end=(end===undefined||end>length)?length:toInteger(end);if(end<0){end+=length;}
end=start>end?0:toLength(end);while(start<end){array[start++]=value;}
return array;}
function baseFilter(collection,predicate){var result=[];baseEach(collection,function(value,index,collection){if(predicate(value,index,collection)){result.push(value);}});return result;}
function baseFlatten(array,depth,isStrict,result){result||(result=[]);var index=-1,length=array.length;while(++index<length){var value=array[index];if(depth>0&&isArrayLikeObject(value)&&(isStrict||isArray(value)||isArguments(value))){if(depth>1){baseFlatten(value,depth-1,isStrict,result);}else{arrayPush(result,value);}}else if(!isStrict){result[result.length]=value;}}
return result;}
var baseFor=createBaseFor();var baseForRight=createBaseFor(true);function baseForIn(object,iteratee){return object==null?object:baseFor(object,iteratee,keysIn);}
function baseForOwn(object,iteratee){return object&&baseFor(object,iteratee,keys);}
function baseForOwnRight(object,iteratee){return object&&baseForRight(object,iteratee,keys);}
function baseFunctions(object,props){return arrayFilter(props,function(key){return isFunction(object[key]);});}
function baseGet(object,path){path=isKey(path,object)?[path+'']:baseCastPath(path);var index=0,length=path.length;while(object!=null&&index<length){object=object[path[index++]];}
return(index&&index==length)?object:undefined;}
function baseHas(object,key){return hasOwnProperty.call(object,key)||(typeof object=='object'&&key in object&&getPrototypeOf(object)===null);}
function baseHasIn(object,key){return key in Object(object);}
function baseInRange(number,start,end){return number>=nativeMin(start,end)&&number<nativeMax(start,end);}
function baseIntersection(arrays,iteratee,comparator){var includes=comparator?arrayIncludesWith:arrayIncludes,length=arrays[0].length,othLength=arrays.length,othIndex=othLength,caches=Array(othLength),maxLength=Infinity,result=[];while(othIndex--){var array=arrays[othIndex];if(othIndex&&iteratee){array=arrayMap(array,baseUnary(iteratee));}
maxLength=nativeMin(array.length,maxLength);caches[othIndex]=!comparator&&(iteratee||(length>=120&&array.length>=120))?new SetCache(othIndex&&array):undefined;}
array=arrays[0];var index=-1,seen=caches[0];outer:while(++index<length&&result.length<maxLength){var value=array[index],computed=iteratee?iteratee(value):value;if(!(seen?cacheHas(seen,computed):includes(result,computed,comparator))){othIndex=othLength;while(--othIndex){var cache=caches[othIndex];if(!(cache?cacheHas(cache,computed):includes(arrays[othIndex],computed,comparator))){continue outer;}}
if(seen){seen.push(computed);}
result.push(value);}}
return result;}
function baseInverter(object,setter,iteratee,accumulator){baseForOwn(object,function(value,key,object){setter(accumulator,iteratee(value),key,object);});return accumulator;}
function baseInvoke(object,path,args){if(!isKey(path,object)){path=baseCastPath(path);object=parent(object,path);path=last(path);}
var func=object==null?object:object[path];return func==null?undefined:apply(func,object,args);}
function baseIsEqual(value,other,customizer,bitmask,stack){if(value===other){return true;}
if(value==null||other==null||(!isObject(value)&&!isObjectLike(other))){return value!==value&&other!==other;}
return baseIsEqualDeep(value,other,baseIsEqual,customizer,bitmask,stack);}
function baseIsEqualDeep(object,other,equalFunc,customizer,bitmask,stack){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=arrayTag,othTag=arrayTag;if(!objIsArr){objTag=getTag(object);objTag=objTag==argsTag?objectTag:objTag;}
if(!othIsArr){othTag=getTag(other);othTag=othTag==argsTag?objectTag:othTag;}
var objIsObj=objTag==objectTag&&!isHostObject(object),othIsObj=othTag==objectTag&&!isHostObject(other),isSameTag=objTag==othTag;if(isSameTag&&!objIsObj){stack||(stack=new Stack);return(objIsArr||isTypedArray(object))?equalArrays(object,other,equalFunc,customizer,bitmask,stack):equalByTag(object,other,objTag,equalFunc,customizer,bitmask,stack);}
if(!(bitmask&PARTIAL_COMPARE_FLAG)){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,'__wrapped__'),othIsWrapped=othIsObj&&hasOwnProperty.call(other,'__wrapped__');if(objIsWrapped||othIsWrapped){stack||(stack=new Stack);return equalFunc(objIsWrapped?object.value():object,othIsWrapped?other.value():other,customizer,bitmask,stack);}}
if(!isSameTag){return false;}
stack||(stack=new Stack);return equalObjects(object,other,equalFunc,customizer,bitmask,stack);}
function baseIsMatch(object,source,matchData,customizer){var index=matchData.length,length=index,noCustomizer=!customizer;if(object==null){return!length;}
object=Object(object);while(index--){var data=matchData[index];if((noCustomizer&&data[2])?data[1]!==object[data[0]]:!(data[0]in object)){return false;}}
while(++index<length){data=matchData[index];var key=data[0],objValue=object[key],srcValue=data[1];if(noCustomizer&&data[2]){if(objValue===undefined&&!(key in object)){return false;}}else{var stack=new Stack,result=customizer?customizer(objValue,srcValue,key,object,source,stack):undefined;if(!(result===undefined?baseIsEqual(srcValue,objValue,customizer,UNORDERED_COMPARE_FLAG|PARTIAL_COMPARE_FLAG,stack):result)){return false;}}}
return true;}
function baseIteratee(value){var type=typeof value;if(type=='function'){return value;}
if(value==null){return identity;}
if(type=='object'){return isArray(value)?baseMatchesProperty(value[0],value[1]):baseMatches(value);}
return property(value);}
function baseKeys(object){return nativeKeys(Object(object));}
function baseKeysIn(object){object=object==null?object:Object(object);var result=[];for(var key in object){result.push(key);}
return result;}
if(enumerate&&!propertyIsEnumerable.call({'valueOf':1},'valueOf')){baseKeysIn=function(object){return iteratorToArray(enumerate(object));};}
function baseMap(collection,iteratee){var index=-1,result=isArrayLike(collection)?Array(collection.length):[];baseEach(collection,function(value,key,collection){result[++index]=iteratee(value,key,collection);});return result;}
function baseMatches(source){var matchData=getMatchData(source);if(matchData.length==1&&matchData[0][2]){var key=matchData[0][0],value=matchData[0][1];return function(object){if(object==null){return false;}
return object[key]===value&&(value!==undefined||(key in Object(object)));};}
return function(object){return object===source||baseIsMatch(object,source,matchData);};}
function baseMatchesProperty(path,srcValue){return function(object){var objValue=get(object,path);return(objValue===undefined&&objValue===srcValue)?hasIn(object,path):baseIsEqual(srcValue,objValue,undefined,UNORDERED_COMPARE_FLAG|PARTIAL_COMPARE_FLAG);};}
function baseMerge(object,source,srcIndex,customizer,stack){if(object===source){return;}
var props=(isArray(source)||isTypedArray(source))?undefined:keysIn(source);arrayEach(props||source,function(srcValue,key){if(props){key=srcValue;srcValue=source[key];}
if(isObject(srcValue)){stack||(stack=new Stack);baseMergeDeep(object,source,key,srcIndex,baseMerge,customizer,stack);}
else{var newValue=customizer?customizer(object[key],srcValue,(key+''),object,source,stack):undefined;if(newValue===undefined){newValue=srcValue;}
assignMergeValue(object,key,newValue);}});}
function baseMergeDeep(object,source,key,srcIndex,mergeFunc,customizer,stack){var objValue=object[key],srcValue=source[key],stacked=stack.get(srcValue);if(stacked){assignMergeValue(object,key,stacked);return;}
var newValue=customizer?customizer(objValue,srcValue,(key+''),object,source,stack):undefined;var isCommon=newValue===undefined;if(isCommon){newValue=srcValue;if(isArray(srcValue)||isTypedArray(srcValue)){if(isArray(objValue)){newValue=objValue;}
else if(isArrayLikeObject(objValue)){newValue=copyArray(objValue);}
else{isCommon=false;newValue=baseClone(srcValue,!customizer);}}
else if(isPlainObject(srcValue)||isArguments(srcValue)){if(isArguments(objValue)){newValue=toPlainObject(objValue);}
else if(!isObject(objValue)||(srcIndex&&isFunction(objValue))){isCommon=false;newValue=baseClone(srcValue,!customizer);}
else{newValue=objValue;}}
else{isCommon=false;}}
stack.set(srcValue,newValue);if(isCommon){mergeFunc(newValue,srcValue,srcIndex,customizer,stack);}
stack['delete'](srcValue);assignMergeValue(object,key,newValue);}
function baseOrderBy(collection,iteratees,orders){var index=-1;iteratees=arrayMap(iteratees.length?iteratees:Array(1),getIteratee());var result=baseMap(collection,function(value,key,collection){var criteria=arrayMap(iteratees,function(iteratee){return iteratee(value);});return{'criteria':criteria,'index':++index,'value':value};});return baseSortBy(result,function(object,other){return compareMultiple(object,other,orders);});}
function basePick(object,props){object=Object(object);return arrayReduce(props,function(result,key){if(key in object){result[key]=object[key];}
return result;},{});}
function basePickBy(object,predicate){var result={};baseForIn(object,function(value,key){if(predicate(value,key)){result[key]=value;}});return result;}
function baseProperty(key){return function(object){return object==null?undefined:object[key];};}
function basePropertyDeep(path){return function(object){return baseGet(object,path);};}
function basePullAll(array,values,iteratee,comparator){var indexOf=comparator?baseIndexOfWith:baseIndexOf,index=-1,length=values.length,seen=array;if(iteratee){seen=arrayMap(array,baseUnary(iteratee));}
while(++index<length){var fromIndex=0,value=values[index],computed=iteratee?iteratee(value):value;while((fromIndex=indexOf(seen,computed,fromIndex,comparator))>-1){if(seen!==array){splice.call(seen,fromIndex,1);}
splice.call(array,fromIndex,1);}}
return array;}
function basePullAt(array,indexes){var length=array?indexes.length:0,lastIndex=length-1;while(length--){var index=indexes[length];if(lastIndex==length||index!=previous){var previous=index;if(isIndex(index)){splice.call(array,index,1);}
else if(!isKey(index,array)){var path=baseCastPath(index),object=parent(array,path);if(object!=null){delete object[last(path)];}}
else{delete array[index];}}}
return array;}
function baseRandom(lower,upper){return lower+nativeFloor(nativeRandom()*(upper-lower+1));}
function baseRange(start,end,step,fromRight){var index=-1,length=nativeMax(nativeCeil((end-start)/(step||1)),0),result=Array(length);while(length--){result[fromRight?length:++index]=start;start+=step;}
return result;}
function baseSet(object,path,value,customizer){path=isKey(path,object)?[path+'']:baseCastPath(path);var index=-1,length=path.length,lastIndex=length-1,nested=object;while(nested!=null&&++index<length){var key=path[index];if(isObject(nested)){var newValue=value;if(index!=lastIndex){var objValue=nested[key];newValue=customizer?customizer(objValue,key,nested):undefined;if(newValue===undefined){newValue=objValue==null?(isIndex(path[index+1])?[]:{}):objValue;}}
assignValue(nested,key,newValue);}
nested=nested[key];}
return object;}
var baseSetData=!metaMap?identity:function(func,data){metaMap.set(func,data);return func;};function baseSlice(array,start,end){var index=-1,length=array.length;if(start<0){start=-start>length?0:(length+start);}
end=end>length?length:end;if(end<0){end+=length;}
length=start>end?0:((end-start)>>>0);start>>>=0;var result=Array(length);while(++index<length){result[index]=array[index+start];}
return result;}
function baseSome(collection,predicate){var result;baseEach(collection,function(value,index,collection){result=predicate(value,index,collection);return!result;});return!!result;}
function baseSortedIndex(array,value,retHighest){var low=0,high=array?array.length:low;if(typeof value=='number'&&value===value&&high<=HALF_MAX_ARRAY_LENGTH){while(low<high){var mid=(low+high)>>>1,computed=array[mid];if((retHighest?(computed<=value):(computed<value))&&computed!==null){low=mid+1;}else{high=mid;}}
return high;}
return baseSortedIndexBy(array,value,identity,retHighest);}
function baseSortedIndexBy(array,value,iteratee,retHighest){value=iteratee(value);var low=0,high=array?array.length:0,valIsNaN=value!==value,valIsNull=value===null,valIsUndef=value===undefined;while(low<high){var mid=nativeFloor((low+high)/2),computed=iteratee(array[mid]),isDef=computed!==undefined,isReflexive=computed===computed;if(valIsNaN){var setLow=isReflexive||retHighest;}else if(valIsNull){setLow=isReflexive&&isDef&&(retHighest||computed!=null);}else if(valIsUndef){setLow=isReflexive&&(retHighest||isDef);}else if(computed==null){setLow=false;}else{setLow=retHighest?(computed<=value):(computed<value);}
if(setLow){low=mid+1;}else{high=mid;}}
return nativeMin(high,MAX_ARRAY_INDEX);}
function baseSortedUniq(array){return baseSortedUniqBy(array);}
function baseSortedUniqBy(array,iteratee){var index=0,length=array.length,value=array[0],computed=iteratee?iteratee(value):value,seen=computed,resIndex=1,result=[value];while(++index<length){value=array[index],computed=iteratee?iteratee(value):value;if(!eq(computed,seen)){seen=computed;result[resIndex++]=value;}}
return result;}
function baseUniq(array,iteratee,comparator){var index=-1,includes=arrayIncludes,length=array.length,isCommon=true,result=[],seen=result;if(comparator){isCommon=false;includes=arrayIncludesWith;}
else if(length>=LARGE_ARRAY_SIZE){var set=iteratee?null:createSet(array);if(set){return setToArray(set);}
isCommon=false;includes=cacheHas;seen=new SetCache;}
else{seen=iteratee?[]:result;}
outer:while(++index<length){var value=array[index],computed=iteratee?iteratee(value):value;if(isCommon&&computed===computed){var seenIndex=seen.length;while(seenIndex--){if(seen[seenIndex]===computed){continue outer;}}
if(iteratee){seen.push(computed);}
result.push(value);}
else if(!includes(seen,computed,comparator)){if(seen!==result){seen.push(computed);}
result.push(value);}}
return result;}
function baseUnset(object,path){path=isKey(path,object)?[path+'']:baseCastPath(path);object=parent(object,path);var key=last(path);return(object!=null&&has(object,key))?delete object[key]:true;}
function baseUpdate(object,path,updater,customizer){return baseSet(object,path,updater(baseGet(object,path)),customizer);}
function baseWhile(array,predicate,isDrop,fromRight){var length=array.length,index=fromRight?length:-1;while((fromRight?index--:++index<length)&&predicate(array[index],index,array)){}
return isDrop?baseSlice(array,(fromRight?0:index),(fromRight?index+1:length)):baseSlice(array,(fromRight?index+1:0),(fromRight?length:index));}
function baseWrapperValue(value,actions){var result=value;if(result instanceof LazyWrapper){result=result.value();}
return arrayReduce(actions,function(result,action){return action.func.apply(action.thisArg,arrayPush([result],action.args));},result);}
function baseXor(arrays,iteratee,comparator){var index=-1,length=arrays.length;while(++index<length){var result=result?arrayPush(baseDifference(result,arrays[index],iteratee,comparator),baseDifference(arrays[index],result,iteratee,comparator)):arrays[index];}
return(result&&result.length)?baseUniq(result,iteratee,comparator):[];}
function baseZipObject(props,values,assignFunc){var index=-1,length=props.length,valsLength=values.length,result={};while(++index<length){assignFunc(result,props[index],index<valsLength?values[index]:undefined);}
return result;}
function cloneBuffer(buffer,isDeep){if(isDeep){return buffer.slice();}
var result=new buffer.constructor(buffer.length);buffer.copy(result);return result;}
function cloneArrayBuffer(arrayBuffer){var result=new arrayBuffer.constructor(arrayBuffer.byteLength);new Uint8Array(result).set(new Uint8Array(arrayBuffer));return result;}
function cloneMap(map){return arrayReduce(mapToArray(map),addMapEntry,new map.constructor);}
function cloneRegExp(regexp){var result=new regexp.constructor(regexp.source,reFlags.exec(regexp));result.lastIndex=regexp.lastIndex;return result;}
function cloneSet(set){return arrayReduce(setToArray(set),addSetEntry,new set.constructor);}
function cloneSymbol(symbol){return symbolValueOf?Object(symbolValueOf.call(symbol)):{};}
function cloneTypedArray(typedArray,isDeep){var buffer=isDeep?cloneArrayBuffer(typedArray.buffer):typedArray.buffer;return new typedArray.constructor(buffer,typedArray.byteOffset,typedArray.length);}
function composeArgs(args,partials,holders,isCurried){var argsIndex=-1,argsLength=args.length,holdersLength=holders.length,leftIndex=-1,leftLength=partials.length,rangeLength=nativeMax(argsLength-holdersLength,0),result=Array(leftLength+rangeLength),isUncurried=!isCurried;while(++leftIndex<leftLength){result[leftIndex]=partials[leftIndex];}
while(++argsIndex<holdersLength){if(isUncurried||argsIndex<argsLength){result[holders[argsIndex]]=args[argsIndex];}}
while(rangeLength--){result[leftIndex++]=args[argsIndex++];}
return result;}
function composeArgsRight(args,partials,holders,isCurried){var argsIndex=-1,argsLength=args.length,holdersIndex=-1,holdersLength=holders.length,rightIndex=-1,rightLength=partials.length,rangeLength=nativeMax(argsLength-holdersLength,0),result=Array(rangeLength+rightLength),isUncurried=!isCurried;while(++argsIndex<rangeLength){result[argsIndex]=args[argsIndex];}
var offset=argsIndex;while(++rightIndex<rightLength){result[offset+rightIndex]=partials[rightIndex];}
while(++holdersIndex<holdersLength){if(isUncurried||argsIndex<argsLength){result[offset+holders[holdersIndex]]=args[argsIndex++];}}
return result;}
function copyArray(source,array){var index=-1,length=source.length;array||(array=Array(length));while(++index<length){array[index]=source[index];}
return array;}
function copyObject(source,props,object){return copyObjectWith(source,props,object);}
function copyObjectWith(source,props,object,customizer){object||(object={});var index=-1,length=props.length;while(++index<length){var key=props[index];var newValue=customizer?customizer(object[key],source[key],key,object,source):source[key];assignValue(object,key,newValue);}
return object;}
function copySymbols(source,object){return copyObject(source,getSymbols(source),object);}
function createAggregator(setter,initializer){return function(collection,iteratee){var func=isArray(collection)?arrayAggregator:baseAggregator,accumulator=initializer?initializer():{};return func(collection,setter,getIteratee(iteratee),accumulator);};}
function createAssigner(assigner){return rest(function(object,sources){var index=-1,length=sources.length,customizer=length>1?sources[length-1]:undefined,guard=length>2?sources[2]:undefined;customizer=typeof customizer=='function'?(length--,customizer):undefined;if(guard&&isIterateeCall(sources[0],sources[1],guard)){customizer=length<3?undefined:customizer;length=1;}
object=Object(object);while(++index<length){var source=sources[index];if(source){assigner(object,source,index,customizer);}}
return object;});}
function createBaseEach(eachFunc,fromRight){return function(collection,iteratee){if(collection==null){return collection;}
if(!isArrayLike(collection)){return eachFunc(collection,iteratee);}
var length=collection.length,index=fromRight?length:-1,iterable=Object(collection);while((fromRight?index--:++index<length)){if(iteratee(iterable[index],index,iterable)===false){break;}}
return collection;};}
function createBaseFor(fromRight){return function(object,iteratee,keysFunc){var index=-1,iterable=Object(object),props=keysFunc(object),length=props.length;while(length--){var key=props[fromRight?length:++index];if(iteratee(iterable[key],key,iterable)===false){break;}}
return object;};}
function createBaseWrapper(func,bitmask,thisArg){var isBind=bitmask&BIND_FLAG,Ctor=createCtorWrapper(func);function wrapper(){var fn=(this&&this!==root&&this instanceof wrapper)?Ctor:func;return fn.apply(isBind?thisArg:this,arguments);}
return wrapper;}
function createCaseFirst(methodName){return function(string){string=toString(string);var strSymbols=reHasComplexSymbol.test(string)?stringToArray(string):undefined;var chr=strSymbols?strSymbols[0]:string.charAt(0),trailing=strSymbols?strSymbols.slice(1).join(''):string.slice(1);return chr[methodName]()+trailing;};}
function createCompounder(callback){return function(string){return arrayReduce(words(deburr(string)),callback,'');};}
function createCtorWrapper(Ctor){return function(){var args=arguments;switch(args.length){case 0:return new Ctor;case 1:return new Ctor(args[0]);case 2:return new Ctor(args[0],args[1]);case 3:return new Ctor(args[0],args[1],args[2]);case 4:return new Ctor(args[0],args[1],args[2],args[3]);case 5:return new Ctor(args[0],args[1],args[2],args[3],args[4]);case 6:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5]);case 7:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5],args[6]);}
var thisBinding=baseCreate(Ctor.prototype),result=Ctor.apply(thisBinding,args);return isObject(result)?result:thisBinding;};}
function createCurryWrapper(func,bitmask,arity){var Ctor=createCtorWrapper(func);function wrapper(){var length=arguments.length,args=Array(length),index=length,placeholder=getPlaceholder(wrapper);while(index--){args[index]=arguments[index];}
var holders=(length<3&&args[0]!==placeholder&&args[length-1]!==placeholder)?[]:replaceHolders(args,placeholder);length-=holders.length;if(length<arity){return createRecurryWrapper(func,bitmask,createHybridWrapper,wrapper.placeholder,undefined,args,holders,undefined,undefined,arity-length);}
var fn=(this&&this!==root&&this instanceof wrapper)?Ctor:func;return apply(fn,this,args);}
return wrapper;}
function createFlow(fromRight){return rest(function(funcs){funcs=baseFlatten(funcs,1);var length=funcs.length,index=length,prereq=LodashWrapper.prototype.thru;if(fromRight){funcs.reverse();}
while(index--){var func=funcs[index];if(typeof func!='function'){throw new TypeError(FUNC_ERROR_TEXT);}
if(prereq&&!wrapper&&getFuncName(func)=='wrapper'){var wrapper=new LodashWrapper([],true);}}
index=wrapper?index:length;while(++index<length){func=funcs[index];var funcName=getFuncName(func),data=funcName=='wrapper'?getData(func):undefined;if(data&&isLaziable(data[0])&&data[1]==(ARY_FLAG|CURRY_FLAG|PARTIAL_FLAG|REARG_FLAG)&&!data[4].length&&data[9]==1){wrapper=wrapper[getFuncName(data[0])].apply(wrapper,data[3]);}else{wrapper=(func.length==1&&isLaziable(func))?wrapper[funcName]():wrapper.thru(func);}}
return function(){var args=arguments,value=args[0];if(wrapper&&args.length==1&&isArray(value)&&value.length>=LARGE_ARRAY_SIZE){return wrapper.plant(value).value();}
var index=0,result=length?funcs[index].apply(this,args):value;while(++index<length){result=funcs[index].call(this,result);}
return result;};});}
function createHybridWrapper(func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity){var isAry=bitmask&ARY_FLAG,isBind=bitmask&BIND_FLAG,isBindKey=bitmask&BIND_KEY_FLAG,isCurried=bitmask&(CURRY_FLAG|CURRY_RIGHT_FLAG),isFlip=bitmask&FLIP_FLAG,Ctor=isBindKey?undefined:createCtorWrapper(func);function wrapper(){var length=arguments.length,index=length,args=Array(length);while(index--){args[index]=arguments[index];}
if(isCurried){var placeholder=getPlaceholder(wrapper),holdersCount=countHolders(args,placeholder);}
if(partials){args=composeArgs(args,partials,holders,isCurried);}
if(partialsRight){args=composeArgsRight(args,partialsRight,holdersRight,isCurried);}
length-=holdersCount;if(isCurried&&length<arity){var newHolders=replaceHolders(args,placeholder);return createRecurryWrapper(func,bitmask,createHybridWrapper,wrapper.placeholder,thisArg,args,newHolders,argPos,ary,arity-length);}
var thisBinding=isBind?thisArg:this,fn=isBindKey?thisBinding[func]:func;length=args.length;if(argPos){args=reorder(args,argPos);}else if(isFlip&&length>1){args.reverse();}
if(isAry&&ary<length){args.length=ary;}
if(this&&this!==root&&this instanceof wrapper){fn=Ctor||createCtorWrapper(fn);}
return fn.apply(thisBinding,args);}
return wrapper;}
function createInverter(setter,toIteratee){return function(object,iteratee){return baseInverter(object,setter,toIteratee(iteratee),{});};}
function createOver(arrayFunc){return rest(function(iteratees){iteratees=arrayMap(baseFlatten(iteratees,1),getIteratee());return rest(function(args){var thisArg=this;return arrayFunc(iteratees,function(iteratee){return apply(iteratee,thisArg,args);});});});}
function createPadding(string,length,chars){length=toInteger(length);var strLength=stringSize(string);if(!length||strLength>=length){return'';}
var padLength=length-strLength;chars=chars===undefined?' ':(chars+'');var result=repeat(chars,nativeCeil(padLength/stringSize(chars)));return reHasComplexSymbol.test(chars)?stringToArray(result).slice(0,padLength).join(''):result.slice(0,padLength);}
function createPartialWrapper(func,bitmask,thisArg,partials){var isBind=bitmask&BIND_FLAG,Ctor=createCtorWrapper(func);function wrapper(){var argsIndex=-1,argsLength=arguments.length,leftIndex=-1,leftLength=partials.length,args=Array(leftLength+argsLength),fn=(this&&this!==root&&this instanceof wrapper)?Ctor:func;while(++leftIndex<leftLength){args[leftIndex]=partials[leftIndex];}
while(argsLength--){args[leftIndex++]=arguments[++argsIndex];}
return apply(fn,isBind?thisArg:this,args);}
return wrapper;}
function createRange(fromRight){return function(start,end,step){if(step&&typeof step!='number'&&isIterateeCall(start,end,step)){end=step=undefined;}
start=toNumber(start);start=start===start?start:0;if(end===undefined){end=start;start=0;}else{end=toNumber(end)||0;}
step=step===undefined?(start<end?1:-1):(toNumber(step)||0);return baseRange(start,end,step,fromRight);};}
function createRecurryWrapper(func,bitmask,wrapFunc,placeholder,thisArg,partials,holders,argPos,ary,arity){var isCurry=bitmask&CURRY_FLAG,newArgPos=argPos?copyArray(argPos):undefined,newHolders=isCurry?holders:undefined,newHoldersRight=isCurry?undefined:holders,newPartials=isCurry?partials:undefined,newPartialsRight=isCurry?undefined:partials;bitmask|=(isCurry?PARTIAL_FLAG:PARTIAL_RIGHT_FLAG);bitmask&=~(isCurry?PARTIAL_RIGHT_FLAG:PARTIAL_FLAG);if(!(bitmask&CURRY_BOUND_FLAG)){bitmask&=~(BIND_FLAG|BIND_KEY_FLAG);}
var newData=[func,bitmask,thisArg,newPartials,newHolders,newPartialsRight,newHoldersRight,newArgPos,ary,arity];var result=wrapFunc.apply(undefined,newData);if(isLaziable(func)){setData(result,newData);}
result.placeholder=placeholder;return result;}
function createRound(methodName){var func=Math[methodName];return function(number,precision){number=toNumber(number);precision=toInteger(precision);if(precision){var pair=(toString(number)+'e').split('e'),value=func(pair[0]+'e'+(+pair[1]+precision));pair=(toString(value)+'e').split('e');return+(pair[0]+'e'+(+pair[1]-precision));}
return func(number);};}
var createSet=!(Set&&new Set([1,2]).size===2)?noop:function(values){return new Set(values);};function createWrapper(func,bitmask,thisArg,partials,holders,argPos,ary,arity){var isBindKey=bitmask&BIND_KEY_FLAG;if(!isBindKey&&typeof func!='function'){throw new TypeError(FUNC_ERROR_TEXT);}
var length=partials?partials.length:0;if(!length){bitmask&=~(PARTIAL_FLAG|PARTIAL_RIGHT_FLAG);partials=holders=undefined;}
ary=ary===undefined?ary:nativeMax(toInteger(ary),0);arity=arity===undefined?arity:toInteger(arity);length-=holders?holders.length:0;if(bitmask&PARTIAL_RIGHT_FLAG){var partialsRight=partials,holdersRight=holders;partials=holders=undefined;}
var data=isBindKey?undefined:getData(func);var newData=[func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity];if(data){mergeData(newData,data);}
func=newData[0];bitmask=newData[1];thisArg=newData[2];partials=newData[3];holders=newData[4];arity=newData[9]=newData[9]==null?(isBindKey?0:func.length):nativeMax(newData[9]-length,0);if(!arity&&bitmask&(CURRY_FLAG|CURRY_RIGHT_FLAG)){bitmask&=~(CURRY_FLAG|CURRY_RIGHT_FLAG);}
if(!bitmask||bitmask==BIND_FLAG){var result=createBaseWrapper(func,bitmask,thisArg);}else if(bitmask==CURRY_FLAG||bitmask==CURRY_RIGHT_FLAG){result=createCurryWrapper(func,bitmask,arity);}else if((bitmask==PARTIAL_FLAG||bitmask==(BIND_FLAG|PARTIAL_FLAG))&&!holders.length){result=createPartialWrapper(func,bitmask,thisArg,partials);}else{result=createHybridWrapper.apply(undefined,newData);}
var setter=data?baseSetData:setData;return setter(result,newData);}
function equalArrays(array,other,equalFunc,customizer,bitmask,stack){var index=-1,isPartial=bitmask&PARTIAL_COMPARE_FLAG,isUnordered=bitmask&UNORDERED_COMPARE_FLAG,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isPartial&&othLength>arrLength)){return false;}
var stacked=stack.get(array);if(stacked){return stacked==other;}
var result=true;stack.set(array,other);while(++index<arrLength){var arrValue=array[index],othValue=other[index];if(customizer){var compared=isPartial?customizer(othValue,arrValue,index,other,array,stack):customizer(arrValue,othValue,index,array,other,stack);}
if(compared!==undefined){if(compared){continue;}
result=false;break;}
if(isUnordered){if(!arraySome(other,function(othValue){return arrValue===othValue||equalFunc(arrValue,othValue,customizer,bitmask,stack);})){result=false;break;}}else if(!(arrValue===othValue||equalFunc(arrValue,othValue,customizer,bitmask,stack))){result=false;break;}}
stack['delete'](array);return result;}
function equalByTag(object,other,tag,equalFunc,customizer,bitmask,stack){switch(tag){case arrayBufferTag:if((object.byteLength!=other.byteLength)||!equalFunc(new Uint8Array(object),new Uint8Array(other))){return false;}
return true;case boolTag:case dateTag:return+object==+other;case errorTag:return object.name==other.name&&object.message==other.message;case numberTag:return(object!=+object)?other!=+other:object==+other;case regexpTag:case stringTag:return object==(other+'');case mapTag:var convert=mapToArray;case setTag:var isPartial=bitmask&PARTIAL_COMPARE_FLAG;convert||(convert=setToArray);if(object.size!=other.size&&!isPartial){return false;}
var stacked=stack.get(object);if(stacked){return stacked==other;}
return equalArrays(convert(object),convert(other),equalFunc,customizer,bitmask|UNORDERED_COMPARE_FLAG,stack.set(object,other));case symbolTag:if(symbolValueOf){return symbolValueOf.call(object)==symbolValueOf.call(other);}}
return false;}
function equalObjects(object,other,equalFunc,customizer,bitmask,stack){var isPartial=bitmask&PARTIAL_COMPARE_FLAG,objProps=keys(object),objLength=objProps.length,othProps=keys(other),othLength=othProps.length;if(objLength!=othLength&&!isPartial){return false;}
var index=objLength;while(index--){var key=objProps[index];if(!(isPartial?key in other:baseHas(other,key))){return false;}}
var stacked=stack.get(object);if(stacked){return stacked==other;}
var result=true;stack.set(object,other);var skipCtor=isPartial;while(++index<objLength){key=objProps[index];var objValue=object[key],othValue=other[key];if(customizer){var compared=isPartial?customizer(othValue,objValue,key,other,object,stack):customizer(objValue,othValue,key,object,other,stack);}
if(!(compared===undefined?(objValue===othValue||equalFunc(objValue,othValue,customizer,bitmask,stack)):compared)){result=false;break;}
skipCtor||(skipCtor=key=='constructor');}
if(result&&!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;if(objCtor!=othCtor&&('constructor'in object&&'constructor'in other)&&!(typeof objCtor=='function'&&objCtor instanceof objCtor&&typeof othCtor=='function'&&othCtor instanceof othCtor)){result=false;}}
stack['delete'](object);return result;}
var getData=!metaMap?noop:function(func){return metaMap.get(func);};function getFuncName(func){var result=(func.name+''),array=realNames[result],length=hasOwnProperty.call(realNames,result)?array.length:0;while(length--){var data=array[length],otherFunc=data.func;if(otherFunc==null||otherFunc==func){return data.name;}}
return result;}
function getIteratee(){var result=lodash.iteratee||iteratee;result=result===iteratee?baseIteratee:result;return arguments.length?result(arguments[0],arguments[1]):result;}
var getLength=baseProperty('length');function getMatchData(object){var result=toPairs(object),length=result.length;while(length--){result[length][2]=isStrictComparable(result[length][1]);}
return result;}
function getNative(object,key){var value=object[key];return isNative(value)?value:undefined;}
function getPlaceholder(func){var object=hasOwnProperty.call(lodash,'placeholder')?lodash:func;return object.placeholder;}
var getSymbols=getOwnPropertySymbols||function(){return[];};function getTag(value){return objectToString.call(value);}
if((Map&&getTag(new Map)!=mapTag)||(Set&&getTag(new Set)!=setTag)||(WeakMap&&getTag(new WeakMap)!=weakMapTag)){getTag=function(value){var result=objectToString.call(value),Ctor=result==objectTag?value.constructor:null,ctorString=typeof Ctor=='function'?funcToString.call(Ctor):'';if(ctorString){switch(ctorString){case mapCtorString:return mapTag;case setCtorString:return setTag;case weakMapCtorString:return weakMapTag;}}
return result;};}
function getView(start,end,transforms){var index=-1,length=transforms.length;while(++index<length){var data=transforms[index],size=data.size;switch(data.type){case'drop':start+=size;break;case'dropRight':end-=size;break;case'take':end=nativeMin(end,start+size);break;case'takeRight':start=nativeMax(start,end-size);break;}}
return{'start':start,'end':end};}
function hasPath(object,path,hasFunc){if(object==null){return false;}
var result=hasFunc(object,path);if(!result&&!isKey(path)){path=baseCastPath(path);object=parent(object,path);if(object!=null){path=last(path);result=hasFunc(object,path);}}
var length=object?object.length:undefined;return result||(!!length&&isLength(length)&&isIndex(path,length)&&(isArray(object)||isString(object)||isArguments(object)));}
function initCloneArray(array){var length=array.length,result=array.constructor(length);if(length&&typeof array[0]=='string'&&hasOwnProperty.call(array,'index')){result.index=array.index;result.input=array.input;}
return result;}
function initCloneObject(object){return(typeof object.constructor=='function'&&!isPrototype(object))?baseCreate(getPrototypeOf(object)):{};}
function initCloneByTag(object,tag,isDeep){var Ctor=object.constructor;switch(tag){case arrayBufferTag:return cloneArrayBuffer(object);case boolTag:case dateTag:return new Ctor(+object);case float32Tag:case float64Tag:case int8Tag:case int16Tag:case int32Tag:case uint8Tag:case uint8ClampedTag:case uint16Tag:case uint32Tag:return cloneTypedArray(object,isDeep);case mapTag:return cloneMap(object);case numberTag:case stringTag:return new Ctor(object);case regexpTag:return cloneRegExp(object);case setTag:return cloneSet(object);case symbolTag:return cloneSymbol(object);}}
function indexKeys(object){var length=object?object.length:undefined;if(isLength(length)&&(isArray(object)||isString(object)||isArguments(object))){return baseTimes(length,String);}
return null;}
function isIterateeCall(value,index,object){if(!isObject(object)){return false;}
var type=typeof index;if(type=='number'?(isArrayLike(object)&&isIndex(index,object.length)):(type=='string'&&index in object)){return eq(object[index],value);}
return false;}
function isKey(value,object){if(typeof value=='number'){return true;}
return!isArray(value)&&(reIsPlainProp.test(value)||!reIsDeepProp.test(value)||(object!=null&&value in Object(object)));}
function isKeyable(value){var type=typeof value;return type=='number'||type=='boolean'||(type=='string'&&value!='__proto__')||value==null;}
function isLaziable(func){var funcName=getFuncName(func),other=lodash[funcName];if(typeof other!='function'||!(funcName in LazyWrapper.prototype)){return false;}
if(func===other){return true;}
var data=getData(other);return!!data&&func===data[0];}
function isPrototype(value){var Ctor=value&&value.constructor,proto=(typeof Ctor=='function'&&Ctor.prototype)||objectProto;return value===proto;}
function isStrictComparable(value){return value===value&&!isObject(value);}
function mergeData(data,source){var bitmask=data[1],srcBitmask=source[1],newBitmask=bitmask|srcBitmask,isCommon=newBitmask<(BIND_FLAG|BIND_KEY_FLAG|ARY_FLAG);var isCombo=((srcBitmask==ARY_FLAG)&&(bitmask==CURRY_FLAG))||((srcBitmask==ARY_FLAG)&&(bitmask==REARG_FLAG)&&(data[7].length<=source[8]))||((srcBitmask==(ARY_FLAG|REARG_FLAG))&&(source[7].length<=source[8])&&(bitmask==CURRY_FLAG));if(!(isCommon||isCombo)){return data;}
if(srcBitmask&BIND_FLAG){data[2]=source[2];newBitmask|=bitmask&BIND_FLAG?0:CURRY_BOUND_FLAG;}
var value=source[3];if(value){var partials=data[3];data[3]=partials?composeArgs(partials,value,source[4]):copyArray(value);data[4]=partials?replaceHolders(data[3],PLACEHOLDER):copyArray(source[4]);}
value=source[5];if(value){partials=data[5];data[5]=partials?composeArgsRight(partials,value,source[6]):copyArray(value);data[6]=partials?replaceHolders(data[5],PLACEHOLDER):copyArray(source[6]);}
value=source[7];if(value){data[7]=copyArray(value);}
if(srcBitmask&ARY_FLAG){data[8]=data[8]==null?source[8]:nativeMin(data[8],source[8]);}
if(data[9]==null){data[9]=source[9];}
data[0]=source[0];data[1]=newBitmask;return data;}
function mergeDefaults(objValue,srcValue,key,object,source,stack){if(isObject(objValue)&&isObject(srcValue)){baseMerge(objValue,srcValue,undefined,mergeDefaults,stack.set(srcValue,objValue));}
return objValue;}
function parent(object,path){return path.length==1?object:get(object,baseSlice(path,0,-1));}
function reorder(array,indexes){var arrLength=array.length,length=nativeMin(indexes.length,arrLength),oldArray=copyArray(array);while(length--){var index=indexes[length];array[length]=isIndex(index,arrLength)?oldArray[index]:undefined;}
return array;}
var setData=(function(){var count=0,lastCalled=0;return function(key,value){var stamp=now(),remaining=HOT_SPAN-(stamp-lastCalled);lastCalled=stamp;if(remaining>0){if(++count>=HOT_COUNT){return key;}}else{count=0;}
return baseSetData(key,value);};}());function stringToPath(string){var result=[];toString(string).replace(rePropName,function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,'$1'):(number||match));});return result;}
function wrapperClone(wrapper){if(wrapper instanceof LazyWrapper){return wrapper.clone();}
var result=new LodashWrapper(wrapper.__wrapped__,wrapper.__chain__);result.__actions__=copyArray(wrapper.__actions__);result.__index__=wrapper.__index__;result.__values__=wrapper.__values__;return result;}
function chunk(array,size){size=nativeMax(toInteger(size),0);var length=array?array.length:0;if(!length||size<1){return[];}
var index=0,resIndex=0,result=Array(nativeCeil(length/size));while(index<length){result[resIndex++]=baseSlice(array,index,(index+=size));}
return result;}
function compact(array){var index=-1,length=array?array.length:0,resIndex=0,result=[];while(++index<length){var value=array[index];if(value){result[resIndex++]=value;}}
return result;}
var concat=rest(function(array,values){if(!isArray(array)){array=array==null?[]:[Object(array)];}
values=baseFlatten(values,1);return arrayConcat(array,values);});var difference=rest(function(array,values){return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,true)):[];});var differenceBy=rest(function(array,values){var iteratee=last(values);if(isArrayLikeObject(iteratee)){iteratee=undefined;}
return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,true),getIteratee(iteratee)):[];});var differenceWith=rest(function(array,values){var comparator=last(values);if(isArrayLikeObject(comparator)){comparator=undefined;}
return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,true),undefined,comparator):[];});function drop(array,n,guard){var length=array?array.length:0;if(!length){return[];}
n=(guard||n===undefined)?1:toInteger(n);return baseSlice(array,n<0?0:n,length);}
function dropRight(array,n,guard){var length=array?array.length:0;if(!length){return[];}
n=(guard||n===undefined)?1:toInteger(n);n=length-n;return baseSlice(array,0,n<0?0:n);}
function dropRightWhile(array,predicate){return(array&&array.length)?baseWhile(array,getIteratee(predicate,3),true,true):[];}
function dropWhile(array,predicate){return(array&&array.length)?baseWhile(array,getIteratee(predicate,3),true):[];}
function fill(array,value,start,end){var length=array?array.length:0;if(!length){return[];}
if(start&&typeof start!='number'&&isIterateeCall(array,value,start)){start=0;end=length;}
return baseFill(array,value,start,end);}
function findIndex(array,predicate){return(array&&array.length)?baseFindIndex(array,getIteratee(predicate,3)):-1;}
function findLastIndex(array,predicate){return(array&&array.length)?baseFindIndex(array,getIteratee(predicate,3),true):-1;}
function flatten(array){var length=array?array.length:0;return length?baseFlatten(array,1):[];}
function flattenDeep(array){var length=array?array.length:0;return length?baseFlatten(array,INFINITY):[];}
function flattenDepth(array,depth){var length=array?array.length:0;if(!length){return[];}
depth=depth===undefined?1:toInteger(depth);return baseFlatten(array,depth);}
function fromPairs(pairs){var index=-1,length=pairs?pairs.length:0,result={};while(++index<length){var pair=pairs[index];result[pair[0]]=pair[1];}
return result;}
function head(array){return array?array[0]:undefined;}
function indexOf(array,value,fromIndex){var length=array?array.length:0;if(!length){return-1;}
fromIndex=toInteger(fromIndex);if(fromIndex<0){fromIndex=nativeMax(length+fromIndex,0);}
return baseIndexOf(array,value,fromIndex);}
function initial(array){return dropRight(array,1);}
var intersection=rest(function(arrays){var mapped=arrayMap(arrays,baseCastArrayLikeObject);return(mapped.length&&mapped[0]===arrays[0])?baseIntersection(mapped):[];});var intersectionBy=rest(function(arrays){var iteratee=last(arrays),mapped=arrayMap(arrays,baseCastArrayLikeObject);if(iteratee===last(mapped)){iteratee=undefined;}else{mapped.pop();}
return(mapped.length&&mapped[0]===arrays[0])?baseIntersection(mapped,getIteratee(iteratee)):[];});var intersectionWith=rest(function(arrays){var comparator=last(arrays),mapped=arrayMap(arrays,baseCastArrayLikeObject);if(comparator===last(mapped)){comparator=undefined;}else{mapped.pop();}
return(mapped.length&&mapped[0]===arrays[0])?baseIntersection(mapped,undefined,comparator):[];});function join(array,separator){return array?nativeJoin.call(array,separator):'';}
function last(array){var length=array?array.length:0;return length?array[length-1]:undefined;}
function lastIndexOf(array,value,fromIndex){var length=array?array.length:0;if(!length){return-1;}
var index=length;if(fromIndex!==undefined){index=toInteger(fromIndex);index=(index<0?nativeMax(length+index,0):nativeMin(index,length-1))+1;}
if(value!==value){return indexOfNaN(array,index,true);}
while(index--){if(array[index]===value){return index;}}
return-1;}
var pull=rest(pullAll);function pullAll(array,values){return(array&&array.length&&values&&values.length)?basePullAll(array,values):array;}
function pullAllBy(array,values,iteratee){return(array&&array.length&&values&&values.length)?basePullAll(array,values,getIteratee(iteratee)):array;}
function pullAllWith(array,values,comparator){return(array&&array.length&&values&&values.length)?basePullAll(array,values,undefined,comparator):array;}
var pullAt=rest(function(array,indexes){indexes=arrayMap(baseFlatten(indexes,1),String);var result=baseAt(array,indexes);basePullAt(array,indexes.sort(compareAscending));return result;});function remove(array,predicate){var result=[];if(!(array&&array.length)){return result;}
var index=-1,indexes=[],length=array.length;predicate=getIteratee(predicate,3);while(++index<length){var value=array[index];if(predicate(value,index,array)){result.push(value);indexes.push(index);}}
basePullAt(array,indexes);return result;}
function reverse(array){return array?nativeReverse.call(array):array;}
function slice(array,start,end){var length=array?array.length:0;if(!length){return[];}
if(end&&typeof end!='number'&&isIterateeCall(array,start,end)){start=0;end=length;}
else{start=start==null?0:toInteger(start);end=end===undefined?length:toInteger(end);}
return baseSlice(array,start,end);}
function sortedIndex(array,value){return baseSortedIndex(array,value);}
function sortedIndexBy(array,value,iteratee){return baseSortedIndexBy(array,value,getIteratee(iteratee));}
function sortedIndexOf(array,value){var length=array?array.length:0;if(length){var index=baseSortedIndex(array,value);if(index<length&&eq(array[index],value)){return index;}}
return-1;}
function sortedLastIndex(array,value){return baseSortedIndex(array,value,true);}
function sortedLastIndexBy(array,value,iteratee){return baseSortedIndexBy(array,value,getIteratee(iteratee),true);}
function sortedLastIndexOf(array,value){var length=array?array.length:0;if(length){var index=baseSortedIndex(array,value,true)-1;if(eq(array[index],value)){return index;}}
return-1;}
function sortedUniq(array){return(array&&array.length)?baseSortedUniq(array):[];}
function sortedUniqBy(array,iteratee){return(array&&array.length)?baseSortedUniqBy(array,getIteratee(iteratee)):[];}
function tail(array){return drop(array,1);}
function take(array,n,guard){if(!(array&&array.length)){return[];}
n=(guard||n===undefined)?1:toInteger(n);return baseSlice(array,0,n<0?0:n);}
function takeRight(array,n,guard){var length=array?array.length:0;if(!length){return[];}
n=(guard||n===undefined)?1:toInteger(n);n=length-n;return baseSlice(array,n<0?0:n,length);}
function takeRightWhile(array,predicate){return(array&&array.length)?baseWhile(array,getIteratee(predicate,3),false,true):[];}
function takeWhile(array,predicate){return(array&&array.length)?baseWhile(array,getIteratee(predicate,3)):[];}
var union=rest(function(arrays){return baseUniq(baseFlatten(arrays,1,true));});var unionBy=rest(function(arrays){var iteratee=last(arrays);if(isArrayLikeObject(iteratee)){iteratee=undefined;}
return baseUniq(baseFlatten(arrays,1,true),getIteratee(iteratee));});var unionWith=rest(function(arrays){var comparator=last(arrays);if(isArrayLikeObject(comparator)){comparator=undefined;}
return baseUniq(baseFlatten(arrays,1,true),undefined,comparator);});function uniq(array){return(array&&array.length)?baseUniq(array):[];}
function uniqBy(array,iteratee){return(array&&array.length)?baseUniq(array,getIteratee(iteratee)):[];}
function uniqWith(array,comparator){return(array&&array.length)?baseUniq(array,undefined,comparator):[];}
function unzip(array){if(!(array&&array.length)){return[];}
var length=0;array=arrayFilter(array,function(group){if(isArrayLikeObject(group)){length=nativeMax(group.length,length);return true;}});return baseTimes(length,function(index){return arrayMap(array,baseProperty(index));});}
function unzipWith(array,iteratee){if(!(array&&array.length)){return[];}
var result=unzip(array);if(iteratee==null){return result;}
return arrayMap(result,function(group){return apply(iteratee,undefined,group);});}
var without=rest(function(array,values){return isArrayLikeObject(array)?baseDifference(array,values):[];});var xor=rest(function(arrays){return baseXor(arrayFilter(arrays,isArrayLikeObject));});var xorBy=rest(function(arrays){var iteratee=last(arrays);if(isArrayLikeObject(iteratee)){iteratee=undefined;}
return baseXor(arrayFilter(arrays,isArrayLikeObject),getIteratee(iteratee));});var xorWith=rest(function(arrays){var comparator=last(arrays);if(isArrayLikeObject(comparator)){comparator=undefined;}
return baseXor(arrayFilter(arrays,isArrayLikeObject),undefined,comparator);});var zip=rest(unzip);function zipObject(props,values){return baseZipObject(props||[],values||[],assignValue);}
function zipObjectDeep(props,values){return baseZipObject(props||[],values||[],baseSet);}
var zipWith=rest(function(arrays){var length=arrays.length,iteratee=length>1?arrays[length-1]:undefined;iteratee=typeof iteratee=='function'?(arrays.pop(),iteratee):undefined;return unzipWith(arrays,iteratee);});function chain(value){var result=lodash(value);result.__chain__=true;return result;}
function tap(value,interceptor){interceptor(value);return value;}
function thru(value,interceptor){return interceptor(value);}
var wrapperAt=rest(function(paths){paths=baseFlatten(paths,1);var length=paths.length,start=length?paths[0]:0,value=this.__wrapped__,interceptor=function(object){return baseAt(object,paths);};if(length>1||this.__actions__.length||!(value instanceof LazyWrapper)||!isIndex(start)){return this.thru(interceptor);}
value=value.slice(start,+start+(length?1:0));value.__actions__.push({'func':thru,'args':[interceptor],'thisArg':undefined});return new LodashWrapper(value,this.__chain__).thru(function(array){if(length&&!array.length){array.push(undefined);}
return array;});});function wrapperChain(){return chain(this);}
function wrapperCommit(){return new LodashWrapper(this.value(),this.__chain__);}
function wrapperFlatMap(iteratee){return this.map(iteratee).flatten();}
function wrapperNext(){if(this.__values__===undefined){this.__values__=toArray(this.value());}
var done=this.__index__>=this.__values__.length,value=done?undefined:this.__values__[this.__index__++];return{'done':done,'value':value};}
function wrapperToIterator(){return this;}
function wrapperPlant(value){var result,parent=this;while(parent instanceof baseLodash){var clone=wrapperClone(parent);clone.__index__=0;clone.__values__=undefined;if(result){previous.__wrapped__=clone;}else{result=clone;}
var previous=clone;parent=parent.__wrapped__;}
previous.__wrapped__=value;return result;}
function wrapperReverse(){var value=this.__wrapped__;if(value instanceof LazyWrapper){var wrapped=value;if(this.__actions__.length){wrapped=new LazyWrapper(this);}
wrapped=wrapped.reverse();wrapped.__actions__.push({'func':thru,'args':[reverse],'thisArg':undefined});return new LodashWrapper(wrapped,this.__chain__);}
return this.thru(reverse);}
function wrapperValue(){return baseWrapperValue(this.__wrapped__,this.__actions__);}
var countBy=createAggregator(function(result,value,key){hasOwnProperty.call(result,key)?++result[key]:(result[key]=1);});function every(collection,predicate,guard){var func=isArray(collection)?arrayEvery:baseEvery;if(guard&&isIterateeCall(collection,predicate,guard)){predicate=undefined;}
return func(collection,getIteratee(predicate,3));}
function filter(collection,predicate){var func=isArray(collection)?arrayFilter:baseFilter;return func(collection,getIteratee(predicate,3));}
function find(collection,predicate){predicate=getIteratee(predicate,3);if(isArray(collection)){var index=baseFindIndex(collection,predicate);return index>-1?collection[index]:undefined;}
return baseFind(collection,predicate,baseEach);}
function findLast(collection,predicate){predicate=getIteratee(predicate,3);if(isArray(collection)){var index=baseFindIndex(collection,predicate,true);return index>-1?collection[index]:undefined;}
return baseFind(collection,predicate,baseEachRight);}
function flatMap(collection,iteratee){return baseFlatten(map(collection,iteratee),1);}
function forEach(collection,iteratee){return(typeof iteratee=='function'&&isArray(collection))?arrayEach(collection,iteratee):baseEach(collection,baseCastFunction(iteratee));}
function forEachRight(collection,iteratee){return(typeof iteratee=='function'&&isArray(collection))?arrayEachRight(collection,iteratee):baseEachRight(collection,baseCastFunction(iteratee));}
var groupBy=createAggregator(function(result,value,key){if(hasOwnProperty.call(result,key)){result[key].push(value);}else{result[key]=[value];}});function includes(collection,value,fromIndex,guard){collection=isArrayLike(collection)?collection:values(collection);fromIndex=(fromIndex&&!guard)?toInteger(fromIndex):0;var length=collection.length;if(fromIndex<0){fromIndex=nativeMax(length+fromIndex,0);}
return isString(collection)?(fromIndex<=length&&collection.indexOf(value,fromIndex)>-1):(!!length&&baseIndexOf(collection,value,fromIndex)>-1);}
var invokeMap=rest(function(collection,path,args){var index=-1,isFunc=typeof path=='function',isProp=isKey(path),result=isArrayLike(collection)?Array(collection.length):[];baseEach(collection,function(value){var func=isFunc?path:((isProp&&value!=null)?value[path]:undefined);result[++index]=func?apply(func,value,args):baseInvoke(value,path,args);});return result;});var keyBy=createAggregator(function(result,value,key){result[key]=value;});function map(collection,iteratee){var func=isArray(collection)?arrayMap:baseMap;return func(collection,getIteratee(iteratee,3));}
function orderBy(collection,iteratees,orders,guard){if(collection==null){return[];}
if(!isArray(iteratees)){iteratees=iteratees==null?[]:[iteratees];}
orders=guard?undefined:orders;if(!isArray(orders)){orders=orders==null?[]:[orders];}
return baseOrderBy(collection,iteratees,orders);}
var partition=createAggregator(function(result,value,key){result[key?0:1].push(value);},function(){return[[],[]];});function reduce(collection,iteratee,accumulator){var func=isArray(collection)?arrayReduce:baseReduce,initAccum=arguments.length<3;return func(collection,getIteratee(iteratee,4),accumulator,initAccum,baseEach);}
function reduceRight(collection,iteratee,accumulator){var func=isArray(collection)?arrayReduceRight:baseReduce,initAccum=arguments.length<3;return func(collection,getIteratee(iteratee,4),accumulator,initAccum,baseEachRight);}
function reject(collection,predicate){var func=isArray(collection)?arrayFilter:baseFilter;predicate=getIteratee(predicate,3);return func(collection,function(value,index,collection){return!predicate(value,index,collection);});}
function sample(collection){var array=isArrayLike(collection)?collection:values(collection),length=array.length;return length>0?array[baseRandom(0,length-1)]:undefined;}
function sampleSize(collection,n){var index=-1,result=toArray(collection),length=result.length,lastIndex=length-1;n=baseClamp(toInteger(n),0,length);while(++index<n){var rand=baseRandom(index,lastIndex),value=result[rand];result[rand]=result[index];result[index]=value;}
result.length=n;return result;}
function shuffle(collection){return sampleSize(collection,MAX_ARRAY_LENGTH);}
function size(collection){if(collection==null){return 0;}
if(isArrayLike(collection)){var result=collection.length;return(result&&isString(collection))?stringSize(collection):result;}
return keys(collection).length;}
function some(collection,predicate,guard){var func=isArray(collection)?arraySome:baseSome;if(guard&&isIterateeCall(collection,predicate,guard)){predicate=undefined;}
return func(collection,getIteratee(predicate,3));}
var sortBy=rest(function(collection,iteratees){if(collection==null){return[];}
var length=iteratees.length;if(length>1&&isIterateeCall(collection,iteratees[0],iteratees[1])){iteratees=[];}else if(length>2&&isIterateeCall(iteratees[0],iteratees[1],iteratees[2])){iteratees.length=1;}
return baseOrderBy(collection,baseFlatten(iteratees,1),[]);});var now=Date.now;function after(n,func){if(typeof func!='function'){throw new TypeError(FUNC_ERROR_TEXT);}
n=toInteger(n);return function(){if(--n<1){return func.apply(this,arguments);}};}
function ary(func,n,guard){n=guard?undefined:n;n=(func&&n==null)?func.length:n;return createWrapper(func,ARY_FLAG,undefined,undefined,undefined,undefined,n);}
function before(n,func){var result;if(typeof func!='function'){throw new TypeError(FUNC_ERROR_TEXT);}
n=toInteger(n);return function(){if(--n>0){result=func.apply(this,arguments);}
if(n<=1){func=undefined;}
return result;};}
var bind=rest(function(func,thisArg,partials){var bitmask=BIND_FLAG;if(partials.length){var holders=replaceHolders(partials,getPlaceholder(bind));bitmask|=PARTIAL_FLAG;}
return createWrapper(func,bitmask,thisArg,partials,holders);});var bindKey=rest(function(object,key,partials){var bitmask=BIND_FLAG|BIND_KEY_FLAG;if(partials.length){var holders=replaceHolders(partials,getPlaceholder(bindKey));bitmask|=PARTIAL_FLAG;}
return createWrapper(key,bitmask,object,partials,holders);});function curry(func,arity,guard){arity=guard?undefined:arity;var result=createWrapper(func,CURRY_FLAG,undefined,undefined,undefined,undefined,undefined,arity);result.placeholder=curry.placeholder;return result;}
function curryRight(func,arity,guard){arity=guard?undefined:arity;var result=createWrapper(func,CURRY_RIGHT_FLAG,undefined,undefined,undefined,undefined,undefined,arity);result.placeholder=curryRight.placeholder;return result;}
function debounce(func,wait,options){var args,maxTimeoutId,result,stamp,thisArg,timeoutId,trailingCall,lastCalled=0,leading=false,maxWait=false,trailing=true;if(typeof func!='function'){throw new TypeError(FUNC_ERROR_TEXT);}
wait=toNumber(wait)||0;if(isObject(options)){leading=!!options.leading;maxWait='maxWait'in options&&nativeMax(toNumber(options.maxWait)||0,wait);trailing='trailing'in options?!!options.trailing:trailing;}
function cancel(){if(timeoutId){clearTimeout(timeoutId);}
if(maxTimeoutId){clearTimeout(maxTimeoutId);}
lastCalled=0;args=maxTimeoutId=thisArg=timeoutId=trailingCall=undefined;}
function complete(isCalled,id){if(id){clearTimeout(id);}
maxTimeoutId=timeoutId=trailingCall=undefined;if(isCalled){lastCalled=now();result=func.apply(thisArg,args);if(!timeoutId&&!maxTimeoutId){args=thisArg=undefined;}}}
function delayed(){var remaining=wait-(now()-stamp);if(remaining<=0||remaining>wait){complete(trailingCall,maxTimeoutId);}else{timeoutId=setTimeout(delayed,remaining);}}
function flush(){if((timeoutId&&trailingCall)||(maxTimeoutId&&trailing)){result=func.apply(thisArg,args);}
cancel();return result;}
function maxDelayed(){complete(trailing,timeoutId);}
function debounced(){args=arguments;stamp=now();thisArg=this;trailingCall=trailing&&(timeoutId||!leading);if(maxWait===false){var leadingCall=leading&&!timeoutId;}else{if(!lastCalled&&!maxTimeoutId&&!leading){lastCalled=stamp;}
var remaining=maxWait-(stamp-lastCalled);var isCalled=(remaining<=0||remaining>maxWait)&&(leading||maxTimeoutId);if(isCalled){if(maxTimeoutId){maxTimeoutId=clearTimeout(maxTimeoutId);}
lastCalled=stamp;result=func.apply(thisArg,args);}
else if(!maxTimeoutId){maxTimeoutId=setTimeout(maxDelayed,remaining);}}
if(isCalled&&timeoutId){timeoutId=clearTimeout(timeoutId);}
else if(!timeoutId&&wait!==maxWait){timeoutId=setTimeout(delayed,wait);}
if(leadingCall){isCalled=true;result=func.apply(thisArg,args);}
if(isCalled&&!timeoutId&&!maxTimeoutId){args=thisArg=undefined;}
return result;}
debounced.cancel=cancel;debounced.flush=flush;return debounced;}
var defer=rest(function(func,args){return baseDelay(func,1,args);});var delay=rest(function(func,wait,args){return baseDelay(func,toNumber(wait)||0,args);});function flip(func){return createWrapper(func,FLIP_FLAG);}
function memoize(func,resolver){if(typeof func!='function'||(resolver&&typeof resolver!='function')){throw new TypeError(FUNC_ERROR_TEXT);}
var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key)){return cache.get(key);}
var result=func.apply(this,args);memoized.cache=cache.set(key,result);return result;};memoized.cache=new memoize.Cache;return memoized;}
function negate(predicate){if(typeof predicate!='function'){throw new TypeError(FUNC_ERROR_TEXT);}
return function(){return!predicate.apply(this,arguments);};}
function once(func){return before(2,func);}
var overArgs=rest(function(func,transforms){transforms=arrayMap(baseFlatten(transforms,1),getIteratee());var funcsLength=transforms.length;return rest(function(args){var index=-1,length=nativeMin(args.length,funcsLength);while(++index<length){args[index]=transforms[index].call(this,args[index]);}
return apply(func,this,args);});});var partial=rest(function(func,partials){var holders=replaceHolders(partials,getPlaceholder(partial));return createWrapper(func,PARTIAL_FLAG,undefined,partials,holders);});var partialRight=rest(function(func,partials){var holders=replaceHolders(partials,getPlaceholder(partialRight));return createWrapper(func,PARTIAL_RIGHT_FLAG,undefined,partials,holders);});var rearg=rest(function(func,indexes){return createWrapper(func,REARG_FLAG,undefined,undefined,undefined,baseFlatten(indexes,1));});function rest(func,start){if(typeof func!='function'){throw new TypeError(FUNC_ERROR_TEXT);}
start=nativeMax(start===undefined?(func.length-1):toInteger(start),0);return function(){var args=arguments,index=-1,length=nativeMax(args.length-start,0),array=Array(length);while(++index<length){array[index]=args[start+index];}
switch(start){case 0:return func.call(this,array);case 1:return func.call(this,args[0],array);case 2:return func.call(this,args[0],args[1],array);}
var otherArgs=Array(start+1);index=-1;while(++index<start){otherArgs[index]=args[index];}
otherArgs[start]=array;return apply(func,this,otherArgs);};}
function spread(func,start){if(typeof func!='function'){throw new TypeError(FUNC_ERROR_TEXT);}
start=start===undefined?0:nativeMax(toInteger(start),0);return rest(function(args){var array=args[start],otherArgs=args.slice(0,start);if(array){arrayPush(otherArgs,array);}
return apply(func,this,otherArgs);});}
function throttle(func,wait,options){var leading=true,trailing=true;if(typeof func!='function'){throw new TypeError(FUNC_ERROR_TEXT);}
if(isObject(options)){leading='leading'in options?!!options.leading:leading;trailing='trailing'in options?!!options.trailing:trailing;}
return debounce(func,wait,{'leading':leading,'maxWait':wait,'trailing':trailing});}
function unary(func){return ary(func,1);}
function wrap(value,wrapper){wrapper=wrapper==null?identity:wrapper;return partial(wrapper,value);}
function castArray(){if(!arguments.length){return[];}
var value=arguments[0];return isArray(value)?value:[value];}
function clone(value){return baseClone(value,false,true);}
function cloneWith(value,customizer){return baseClone(value,false,true,customizer);}
function cloneDeep(value){return baseClone(value,true,true);}
function cloneDeepWith(value,customizer){return baseClone(value,true,true,customizer);}
function eq(value,other){return value===other||(value!==value&&other!==other);}
function gt(value,other){return value>other;}
function gte(value,other){return value>=other;}
function isArguments(value){return isArrayLikeObject(value)&&hasOwnProperty.call(value,'callee')&&(!propertyIsEnumerable.call(value,'callee')||objectToString.call(value)==argsTag);}
var isArray=Array.isArray;function isArrayBuffer(value){return isObjectLike(value)&&objectToString.call(value)==arrayBufferTag;}
function isArrayLike(value){return value!=null&&isLength(getLength(value))&&!isFunction(value);}
function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value);}
function isBoolean(value){return value===true||value===false||(isObjectLike(value)&&objectToString.call(value)==boolTag);}
var isBuffer=!Buffer?constant(false):function(value){return value instanceof Buffer;};function isDate(value){return isObjectLike(value)&&objectToString.call(value)==dateTag;}
function isElement(value){return!!value&&value.nodeType===1&&isObjectLike(value)&&!isPlainObject(value);}
function isEmpty(value){if(isArrayLike(value)&&(isArray(value)||isString(value)||isFunction(value.splice)||isArguments(value))){return!value.length;}
for(var key in value){if(hasOwnProperty.call(value,key)){return false;}}
return true;}
function isEqual(value,other){return baseIsEqual(value,other);}
function isEqualWith(value,other,customizer){customizer=typeof customizer=='function'?customizer:undefined;var result=customizer?customizer(value,other):undefined;return result===undefined?baseIsEqual(value,other,customizer):!!result;}
function isError(value){if(!isObjectLike(value)){return false;}
return(objectToString.call(value)==errorTag)||(typeof value.message=='string'&&typeof value.name=='string');}
function isFinite(value){return typeof value=='number'&&nativeIsFinite(value);}
function isFunction(value){var tag=isObject(value)?objectToString.call(value):'';return tag==funcTag||tag==genTag;}
function isInteger(value){return typeof value=='number'&&value==toInteger(value);}
function isLength(value){return typeof value=='number'&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER;}
function isObject(value){var type=typeof value;return!!value&&(type=='object'||type=='function');}
function isObjectLike(value){return!!value&&typeof value=='object';}
function isMap(value){return isObjectLike(value)&&getTag(value)==mapTag;}
function isMatch(object,source){return object===source||baseIsMatch(object,source,getMatchData(source));}
function isMatchWith(object,source,customizer){customizer=typeof customizer=='function'?customizer:undefined;return baseIsMatch(object,source,getMatchData(source),customizer);}
function isNaN(value){return isNumber(value)&&value!=+value;}
function isNative(value){if(value==null){return false;}
if(isFunction(value)){return reIsNative.test(funcToString.call(value));}
return isObjectLike(value)&&(isHostObject(value)?reIsNative:reIsHostCtor).test(value);}
function isNull(value){return value===null;}
function isNil(value){return value==null;}
function isNumber(value){return typeof value=='number'||(isObjectLike(value)&&objectToString.call(value)==numberTag);}
function isPlainObject(value){if(!isObjectLike(value)||objectToString.call(value)!=objectTag||isHostObject(value)){return false;}
var proto=getPrototypeOf(value);if(proto===null){return true;}
var Ctor=proto.constructor;return(typeof Ctor=='function'&&Ctor instanceof Ctor&&funcToString.call(Ctor)==objectCtorString);}
function isRegExp(value){return isObject(value)&&objectToString.call(value)==regexpTag;}
function isSafeInteger(value){return isInteger(value)&&value>=-MAX_SAFE_INTEGER&&value<=MAX_SAFE_INTEGER;}
function isSet(value){return isObjectLike(value)&&getTag(value)==setTag;}
function isString(value){return typeof value=='string'||(!isArray(value)&&isObjectLike(value)&&objectToString.call(value)==stringTag);}
function isSymbol(value){return typeof value=='symbol'||(isObjectLike(value)&&objectToString.call(value)==symbolTag);}
function isTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[objectToString.call(value)];}
function isUndefined(value){return value===undefined;}
function isWeakMap(value){return isObjectLike(value)&&getTag(value)==weakMapTag;}
function isWeakSet(value){return isObjectLike(value)&&objectToString.call(value)==weakSetTag;}
function lt(value,other){return value<other;}
function lte(value,other){return value<=other;}
function toArray(value){if(!value){return[];}
if(isArrayLike(value)){return isString(value)?stringToArray(value):copyArray(value);}
if(iteratorSymbol&&value[iteratorSymbol]){return iteratorToArray(value[iteratorSymbol]());}
var tag=getTag(value),func=tag==mapTag?mapToArray:(tag==setTag?setToArray:values);return func(value);}
function toInteger(value){if(!value){return value===0?value:0;}
value=toNumber(value);if(value===INFINITY||value===-INFINITY){var sign=(value<0?-1:1);return sign*MAX_INTEGER;}
var remainder=value%1;return value===value?(remainder?value-remainder:value):0;}
function toLength(value){return value?baseClamp(toInteger(value),0,MAX_ARRAY_LENGTH):0;}
function toNumber(value){if(isObject(value)){var other=isFunction(value.valueOf)?value.valueOf():value;value=isObject(other)?(other+''):other;}
if(typeof value!='string'){return value===0?value:+value;}
value=value.replace(reTrim,'');var isBinary=reIsBinary.test(value);return(isBinary||reIsOctal.test(value))?freeParseInt(value.slice(2),isBinary?2:8):(reIsBadHex.test(value)?NAN:+value);}
function toPlainObject(value){return copyObject(value,keysIn(value));}
function toSafeInteger(value){return baseClamp(toInteger(value),-MAX_SAFE_INTEGER,MAX_SAFE_INTEGER);}
function toString(value){if(typeof value=='string'){return value;}
if(value==null){return'';}
if(isSymbol(value)){return symbolToString?symbolToString.call(value):'';}
var result=(value+'');return(result=='0'&&(1/value)==-INFINITY)?'-0':result;}
var assign=createAssigner(function(object,source){if(nonEnumShadows||isPrototype(source)||isArrayLike(source)){copyObject(source,keys(source),object);return;}
for(var key in source){if(hasOwnProperty.call(source,key)){assignValue(object,key,source[key]);}}});var assignIn=createAssigner(function(object,source){if(nonEnumShadows||isPrototype(source)||isArrayLike(source)){copyObject(source,keysIn(source),object);return;}
for(var key in source){assignValue(object,key,source[key]);}});var assignInWith=createAssigner(function(object,source,srcIndex,customizer){copyObjectWith(source,keysIn(source),object,customizer);});var assignWith=createAssigner(function(object,source,srcIndex,customizer){copyObjectWith(source,keys(source),object,customizer);});var at=rest(function(object,paths){return baseAt(object,baseFlatten(paths,1));});function create(prototype,properties){var result=baseCreate(prototype);return properties?baseAssign(result,properties):result;}
var defaults=rest(function(args){args.push(undefined,assignInDefaults);return apply(assignInWith,undefined,args);});var defaultsDeep=rest(function(args){args.push(undefined,mergeDefaults);return apply(mergeWith,undefined,args);});function findKey(object,predicate){return baseFind(object,getIteratee(predicate,3),baseForOwn,true);}
function findLastKey(object,predicate){return baseFind(object,getIteratee(predicate,3),baseForOwnRight,true);}
function forIn(object,iteratee){return object==null?object:baseFor(object,baseCastFunction(iteratee),keysIn);}
function forInRight(object,iteratee){return object==null?object:baseForRight(object,baseCastFunction(iteratee),keysIn);}
function forOwn(object,iteratee){return object&&baseForOwn(object,baseCastFunction(iteratee));}
function forOwnRight(object,iteratee){return object&&baseForOwnRight(object,baseCastFunction(iteratee));}
function functions(object){return object==null?[]:baseFunctions(object,keys(object));}
function functionsIn(object){return object==null?[]:baseFunctions(object,keysIn(object));}
function get(object,path,defaultValue){var result=object==null?undefined:baseGet(object,path);return result===undefined?defaultValue:result;}
function has(object,path){return hasPath(object,path,baseHas);}
function hasIn(object,path){return hasPath(object,path,baseHasIn);}
var invert=createInverter(function(result,value,key){result[value]=key;},constant(identity));var invertBy=createInverter(function(result,value,key){if(hasOwnProperty.call(result,value)){result[value].push(key);}else{result[value]=[key];}},getIteratee);var invoke=rest(baseInvoke);function keys(object){var isProto=isPrototype(object);if(!(isProto||isArrayLike(object))){return baseKeys(object);}
var indexes=indexKeys(object),skipIndexes=!!indexes,result=indexes||[],length=result.length;for(var key in object){if(baseHas(object,key)&&!(skipIndexes&&(key=='length'||isIndex(key,length)))&&!(isProto&&key=='constructor')){result.push(key);}}
return result;}
function keysIn(object){var index=-1,isProto=isPrototype(object),props=baseKeysIn(object),propsLength=props.length,indexes=indexKeys(object),skipIndexes=!!indexes,result=indexes||[],length=result.length;while(++index<propsLength){var key=props[index];if(!(skipIndexes&&(key=='length'||isIndex(key,length)))&&!(key=='constructor'&&(isProto||!hasOwnProperty.call(object,key)))){result.push(key);}}
return result;}
function mapKeys(object,iteratee){var result={};iteratee=getIteratee(iteratee,3);baseForOwn(object,function(value,key,object){result[iteratee(value,key,object)]=value;});return result;}
function mapValues(object,iteratee){var result={};iteratee=getIteratee(iteratee,3);baseForOwn(object,function(value,key,object){result[key]=iteratee(value,key,object);});return result;}
var merge=createAssigner(function(object,source,srcIndex){baseMerge(object,source,srcIndex);});var mergeWith=createAssigner(function(object,source,srcIndex,customizer){baseMerge(object,source,srcIndex,customizer);});var omit=rest(function(object,props){if(object==null){return{};}
props=arrayMap(baseFlatten(props,1),String);return basePick(object,baseDifference(keysIn(object),props));});function omitBy(object,predicate){predicate=getIteratee(predicate);return basePickBy(object,function(value,key){return!predicate(value,key);});}
var pick=rest(function(object,props){return object==null?{}:basePick(object,baseFlatten(props,1));});function pickBy(object,predicate){return object==null?{}:basePickBy(object,getIteratee(predicate));}
function result(object,path,defaultValue){if(!isKey(path,object)){path=baseCastPath(path);var result=get(object,path);object=parent(object,path);}else{result=object==null?undefined:object[path];}
if(result===undefined){result=defaultValue;}
return isFunction(result)?result.call(object):result;}
function set(object,path,value){return object==null?object:baseSet(object,path,value);}
function setWith(object,path,value,customizer){customizer=typeof customizer=='function'?customizer:undefined;return object==null?object:baseSet(object,path,value,customizer);}
function toPairs(object){return baseToPairs(object,keys(object));}
function toPairsIn(object){return baseToPairs(object,keysIn(object));}
function transform(object,iteratee,accumulator){var isArr=isArray(object)||isTypedArray(object);iteratee=getIteratee(iteratee,4);if(accumulator==null){if(isArr||isObject(object)){var Ctor=object.constructor;if(isArr){accumulator=isArray(object)?new Ctor:[];}else{accumulator=isFunction(Ctor)?baseCreate(getPrototypeOf(object)):{};}}else{accumulator={};}}
(isArr?arrayEach:baseForOwn)(object,function(value,index,object){return iteratee(accumulator,value,index,object);});return accumulator;}
function unset(object,path){return object==null?true:baseUnset(object,path);}
function update(object,path,updater){return object==null?object:baseUpdate(object,path,baseCastFunction(updater));}
function updateWith(object,path,updater,customizer){customizer=typeof customizer=='function'?customizer:undefined;return object==null?object:baseUpdate(object,path,baseCastFunction(updater),customizer);}
function values(object){return object?baseValues(object,keys(object)):[];}
function valuesIn(object){return object==null?[]:baseValues(object,keysIn(object));}
function clamp(number,lower,upper){if(upper===undefined){upper=lower;lower=undefined;}
if(upper!==undefined){upper=toNumber(upper);upper=upper===upper?upper:0;}
if(lower!==undefined){lower=toNumber(lower);lower=lower===lower?lower:0;}
return baseClamp(toNumber(number),lower,upper);}
function inRange(number,start,end){start=toNumber(start)||0;if(end===undefined){end=start;start=0;}else{end=toNumber(end)||0;}
number=toNumber(number);return baseInRange(number,start,end);}
function random(lower,upper,floating){if(floating&&typeof floating!='boolean'&&isIterateeCall(lower,upper,floating)){upper=floating=undefined;}
if(floating===undefined){if(typeof upper=='boolean'){floating=upper;upper=undefined;}
else if(typeof lower=='boolean'){floating=lower;lower=undefined;}}
if(lower===undefined&&upper===undefined){lower=0;upper=1;}
else{lower=toNumber(lower)||0;if(upper===undefined){upper=lower;lower=0;}else{upper=toNumber(upper)||0;}}
if(lower>upper){var temp=lower;lower=upper;upper=temp;}
if(floating||lower%1||upper%1){var rand=nativeRandom();return nativeMin(lower+(rand*(upper-lower+freeParseFloat('1e-'+((rand+'').length-1)))),upper);}
return baseRandom(lower,upper);}
var camelCase=createCompounder(function(result,word,index){word=word.toLowerCase();return result+(index?capitalize(word):word);});function capitalize(string){return upperFirst(toString(string).toLowerCase());}
function deburr(string){string=toString(string);return string&&string.replace(reLatin1,deburrLetter).replace(reComboMark,'');}
function endsWith(string,target,position){string=toString(string);target=typeof target=='string'?target:(target+'');var length=string.length;position=position===undefined?length:baseClamp(toInteger(position),0,length);position-=target.length;return position>=0&&string.indexOf(target,position)==position;}
function escape(string){string=toString(string);return(string&&reHasUnescapedHtml.test(string))?string.replace(reUnescapedHtml,escapeHtmlChar):string;}
function escapeRegExp(string){string=toString(string);return(string&&reHasRegExpChar.test(string))?string.replace(reRegExpChar,'\\$&'):string;}
var kebabCase=createCompounder(function(result,word,index){return result+(index?'-':'')+word.toLowerCase();});var lowerCase=createCompounder(function(result,word,index){return result+(index?' ':'')+word.toLowerCase();});var lowerFirst=createCaseFirst('toLowerCase');var upperFirst=createCaseFirst('toUpperCase');function pad(string,length,chars){string=toString(string);length=toInteger(length);var strLength=stringSize(string);if(!length||strLength>=length){return string;}
var mid=(length-strLength)/2,leftLength=nativeFloor(mid),rightLength=nativeCeil(mid);return createPadding('',leftLength,chars)+string+createPadding('',rightLength,chars);}
function padEnd(string,length,chars){string=toString(string);return string+createPadding(string,length,chars);}
function padStart(string,length,chars){string=toString(string);return createPadding(string,length,chars)+string;}
function parseInt(string,radix,guard){if(guard||radix==null){radix=0;}else if(radix){radix=+radix;}
string=toString(string).replace(reTrim,'');return nativeParseInt(string,radix||(reHasHexPrefix.test(string)?16:10));}
function repeat(string,n){string=toString(string);n=toInteger(n);var result='';if(!string||n<1||n>MAX_SAFE_INTEGER){return result;}
do{if(n%2){result+=string;}
n=nativeFloor(n/2);string+=string;}while(n);return result;}
function replace(){var args=arguments,string=toString(args[0]);return args.length<3?string:string.replace(args[1],args[2]);}
var snakeCase=createCompounder(function(result,word,index){return result+(index?'_':'')+word.toLowerCase();});function split(string,separator,limit){return toString(string).split(separator,limit);}
var startCase=createCompounder(function(result,word,index){return result+(index?' ':'')+capitalize(word);});function startsWith(string,target,position){string=toString(string);position=baseClamp(toInteger(position),0,string.length);return string.lastIndexOf(target,position)==position;}
function template(string,options,guard){var settings=lodash.templateSettings;if(guard&&isIterateeCall(string,options,guard)){options=undefined;}
string=toString(string);options=assignInWith({},options,settings,assignInDefaults);var imports=assignInWith({},options.imports,settings.imports,assignInDefaults),importsKeys=keys(imports),importsValues=baseValues(imports,importsKeys);var isEscaping,isEvaluating,index=0,interpolate=options.interpolate||reNoMatch,source="__p += '";var reDelimiters=RegExp((options.escape||reNoMatch).source+'|'+
interpolate.source+'|'+
(interpolate===reInterpolate?reEsTemplate:reNoMatch).source+'|'+
(options.evaluate||reNoMatch).source+'|$','g');var sourceURL='//# sourceURL='+
('sourceURL'in options?options.sourceURL:('lodash.templateSources['+(++templateCounter)+']'))+'\n';string.replace(reDelimiters,function(match,escapeValue,interpolateValue,esTemplateValue,evaluateValue,offset){interpolateValue||(interpolateValue=esTemplateValue);source+=string.slice(index,offset).replace(reUnescapedString,escapeStringChar);if(escapeValue){isEscaping=true;source+="' +\n__e("+escapeValue+") +\n'";}
if(evaluateValue){isEvaluating=true;source+="';\n"+evaluateValue+";\n__p += '";}
if(interpolateValue){source+="' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'";}
index=offset+match.length;return match;});source+="';\n";var variable=options.variable;if(!variable){source='with (obj) {\n'+source+'\n}\n';}
source=(isEvaluating?source.replace(reEmptyStringLeading,''):source).replace(reEmptyStringMiddle,'$1').replace(reEmptyStringTrailing,'$1;');source='function('+(variable||'obj')+') {\n'+
(variable?'':'obj || (obj = {});\n')+"var __t, __p = ''"+
(isEscaping?', __e = _.escape':'')+
(isEvaluating?', __j = Array.prototype.join;\n'+"function print() { __p += __j.call(arguments, '') }\n":';\n')+
source+'return __p\n}';var result=attempt(function(){return Function(importsKeys,sourceURL+'return '+source).apply(undefined,importsValues);});result.source=source;if(isError(result)){throw result;}
return result;}
function toLower(value){return toString(value).toLowerCase();}
function toUpper(value){return toString(value).toUpperCase();}
function trim(string,chars,guard){string=toString(string);if(!string){return string;}
if(guard||chars===undefined){return string.replace(reTrim,'');}
chars=(chars+'');if(!chars){return string;}
var strSymbols=stringToArray(string),chrSymbols=stringToArray(chars);return strSymbols.slice(charsStartIndex(strSymbols,chrSymbols),charsEndIndex(strSymbols,chrSymbols)+1).join('');}
function trimEnd(string,chars,guard){string=toString(string);if(!string){return string;}
if(guard||chars===undefined){return string.replace(reTrimEnd,'');}
chars=(chars+'');if(!chars){return string;}
var strSymbols=stringToArray(string);return strSymbols.slice(0,charsEndIndex(strSymbols,stringToArray(chars))+1).join('');}
function trimStart(string,chars,guard){string=toString(string);if(!string){return string;}
if(guard||chars===undefined){return string.replace(reTrimStart,'');}
chars=(chars+'');if(!chars){return string;}
var strSymbols=stringToArray(string);return strSymbols.slice(charsStartIndex(strSymbols,stringToArray(chars))).join('');}
function truncate(string,options){var length=DEFAULT_TRUNC_LENGTH,omission=DEFAULT_TRUNC_OMISSION;if(isObject(options)){var separator='separator'in options?options.separator:separator;length='length'in options?toInteger(options.length):length;omission='omission'in options?toString(options.omission):omission;}
string=toString(string);var strLength=string.length;if(reHasComplexSymbol.test(string)){var strSymbols=stringToArray(string);strLength=strSymbols.length;}
if(length>=strLength){return string;}
var end=length-stringSize(omission);if(end<1){return omission;}
var result=strSymbols?strSymbols.slice(0,end).join(''):string.slice(0,end);if(separator===undefined){return result+omission;}
if(strSymbols){end+=(result.length-end);}
if(isRegExp(separator)){if(string.slice(end).search(separator)){var match,substring=result;if(!separator.global){separator=RegExp(separator.source,toString(reFlags.exec(separator))+'g');}
separator.lastIndex=0;while((match=separator.exec(substring))){var newEnd=match.index;}
result=result.slice(0,newEnd===undefined?end:newEnd);}}else if(string.indexOf(separator,end)!=end){var index=result.lastIndexOf(separator);if(index>-1){result=result.slice(0,index);}}
return result+omission;}
function unescape(string){string=toString(string);return(string&&reHasEscapedHtml.test(string))?string.replace(reEscapedHtml,unescapeHtmlChar):string;}
var upperCase=createCompounder(function(result,word,index){return result+(index?' ':'')+word.toUpperCase();});function words(string,pattern,guard){string=toString(string);pattern=guard?undefined:pattern;if(pattern===undefined){pattern=reHasComplexWord.test(string)?reComplexWord:reBasicWord;}
return string.match(pattern)||[];}
var attempt=rest(function(func,args){try{return apply(func,undefined,args);}catch(e){return isError(e)?e:new Error(e);}});var bindAll=rest(function(object,methodNames){arrayEach(baseFlatten(methodNames,1),function(key){object[key]=bind(object[key],object);});return object;});function cond(pairs){var length=pairs?pairs.length:0,toIteratee=getIteratee();pairs=!length?[]:arrayMap(pairs,function(pair){if(typeof pair[1]!='function'){throw new TypeError(FUNC_ERROR_TEXT);}
return[toIteratee(pair[0]),pair[1]];});return rest(function(args){var index=-1;while(++index<length){var pair=pairs[index];if(apply(pair[0],this,args)){return apply(pair[1],this,args);}}});}
function conforms(source){return baseConforms(baseClone(source,true));}
function constant(value){return function(){return value;};}
var flow=createFlow();var flowRight=createFlow(true);function identity(value){return value;}
function iteratee(func){return baseIteratee(typeof func=='function'?func:baseClone(func,true));}
function matches(source){return baseMatches(baseClone(source,true));}
function matchesProperty(path,srcValue){return baseMatchesProperty(path,baseClone(srcValue,true));}
var method=rest(function(path,args){return function(object){return baseInvoke(object,path,args);};});var methodOf=rest(function(object,args){return function(path){return baseInvoke(object,path,args);};});function mixin(object,source,options){var props=keys(source),methodNames=baseFunctions(source,props);if(options==null&&!(isObject(source)&&(methodNames.length||!props.length))){options=source;source=object;object=this;methodNames=baseFunctions(source,keys(source));}
var chain=(isObject(options)&&'chain'in options)?options.chain:true,isFunc=isFunction(object);arrayEach(methodNames,function(methodName){var func=source[methodName];object[methodName]=func;if(isFunc){object.prototype[methodName]=function(){var chainAll=this.__chain__;if(chain||chainAll){var result=object(this.__wrapped__),actions=result.__actions__=copyArray(this.__actions__);actions.push({'func':func,'args':arguments,'thisArg':object});result.__chain__=chainAll;return result;}
return func.apply(object,arrayPush([this.value()],arguments));};}});return object;}
function noConflict(){if(root._===this){root._=oldDash;}
return this;}
function noop(){}
function nthArg(n){n=toInteger(n);return function(){return arguments[n];};}
var over=createOver(arrayMap);var overEvery=createOver(arrayEvery);var overSome=createOver(arraySome);function property(path){return isKey(path)?baseProperty(path):basePropertyDeep(path);}
function propertyOf(object){return function(path){return object==null?undefined:baseGet(object,path);};}
var range=createRange();var rangeRight=createRange(true);function times(n,iteratee){n=toInteger(n);if(n<1||n>MAX_SAFE_INTEGER){return[];}
var index=MAX_ARRAY_LENGTH,length=nativeMin(n,MAX_ARRAY_LENGTH);iteratee=baseCastFunction(iteratee);n-=MAX_ARRAY_LENGTH;var result=baseTimes(length,iteratee);while(++index<n){iteratee(index);}
return result;}
function toPath(value){return isArray(value)?arrayMap(value,String):stringToPath(value);}
function uniqueId(prefix){var id=++idCounter;return toString(prefix)+id;}
function add(augend,addend){var result;if(augend===undefined&&addend===undefined){return 0;}
if(augend!==undefined){result=augend;}
if(addend!==undefined){result=result===undefined?addend:(result+addend);}
return result;}
var ceil=createRound('ceil');var floor=createRound('floor');function max(array){return(array&&array.length)?baseExtremum(array,identity,gt):undefined;}
function maxBy(array,iteratee){return(array&&array.length)?baseExtremum(array,getIteratee(iteratee),gt):undefined;}
function mean(array){return sum(array)/(array?array.length:0);}
function min(array){return(array&&array.length)?baseExtremum(array,identity,lt):undefined;}
function minBy(array,iteratee){return(array&&array.length)?baseExtremum(array,getIteratee(iteratee),lt):undefined;}
var round=createRound('round');function subtract(minuend,subtrahend){var result;if(minuend===undefined&&subtrahend===undefined){return 0;}
if(minuend!==undefined){result=minuend;}
if(subtrahend!==undefined){result=result===undefined?subtrahend:(result-subtrahend);}
return result;}
function sum(array){return(array&&array.length)?baseSum(array,identity):0;}
function sumBy(array,iteratee){return(array&&array.length)?baseSum(array,getIteratee(iteratee)):0;}
lodash.prototype=baseLodash.prototype;lodash.prototype.constructor=lodash;LodashWrapper.prototype=baseCreate(baseLodash.prototype);LodashWrapper.prototype.constructor=LodashWrapper;LazyWrapper.prototype=baseCreate(baseLodash.prototype);LazyWrapper.prototype.constructor=LazyWrapper;Hash.prototype=nativeCreate?nativeCreate(null):objectProto;MapCache.prototype.clear=mapClear;MapCache.prototype['delete']=mapDelete;MapCache.prototype.get=mapGet;MapCache.prototype.has=mapHas;MapCache.prototype.set=mapSet;SetCache.prototype.push=cachePush;Stack.prototype.clear=stackClear;Stack.prototype['delete']=stackDelete;Stack.prototype.get=stackGet;Stack.prototype.has=stackHas;Stack.prototype.set=stackSet;memoize.Cache=MapCache;lodash.after=after;lodash.ary=ary;lodash.assign=assign;lodash.assignIn=assignIn;lodash.assignInWith=assignInWith;lodash.assignWith=assignWith;lodash.at=at;lodash.before=before;lodash.bind=bind;lodash.bindAll=bindAll;lodash.bindKey=bindKey;lodash.castArray=castArray;lodash.chain=chain;lodash.chunk=chunk;lodash.compact=compact;lodash.concat=concat;lodash.cond=cond;lodash.conforms=conforms;lodash.constant=constant;lodash.countBy=countBy;lodash.create=create;lodash.curry=curry;lodash.curryRight=curryRight;lodash.debounce=debounce;lodash.defaults=defaults;lodash.defaultsDeep=defaultsDeep;lodash.defer=defer;lodash.delay=delay;lodash.difference=difference;lodash.differenceBy=differenceBy;lodash.differenceWith=differenceWith;lodash.drop=drop;lodash.dropRight=dropRight;lodash.dropRightWhile=dropRightWhile;lodash.dropWhile=dropWhile;lodash.fill=fill;lodash.filter=filter;lodash.flatMap=flatMap;lodash.flatten=flatten;lodash.flattenDeep=flattenDeep;lodash.flattenDepth=flattenDepth;lodash.flip=flip;lodash.flow=flow;lodash.flowRight=flowRight;lodash.fromPairs=fromPairs;lodash.functions=functions;lodash.functionsIn=functionsIn;lodash.groupBy=groupBy;lodash.initial=initial;lodash.intersection=intersection;lodash.intersectionBy=intersectionBy;lodash.intersectionWith=intersectionWith;lodash.invert=invert;lodash.invertBy=invertBy;lodash.invokeMap=invokeMap;lodash.iteratee=iteratee;lodash.keyBy=keyBy;lodash.keys=keys;lodash.keysIn=keysIn;lodash.map=map;lodash.mapKeys=mapKeys;lodash.mapValues=mapValues;lodash.matches=matches;lodash.matchesProperty=matchesProperty;lodash.memoize=memoize;lodash.merge=merge;lodash.mergeWith=mergeWith;lodash.method=method;lodash.methodOf=methodOf;lodash.mixin=mixin;lodash.negate=negate;lodash.nthArg=nthArg;lodash.omit=omit;lodash.omitBy=omitBy;lodash.once=once;lodash.orderBy=orderBy;lodash.over=over;lodash.overArgs=overArgs;lodash.overEvery=overEvery;lodash.overSome=overSome;lodash.partial=partial;lodash.partialRight=partialRight;lodash.partition=partition;lodash.pick=pick;lodash.pickBy=pickBy;lodash.property=property;lodash.propertyOf=propertyOf;lodash.pull=pull;lodash.pullAll=pullAll;lodash.pullAllBy=pullAllBy;lodash.pullAllWith=pullAllWith;lodash.pullAt=pullAt;lodash.range=range;lodash.rangeRight=rangeRight;lodash.rearg=rearg;lodash.reject=reject;lodash.remove=remove;lodash.rest=rest;lodash.reverse=reverse;lodash.sampleSize=sampleSize;lodash.set=set;lodash.setWith=setWith;lodash.shuffle=shuffle;lodash.slice=slice;lodash.sortBy=sortBy;lodash.sortedUniq=sortedUniq;lodash.sortedUniqBy=sortedUniqBy;lodash.split=split;lodash.spread=spread;lodash.tail=tail;lodash.take=take;lodash.takeRight=takeRight;lodash.takeRightWhile=takeRightWhile;lodash.takeWhile=takeWhile;lodash.tap=tap;lodash.throttle=throttle;lodash.thru=thru;lodash.toArray=toArray;lodash.toPairs=toPairs;lodash.toPairsIn=toPairsIn;lodash.toPath=toPath;lodash.toPlainObject=toPlainObject;lodash.transform=transform;lodash.unary=unary;lodash.union=union;lodash.unionBy=unionBy;lodash.unionWith=unionWith;lodash.uniq=uniq;lodash.uniqBy=uniqBy;lodash.uniqWith=uniqWith;lodash.unset=unset;lodash.unzip=unzip;lodash.unzipWith=unzipWith;lodash.update=update;lodash.updateWith=updateWith;lodash.values=values;lodash.valuesIn=valuesIn;lodash.without=without;lodash.words=words;lodash.wrap=wrap;lodash.xor=xor;lodash.xorBy=xorBy;lodash.xorWith=xorWith;lodash.zip=zip;lodash.zipObject=zipObject;lodash.zipObjectDeep=zipObjectDeep;lodash.zipWith=zipWith;lodash.extend=assignIn;lodash.extendWith=assignInWith;mixin(lodash,lodash);lodash.add=add;lodash.attempt=attempt;lodash.camelCase=camelCase;lodash.capitalize=capitalize;lodash.ceil=ceil;lodash.clamp=clamp;lodash.clone=clone;lodash.cloneDeep=cloneDeep;lodash.cloneDeepWith=cloneDeepWith;lodash.cloneWith=cloneWith;lodash.deburr=deburr;lodash.endsWith=endsWith;lodash.eq=eq;lodash.escape=escape;lodash.escapeRegExp=escapeRegExp;lodash.every=every;lodash.find=find;lodash.findIndex=findIndex;lodash.findKey=findKey;lodash.findLast=findLast;lodash.findLastIndex=findLastIndex;lodash.findLastKey=findLastKey;lodash.floor=floor;lodash.forEach=forEach;lodash.forEachRight=forEachRight;lodash.forIn=forIn;lodash.forInRight=forInRight;lodash.forOwn=forOwn;lodash.forOwnRight=forOwnRight;lodash.get=get;lodash.gt=gt;lodash.gte=gte;lodash.has=has;lodash.hasIn=hasIn;lodash.head=head;lodash.identity=identity;lodash.includes=includes;lodash.indexOf=indexOf;lodash.inRange=inRange;lodash.invoke=invoke;lodash.isArguments=isArguments;lodash.isArray=isArray;lodash.isArrayBuffer=isArrayBuffer;lodash.isArrayLike=isArrayLike;lodash.isArrayLikeObject=isArrayLikeObject;lodash.isBoolean=isBoolean;lodash.isBuffer=isBuffer;lodash.isDate=isDate;lodash.isElement=isElement;lodash.isEmpty=isEmpty;lodash.isEqual=isEqual;lodash.isEqualWith=isEqualWith;lodash.isError=isError;lodash.isFinite=isFinite;lodash.isFunction=isFunction;lodash.isInteger=isInteger;lodash.isLength=isLength;lodash.isMap=isMap;lodash.isMatch=isMatch;lodash.isMatchWith=isMatchWith;lodash.isNaN=isNaN;lodash.isNative=isNative;lodash.isNil=isNil;lodash.isNull=isNull;lodash.isNumber=isNumber;lodash.isObject=isObject;lodash.isObjectLike=isObjectLike;lodash.isPlainObject=isPlainObject;lodash.isRegExp=isRegExp;lodash.isSafeInteger=isSafeInteger;lodash.isSet=isSet;lodash.isString=isString;lodash.isSymbol=isSymbol;lodash.isTypedArray=isTypedArray;lodash.isUndefined=isUndefined;lodash.isWeakMap=isWeakMap;lodash.isWeakSet=isWeakSet;lodash.join=join;lodash.kebabCase=kebabCase;lodash.last=last;lodash.lastIndexOf=lastIndexOf;lodash.lowerCase=lowerCase;lodash.lowerFirst=lowerFirst;lodash.lt=lt;lodash.lte=lte;lodash.max=max;lodash.maxBy=maxBy;lodash.mean=mean;lodash.min=min;lodash.minBy=minBy;lodash.noConflict=noConflict;lodash.noop=noop;lodash.now=now;lodash.pad=pad;lodash.padEnd=padEnd;lodash.padStart=padStart;lodash.parseInt=parseInt;lodash.random=random;lodash.reduce=reduce;lodash.reduceRight=reduceRight;lodash.repeat=repeat;lodash.replace=replace;lodash.result=result;lodash.round=round;lodash.runInContext=runInContext;lodash.sample=sample;lodash.size=size;lodash.snakeCase=snakeCase;lodash.some=some;lodash.sortedIndex=sortedIndex;lodash.sortedIndexBy=sortedIndexBy;lodash.sortedIndexOf=sortedIndexOf;lodash.sortedLastIndex=sortedLastIndex;lodash.sortedLastIndexBy=sortedLastIndexBy;lodash.sortedLastIndexOf=sortedLastIndexOf;lodash.startCase=startCase;lodash.startsWith=startsWith;lodash.subtract=subtract;lodash.sum=sum;lodash.sumBy=sumBy;lodash.template=template;lodash.times=times;lodash.toInteger=toInteger;lodash.toLength=toLength;lodash.toLower=toLower;lodash.toNumber=toNumber;lodash.toSafeInteger=toSafeInteger;lodash.toString=toString;lodash.toUpper=toUpper;lodash.trim=trim;lodash.trimEnd=trimEnd;lodash.trimStart=trimStart;lodash.truncate=truncate;lodash.unescape=unescape;lodash.uniqueId=uniqueId;lodash.upperCase=upperCase;lodash.upperFirst=upperFirst;lodash.each=forEach;lodash.eachRight=forEachRight;lodash.first=head;mixin(lodash,(function(){var source={};baseForOwn(lodash,function(func,methodName){if(!hasOwnProperty.call(lodash.prototype,methodName)){source[methodName]=func;}});return source;}()),{'chain':false});lodash.VERSION=VERSION;arrayEach(['bind','bindKey','curry','curryRight','partial','partialRight'],function(methodName){lodash[methodName].placeholder=lodash;});arrayEach(['drop','take'],function(methodName,index){LazyWrapper.prototype[methodName]=function(n){var filtered=this.__filtered__;if(filtered&&!index){return new LazyWrapper(this);}
n=n===undefined?1:nativeMax(toInteger(n),0);var result=this.clone();if(filtered){result.__takeCount__=nativeMin(n,result.__takeCount__);}else{result.__views__.push({'size':nativeMin(n,MAX_ARRAY_LENGTH),'type':methodName+(result.__dir__<0?'Right':'')});}
return result;};LazyWrapper.prototype[methodName+'Right']=function(n){return this.reverse()[methodName](n).reverse();};});arrayEach(['filter','map','takeWhile'],function(methodName,index){var type=index+1,isFilter=type==LAZY_FILTER_FLAG||type==LAZY_WHILE_FLAG;LazyWrapper.prototype[methodName]=function(iteratee){var result=this.clone();result.__iteratees__.push({'iteratee':getIteratee(iteratee,3),'type':type});result.__filtered__=result.__filtered__||isFilter;return result;};});arrayEach(['head','last'],function(methodName,index){var takeName='take'+(index?'Right':'');LazyWrapper.prototype[methodName]=function(){return this[takeName](1).value()[0];};});arrayEach(['initial','tail'],function(methodName,index){var dropName='drop'+(index?'':'Right');LazyWrapper.prototype[methodName]=function(){return this.__filtered__?new LazyWrapper(this):this[dropName](1);};});LazyWrapper.prototype.compact=function(){return this.filter(identity);};LazyWrapper.prototype.find=function(predicate){return this.filter(predicate).head();};LazyWrapper.prototype.findLast=function(predicate){return this.reverse().find(predicate);};LazyWrapper.prototype.invokeMap=rest(function(path,args){if(typeof path=='function'){return new LazyWrapper(this);}
return this.map(function(value){return baseInvoke(value,path,args);});});LazyWrapper.prototype.reject=function(predicate){predicate=getIteratee(predicate,3);return this.filter(function(value){return!predicate(value);});};LazyWrapper.prototype.slice=function(start,end){start=toInteger(start);var result=this;if(result.__filtered__&&(start>0||end<0)){return new LazyWrapper(result);}
if(start<0){result=result.takeRight(-start);}else if(start){result=result.drop(start);}
if(end!==undefined){end=toInteger(end);result=end<0?result.dropRight(-end):result.take(end-start);}
return result;};LazyWrapper.prototype.takeRightWhile=function(predicate){return this.reverse().takeWhile(predicate).reverse();};LazyWrapper.prototype.toArray=function(){return this.take(MAX_ARRAY_LENGTH);};baseForOwn(LazyWrapper.prototype,function(func,methodName){var checkIteratee=/^(?:filter|find|map|reject)|While$/.test(methodName),isTaker=/^(?:head|last)$/.test(methodName),lodashFunc=lodash[isTaker?('take'+(methodName=='last'?'Right':'')):methodName],retUnwrapped=isTaker||/^find/.test(methodName);if(!lodashFunc){return;}
lodash.prototype[methodName]=function(){var value=this.__wrapped__,args=isTaker?[1]:arguments,isLazy=value instanceof LazyWrapper,iteratee=args[0],useLazy=isLazy||isArray(value);var interceptor=function(value){var result=lodashFunc.apply(lodash,arrayPush([value],args));return(isTaker&&chainAll)?result[0]:result;};if(useLazy&&checkIteratee&&typeof iteratee=='function'&&iteratee.length!=1){isLazy=useLazy=false;}
var chainAll=this.__chain__,isHybrid=!!this.__actions__.length,isUnwrapped=retUnwrapped&&!chainAll,onlyLazy=isLazy&&!isHybrid;if(!retUnwrapped&&useLazy){value=onlyLazy?value:new LazyWrapper(this);var result=func.apply(value,args);result.__actions__.push({'func':thru,'args':[interceptor],'thisArg':undefined});return new LodashWrapper(result,chainAll);}
if(isUnwrapped&&onlyLazy){return func.apply(this,args);}
result=this.thru(interceptor);return isUnwrapped?(isTaker?result.value()[0]:result.value()):result;};});arrayEach(['pop','push','shift','sort','splice','unshift'],function(methodName){var func=arrayProto[methodName],chainName=/^(?:push|sort|unshift)$/.test(methodName)?'tap':'thru',retUnwrapped=/^(?:pop|shift)$/.test(methodName);lodash.prototype[methodName]=function(){var args=arguments;if(retUnwrapped&&!this.__chain__){return func.apply(this.value(),args);}
return this[chainName](function(value){return func.apply(value,args);});};});baseForOwn(LazyWrapper.prototype,function(func,methodName){var lodashFunc=lodash[methodName];if(lodashFunc){var key=(lodashFunc.name+''),names=realNames[key]||(realNames[key]=[]);names.push({'name':methodName,'func':lodashFunc});}});realNames[createHybridWrapper(undefined,BIND_KEY_FLAG).name]=[{'name':'wrapper','func':undefined}];LazyWrapper.prototype.clone=lazyClone;LazyWrapper.prototype.reverse=lazyReverse;LazyWrapper.prototype.value=lazyValue;lodash.prototype.at=wrapperAt;lodash.prototype.chain=wrapperChain;lodash.prototype.commit=wrapperCommit;lodash.prototype.flatMap=wrapperFlatMap;lodash.prototype.next=wrapperNext;lodash.prototype.plant=wrapperPlant;lodash.prototype.reverse=wrapperReverse;lodash.prototype.toJSON=lodash.prototype.valueOf=lodash.prototype.value=wrapperValue;if(iteratorSymbol){lodash.prototype[iteratorSymbol]=wrapperToIterator;}
return lodash;}
var _=runInContext();(freeWindow||freeSelf||{})._=_;if(true){!(__WEBPACK_AMD_DEFINE_RESULT__=function(){return _;}.call(exports,__webpack_require__,exports,module),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__));}
else if(freeExports&&freeModule){if(moduleExports){(freeModule.exports=_)._=_;}
freeExports._=_;}
else{root._=_;}}.call(this));}.call(exports,__webpack_require__(3)(module),(function(){return this;}())))},function(module,exports){module.exports=function(module){if(!module.webpackPolyfill){module.deprecate=function(){};module.paths=[];module.children=[];module.webpackPolyfill=1;}
return module;}},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);function apiURL(parts){var url;parts=_.toArray(arguments);url=[window.location.protocol,"//",window.location.host,"/api/"].join("");return url+parts.join("/");}
module.exports={apiURL:apiURL};},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var buttonModel=__webpack_require__(6);var flux=__webpack_require__(7);var messagesModel=__webpack_require__(8);var NOTIFICATION_DURATION=5*1000;var prefs=__webpack_require__(10);var notifications=[];self.addEventListener("beforeunload",function(){_.each(notifications,function(n){n.close();});});var Actions=flux.createActions({notify:function notify(msg,force){var n;if(!self.Notification){console.debug("Browser doesn't support notifications. Not notifying msg:",msg);return;}
if(force!==true){if(prefs.dnd){console.debug("DND. Not notifying msg:",msg);return;}
if(!prefs.showNotifications){console.debug("Won't notify. Not notifynig msg:",msg);return;}
if(!prefs.canNotify){console.debug("Can't notify. Not notifying msg:",msg);return;}
if(window.document.hasFocus&&window.document.hasFocus()){console.debug("Window is focused. Not notifying msg:",msg);return;}}
if(fl.editor_settings){msg=fl.editor_settings.path+": "+msg;}
n=new Notification(msg,{icon:"/static/images/icon_64x64.png"});notifications.push(n);n.onshow=function(){_.delay(function(){n.close();notifications.splice(notifications.indexOf(n),1);},NOTIFICATION_DURATION);};},log:function log(msg,opt_alertLvl,notify){var msgObject;opt_alertLvl=opt_alertLvl||messagesModel.LEVEL.INFO;msgObject=new messagesModel.Message({msg:msg,type:"log",level:opt_alertLvl});this.messages.insert(msgObject,0);if(notify===false){return msgObject;}
if(notify===true||opt_alertLvl>=messagesModel.LEVEL.WARNING){this.notify(msg);}
return msgObject;},info:function info(msg,notify){return this.log(msg,messagesModel.LEVEL.INFO,notify);},success:function success(msg,notify){return this.log(msg,messagesModel.LEVEL.SUCCESS,notify);},warn:function warn(msg,notify){return this.log(msg,messagesModel.LEVEL.WARNING,notify);},error:function error(msg,notify){return this.log(msg,messagesModel.LEVEL.ERROR,notify);},modal:function modal(msg){return msg;},interactive:function interactive(msg,buttons){var msgObject=new messagesModel.Message({msg:msg,type:"interactive",buttons:buttons.map(function(b){return new buttonModel.Button(b);})});this.messages.insert(msgObject,0);return msgObject;},private:function _private(username,msg,time){var msgObject=new messagesModel.Message({type:"user",username:username,msg:msg,time:time*1000||Date.now()});this.privateMessages.insert(msgObject,0);return msgObject;},user:function user(username,msg,time){var msgObject=new messagesModel.Message({type:"user",username:username,msg:msg,time:time*1000||Date.now()});this.messages.insert(msgObject,0);if(username===fl.username){return msgObject;}
if(fl.editor_settings.prefs_path!=="chat"){this.notify("<"+username+"> "+msg);return msgObject;}
if(msg.indexOf(fl.username)!==-1){this.notify("<"+username+"> "+msg);}
return msgObject;},messages:new messagesModel.Messages(),privateMessages:new messagesModel.Messages()});module.exports=new Actions();},function(module,exports,__webpack_require__){"use strict";var flux=__webpack_require__(7);var ButtonModel,Buttons;ButtonModel=flux.createModel({modelName:"Button",fieldTypes:{name:flux.FieldTypes.string,action:flux.FieldTypes.func,classNames:flux.FieldTypes.arrayOf(flux.FieldTypes.string)},getDefaultFields:function getDefaultFields(){return{action:function action(){return;},classNames:[]};}});Buttons=flux.createCollection({modelName:"Buttons",model:ButtonModel});module.exports={Button:ButtonModel,Buttons:Buttons};},function(module,exports){module.exports=(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])
return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports;}
__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0);})
([function(module,exports,__webpack_require__){"use strict";var fields=__webpack_require__(1).FieldTypes,collections=__webpack_require__(2),models=__webpack_require__(3);fields.model=fields.instanceOf(models.DataModel);fields.collection=fields.instanceOf(collections.DataCollection);module.exports={inherit:__webpack_require__(4).inherit,createActions:__webpack_require__(5),createAutoBinder:__webpack_require__(6),createModel:models,createCollection:collections.createCollection,List:__webpack_require__(7),settings:__webpack_require__(8),Emitter:__webpack_require__(9),FieldTypes:fields,backends:{local:__webpack_require__(10),XHRStorage:__webpack_require__(11)}};},function(module,exports,__webpack_require__){"use strict";var utils=__webpack_require__(4),list=__webpack_require__(7),chainablePrototype,OneOfField,InstanceOfField,ObjectOfField,OneOfTypeField,ArrayOfField;function PrimitiveChainable(){this.isEphemeral=false;this.defaultsTo=null;this.isRequired=false;this.newMe_=false;}
PrimitiveChainable.prototype.newify=function(ephemeral,defaults,required){var newMe;if(this.newMe_){newMe=this;}else{newMe=new this.constructor();newMe.newMe_=true;}
newMe.isEphemeral=ephemeral;newMe.defaultsTo=defaults;newMe.isRequired=required;return newMe;};PrimitiveChainable.prototype.ephemeral=function(){return this.newify(true,this.defaultsTo,this.isRequired);};PrimitiveChainable.prototype.required=function(){return this.newify(this.isEphemeral,this.defaultsTo,true);};PrimitiveChainable.prototype.defaults=function(defaults){return this.newify(this.isEphemeral,defaults,this.isRequired);};PrimitiveChainable.prototype.validate=function(){return false;};function BooleanField(){PrimitiveChainable.call(this);this.defaultsTo=false;}
utils.inherit(BooleanField,PrimitiveChainable);BooleanField.prototype.validate=function(value){return utils.isBoolean(value);};function NumberField(){PrimitiveChainable.call(this);this.defaultsTo=0;}
utils.inherit(NumberField,PrimitiveChainable);NumberField.prototype.validate=function(value){return utils.isNumber(value);};function StringField(){PrimitiveChainable.call(this);this.defaultsTo="";}
utils.inherit(StringField,PrimitiveChainable);StringField.prototype.validate=function(value){return utils.isString(value);};function FunctionField(){PrimitiveChainable.call(this);this.defaultsTo=null;}
utils.inherit(FunctionField,PrimitiveChainable);FunctionField.prototype.validate=function(value){return utils.isFunction(value);};function ObjectField(){PrimitiveChainable.call(this);this.defaultsTo={};}
utils.inherit(ObjectField,PrimitiveChainable);ObjectField.prototype.validate=function(value){return!utils.isArray(value)&&utils.isObject(value);};function ArrayField(){PrimitiveChainable.call(this);this.defaultsTo=[];}
utils.inherit(ArrayField,PrimitiveChainable);ArrayField.prototype.validate=function(value){return utils.isArray(value);};chainablePrototype={ephemeral:function(){this.isEphemeral=true;return this;},defaults:function(defaults){this.defaultsTo=defaults;return this;},required:function(){this.isRequired=true;return this;},validate:function(){return false;}};function extendChainableField(init,validate){function F(){}
F.prototype=Object.create(chainablePrototype);F.prototype.validate=validate;F.prototype.init=init;return F;}
OneOfField=extendChainableField(function OneOfField(enum_){if(!utils.isArray(enum_)){throw new Error("Enums require an array");}
this.defaultsTo=null;this.enum_=enum_;this.isEphemeral=false;this.isRequired=false;return this;},function OneOfField_validate(value){for(var i=0;i<this.enum_.length;i++){if(this.enum_[i]===value){return true;}}
return false;});InstanceOfField=extendChainableField(function InstanceOfField(klass){if(!klass||!klass.prototype||!klass.prototype.isPrototypeOf){throw new Error("I need a klass (constructor)");}
this.defaultsTo=null;this.isEphemeral=false;this.isRequired=false;this.proto_=klass.prototype;return this;},function InstanceOfField_validate(value){return this.proto_.isPrototypeOf(value);});OneOfTypeField=extendChainableField(function OneOfTypeField(ones){this.defaultsTo=null;this.isEphemeral=false;this.isRequired=false;this.ones_=ones;if(!utils.isArray(ones)){throw new Error("I need an array of fields");}
return this;},function validate(value){for(var i=0;i<this.ones_.length;i++){if(this.ones_[i].validate(value)){return true;}}
return false;});ArrayOfField=extendChainableField(function ArrayOfField(field){if(!field||!field.validate){throw new Error("I need a field");}
this.field=field;this.defaultsTo=field.defaults;this.isEphemeral=false;this.isRequired=false;return this;},function validate(value){if(!utils.isArray(value)){return false;}
for(var i=0;i<value.length;i++){if(!this.field.validate(value[i])){return false;}}
return true;});ObjectOfField=extendChainableField(function ObjectOfField(field){if(!field||!field.validate){throw new Error("I need a field");}
this.field=field;this.isEphemeral=false;this.isRequired=false;return this;},function _validate(value){var keys,key,i,validate=this.field.validate;if(!utils.isObject(value)){return false;}
keys=Object.keys(value);for(i=0;i<keys.length;i++){key=keys[i];if(!Object.hasOwnProperty.call(value,key)){continue;}
if(!validate(value[key])){return false;}}
return true;});function checkType(Model,props,propName,componentName){var prop=props[propName];if(utils.isNull(prop)){return;}
if(Model.prototype.isPrototypeOf(prop)){return new Error("Validation failed: "+propName+" "+componentName);}}
function createChainableField(f){return f.init.bind(f);}
module.exports={FieldTypes:{array:new ArrayField(),bool:new BooleanField(),func:new FunctionField(),list:list,number:new NumberField(),object:new ObjectField(),arrayOf:createChainableField(new ArrayOfField()),instanceOf:createChainableField(new InstanceOfField()),objectOf:createChainableField(new ObjectOfField()),oneOf:createChainableField(new OneOfField()),oneOfType:createChainableField(new OneOfTypeField()),string:new StringField()},checkType:checkType};},function(module,exports,__webpack_require__){"use strict";var utils=__webpack_require__(4),settings=__webpack_require__(8),data_emitter=__webpack_require__(12);function DataCollection(data){data_emitter.DataEmitter.call(this);this.eventIds={};this.data={collection:{},order:[]};Object.seal(this.data);this.set(data);}
utils.inherit(DataCollection,data_emitter.DataEmitter);DataCollection.prototype.add=function(model){if(this.add_(model)){this.update(this.model.modelName);}};DataCollection.prototype.add_=function(model,index){var data=this.data;if(utils.isUndefined(index)){index=this.length;}
if(data.collection.hasOwnProperty(model.id)){data.collection[model.id].set(model.valueOf());return data.collection[model.id];}
if(!this.validate_(model)){try{model=new this.model(model);}catch(e){if(!this.strict){return false;}
throw e;}}
data.order.splice(index,0,model.id);data.collection[model.id]=model;model.on(function(name){this.update(this.model.modelName+"."+name);},this);return model;};DataCollection.prototype.insert=function(model,index){this.add_(model,index);this.update(this.model.modelName);};DataCollection.prototype.remove=function(id){var item;item=this.remove_(id);this.update(this.model.modelName);return item;};DataCollection.prototype.sort=function(){var collection=this.data.collection,sort_=this.sort_.bind(this);this.data.order.sort(function(a,b){return sort_(collection[a],collection[b]);});};DataCollection.prototype.splice=function(index,howMany){var elements,removed,collection=this.data.collection;this.silent_=true;if(utils.isUndefined(howMany)){howMany=this.length;}
removed=this.data.order.splice(index,howMany);removed=utils.map(removed,function(id){var model=collection[id];if(!model){return;}
delete collection[id];model.off(this.eventIds[id]);delete this.eventIds[id];return model;},this);elements=utils.toArray(arguments).slice(2);utils.each(elements,function(elem){this.add_(elem,index);index++;},this);this.silent_=false;this.update(this.fieldName||this.model.modelName);return removed;};DataCollection.prototype.sort_=function(a,b){if(a.id<b.id){return-1;}
if(b.id<a.id){return 1;}
return 0;};DataCollection.prototype.remove_=function(id){var index,model,data=this.data;model=data.collection[id];if(!model){return;}
delete data.collection[id];model.off(this.eventIds[id]);delete this.eventIds[id];index=data.order.indexOf(id);if(index!==-1){data.order.splice(index,1);}
return model;};DataCollection.prototype.getRawData=function(){return this.data.collection;};DataCollection.prototype.set=function(models){var collection,newCollection={},newOrder=[];this.silent_=true;if(!utils.isArray(models)){throw new Error("You must pass set an array of raw data or instances");}
utils.each(models,function(model){model=this.add_(model);if(model===false){return;}
newCollection[model.id]=model;},this);collection=this.data.collection;this.data.order.forEach(function(id){if(id in newCollection){newOrder.push(id);return;}
collection[id].off(this.eventIds[id]);delete this.eventIds[id];},this);this.data.collection=newCollection;this.data.order=newOrder;this.silent_=false;this.update(this.fieldName||this.model.modelName);return this.length;};DataCollection.prototype.reset=function(){utils.each(Object.keys(this.data.collection),function(id){this.remove_(id);},this);};DataCollection.prototype.map=function(f,opt_thisArg){var collection=this.data.collection;return this.data.order.map(function(id,index){return f.call(opt_thisArg,collection[id],id,index);});};DataCollection.prototype.forEach=function(f,opt_thisArg){var collection=this.data.collection;this.data.order.map(function(id,index){f.call(opt_thisArg,collection[id],index);});};DataCollection.prototype.reduce=function(f,accumulator,opt_thisArg){var collection=this.data.collection;return this.data.order.reduce(function(result,item,index){return f.call(opt_thisArg,result,collection[item],index);},accumulator);};DataCollection.prototype.get=function(id){return this.data.collection[id];};DataCollection.prototype.byIndex=function(index){if(index<0){index=this.length+index;}
return this.data.collection[this.data.order[index]];};DataCollection.prototype.valueOf=function(){return this.map(function(value){return(utils.isUndefined(value)||utils.isNull(value))?value:value.valueOf();});};DataCollection.prototype.save=function(key,id){if(!this.backend){throw new Error("you must specify a backend");}
return this.backend.save(key,this,id);};DataCollection.prototype.find=function(f,opt_thisArg){var id,collection=this.data.collection;id=utils.each(this.data.order,function(id,index){return(f.call(opt_thisArg,collection[id],index)===true?false:null);});return collection[id];};Object.defineProperty(DataCollection.prototype,"length",{get:function getLength(){return this.data.order.length;}});function createCollection(options){if(!options.model){throw new Error("I need a model",options.modelName);}
function Collection(opt_list){var defaults,list;list=opt_list||[];this.model=options.model;this.validate_=this.model.prototype.isPrototypeOf.bind(this.model.prototype);this.modelName=options.modelName||"Collection";defaults=utils.isFunction(options.getDefaultFields)?options.getDefaultFields():[];DataCollection.call(this,defaults);list.forEach(function(data){this.add(this.model.prototype.isPrototypeOf(data)?data:new this.model(data));},this);if(utils.isFunction(this.init)){this.init.apply(this,arguments);}}
utils.inherit(Collection,DataCollection);Collection.prototype.model=options.model;Collection.load=function(key,id,cb){if(!options.backend){throw new Error("you must specify a backend");}
if(!utils.isFinite(id)){id=key;key="";}
return options.backend.load(key,Collection,id,cb);};utils.each(options,function(property,name){if(utils.contains(['model','modelName'],name)){return;}
if(name==="sort"){if(!utils.isFunction(property)){throw new Error("The sort property must be a function");}
Collection.prototype.sort_=property;return;}
if(utils.has(Collection.prototype,name)){throw new Error("Collection "+options.modelName+" already has property "+name);}
Collection.prototype[name]=property;});return Collection;}
module.exports={DataCollection:DataCollection,createCollection:createCollection};},function(module,exports,__webpack_require__){"use strict";var fieldRegex=/(\w+)/,utils=__webpack_require__(4),data_emitter=__webpack_require__(12),fields=__webpack_require__(1).FieldTypes,isDataEmitter=data_emitter.isDataEmitter;function DataModel(opt_data){data_emitter.DataEmitter.call(this);this.data={};this.eventIds={};}
utils.inherit(DataModel,data_emitter.DataEmitter);DataModel.prototype.save=function(key,cb){if(!this.backend){throw new Error("you must specify a backend");}
return this.backend.save(key,this,this.id,cb);};DataModel.prototype.set=function(d,options){var changed=[];this.silent_=true;utils.each(d,function(dataValue,propertyName){if(!utils.has(this.schema,propertyName)){return;}
this[propertyName]=dataValue;changed.push(propertyName);},this);this.silent_=false;if(options&&options.silent){return;}
this.update(changed);};DataModel.prototype.valueOf=function(){var v={};utils.each(this.nonEphemeralFields,function(field){var value=this.data[field];if(utils.isUndefined(value)||utils.isNull(value)){return value;}
v[field]=value.valueOf();},this);return v;};DataModel.prototype.bindToField=function(field,fieldName){this.eventIds[fieldName]=field.on(function(name){this.update(fieldName);},this);};module.exports=DataModel;function createModel(options){var id_=0,fieldTypes,modelName,nonEphemeralFields;if(!utils.isObject(options)){throw new Error("options with prototypes are required to make a DataModel");}
fieldTypes=options.fieldTypes||{};modelName=options.modelName||"Model";function Model(opt_data){var defaults,data;DataModel.call(this);data=opt_data||{};this.modelName=modelName;this.backend=options.backend;if(options.getDefaultFields&&utils.isFunction(options.getDefaultFields)){defaults=options.getDefaultFields();}else{defaults={};}
defaults.id=defaults.id||id_++;this.silent_=true;utils.each(this.schema,function(Field,fieldName){var defaultValue=utils.has(data,fieldName)?data[fieldName]:defaults[fieldName];if(isDataEmitter(Field.prototype)){if(!defaultValue){this[fieldName]=new Field();return;}
if(!defaultValue.isPrototypeOf(Field)){this[fieldName]=new Field(defaultValue);return;}
this[fieldName]=defaultValue;return;}
if(utils.has(data,fieldName)||utils.has(defaults,fieldName)){this[fieldName]=defaultValue;return;}
if(Field.isRequired){throw new Error("The field "+fieldName+" is required according to you!");}
this[fieldName]=Field.defaultsTo;},this);this.silent_=false;Object.seal(this.data);if(utils.isFunction(this.init)){this.init.apply(this,arguments);}}
utils.inherit(Model,DataModel);if(!utils.has(fieldTypes,"id")){fieldTypes.id=fields.number;}
Object.seal(fieldTypes);Model.prototype.schema=fieldTypes;Model.modelName=modelName;Model.load=function(key,id){if(!options.backend){throw new Error("you must specify a backend");}
if(!utils.isFinite(id)){id=key;key="";}
return options.backend.load(key,Model,id);};nonEphemeralFields=[];utils.each(fieldTypes,function(fieldType,fieldName){if(!fieldType){throw new Error("The field '"+fieldName+"' is invalid for '"+modelName+"'.");}
if(!fieldType.isEphemeral){nonEphemeralFields.push(fieldName);}
Object.defineProperty(Model.prototype,fieldName,{get:function(){return this.data[fieldName];},set:function(v){var err,current=this.data[fieldName],isEmitter=isDataEmitter(v),wasEmitter=isDataEmitter(current);this.validate(v,fieldName);if(!wasEmitter&&!isEmitter){this.data[fieldName]=v;return this.update(fieldName);}
if(wasEmitter&&isEmitter){this.data[fieldName]=v;current.off(this.eventIds[fieldName]);this.bindToField(v,fieldName);return this.update(fieldName);}
if(wasEmitter&&!isEmitter){current.set(v);return this.update(fieldName);}
this.data[fieldName]=v;this.bindToField(v,fieldName);this.update(fieldName);},});});Object.freeze(nonEphemeralFields);Model.prototype.nonEphemeralFields=nonEphemeralFields;utils.each(options,function(property,name){if(utils.contains(['fieldTypes','getDefaultFields','modelName'],name)){return;}
if(utils.has(Model.prototype,name)){throw new Error("Model "+options.modelName+" already has property "+name);}
Model.prototype[name]=property;});return Model;}
createModel.DataModel=DataModel;module.exports=createModel;},function(module,exports,__webpack_require__){(function(global){"use strict";var _isFinite,MAX_SAFE_INTEGER=Math.pow(2,53)-1;if(typeof global!=="undefined"){_isFinite=global.isFinite;}else if(typeof window!=="undefined"){_isFinite=window.isFinite;}else if(typeof self!=="undefined"){_isFinite=self.isFinite;}else{}
function assign_(object,source){var index=-1,key,props=Object.keys(source),length=props.length;while(++index<length){key=props[index];object[key]=source[key];}
return object;}
function contains(collection,target){var length=collection?collection.length:0,index=-1;if(isFunction(collection.indexOf)){return collection.indexOf(target)>=0;}
if(!(hasLength(length))){collection=values(collection);length=collection.length;}
while(++index<length){if(collection[index]===target){return true;}}
return false;}
function map(collection,iter,self){var data={};if(collection.map){return collection.map(iter,self);}
each(collection,function(item,key){data[key]=iter.call(self,item,key);});return data;}
function each(collection,iter,self){var index=-1,keys_,length=collection?collection.length:0;if(!(hasLength(length))){keys_=keys(collection);length=keys_.length;while(++index<length){var key=keys_[index];if(iter.call(self,collection[key],key,collection)===false){return collection[key];}}}
while(++index<length){if(iter.call(self,collection[index],index,collection)===false){return collection[index];}}}
function extend(){var length=arguments.length,object=arguments[0],i=0;while(++i<length){assign_(object,arguments[i]);}
return object;}
function has(object,key){return object?Object.hasOwnProperty.call(object,key):false;}
function hasLength(length){return(typeof length=='number'&&length>-1&&length<=MAX_SAFE_INTEGER);}
function inherit(c,sc){c.prototype=Object.create(sc.prototype,{});c.prototype.super_=sc;c.super_=sc;c.prototype.constructor=c;}
function isArray(a){return Array.isArray(a);}
function isBoolean(a){return typeof(a)==="boolean";}
function isFinite(a){return typeof(a)==="number"&&_isFinite(a);}
function isFunction(a){return typeof(a)==="function";}
function isNull(a){return a===null;}
function isNumber(a){return typeof(a)==="number";}
function isString(a){return typeof(a)==="string";}
function isObject(a){var type=typeof a;return type==='function'||(a&&type==='object')||false;}
function isUndefined(a){return typeof(a)==="undefined";}
function keys(a){try{return Object.keys(a);}catch(unused){}
return[];}
function size(a){if(a&&isFinite(a.length)&&a.length>=0){return a.length;}
return Object.keys(a).length;}
function toArray(a){var length=a?a.length:0;if(hasLength(length)&&isFunction(a.slice)){return a.slice();}
return values(a);}
function values(a){var i=-1,keys_=keys(a),length=keys_.length,v=[];while(++i<length){v.push(a[keys_[i]]);}
return v;}
module.exports={contains:contains,each:each,extend:extend,has:has,inherit:inherit,isArray:isArray,isBoolean:isBoolean,isFinite:isFinite,isFunction:isFunction,isNull:isNull,isNumber:isNumber,isString:isString,isObject:isObject,isUndefined:isUndefined,map:map,keys:keys,size:size,toArray:toArray,values:values,};}.call(exports,(function(){return this;}())))},function(module,exports,__webpack_require__){"use strict";var utils=__webpack_require__(4),Emitter=__webpack_require__(9);function createActions(actions){var properties={};function Action_(){Action_.super_.call(this);utils.each(actions,function(theAction,actionName){var eventName=actionName.toUpperCase();if(!utils.isFunction(theAction)){this[actionName]=theAction;return;}
this.fields_.push(eventName);theAction.name_=eventName;this["on"+eventName]=this.on.bind(this,eventName);if(actionName.indexOf("async")!==0){this[actionName]=function action_action(){var ret=theAction.apply(this,arguments);if(ret instanceof Error){return ret;}
this.emit.apply(this,[eventName].concat(ret));return null;}.bind(this);return;}
this[actionName]=function action_action(){var args=utils.toArray(arguments),cb=args.pop(),ret,that=this;if(!utils.isFunction(cb)){that=cb;cb=args.pop();}
if(!utils.isFunction(cb)){throw new Error("I take a callback or callback, this as final arguments");}
ret=theAction.apply(this,arguments);if(ret instanceof Error){return ret;}
this.emitAsync.call(this,cb.bind(that,ret),eventName,ret);return null;}.bind(this);return;},this);if(utils.isFunction(this.init)){this.init.apply(this,arguments);}}
utils.inherit(Action_,Emitter);properties={on:{value:function(event,listener,opt_thisArg){if(utils.isString(event)&&!utils.contains(this.fields_,event)){throw new Error("event "+event+" is not a valid event ");}
return Emitter.prototype.on.apply(this,arguments);}},};utils.each(actions,function(theAction,actionName){var eventName;if(theAction==="init"){return;}
eventName=actionName.toUpperCase();properties[eventName]={get:function eventGetter(){return eventName;},enumerable:true};});Object.defineProperties(Action_.prototype,properties);Action_.prototype.fields_=[];return Action_;}
module.exports=createActions;},function(module,exports,__webpack_require__){"use strict";var utils=__webpack_require__(4),isDataEmitter=__webpack_require__(12).isDataEmitter,settings=__webpack_require__(8);function getModels(propPaths,props,componentName){return propPaths.map(function(propPath){var i,model,paths;model=props;paths=propPath.split(".");for(i=0;i<paths.length;i++){model=model[paths[i]];if(!model)break;}
if(!model&&settings.debug){throw new Error("No model found for "+propPath+" "+componentName);}
return model;});}
function createAutoBinder(propPaths,models){var mixin,boundIds_={};if(utils.isUndefined(propPaths)&&utils.isUndefined(models)){throw new Error("I require propPaths or models");}
if(!utils.isArray(models)){models=[];}
mixin={componentDidMount:function(){var update=function(name,modelName){var owner=this._owner,componentName="unknown";if(!this.isMounted()){return;}
while(owner){componentName=owner.componentName;if(componentName){break;}
owner=owner._owner;}
console.log("force updating "+name+" of "+componentName+" because of "+modelName);this.forceUpdate();};getModels(propPaths,this.props,this.componentName).concat(models).forEach(function(model){if(isDataEmitter(model)){boundIds_[model.on(update.bind(this,this.componentName,model.modelName))]=model;}},this);},componentWillUnmount:function(){utils.each(boundIds_,function(model,id){model.off(id);});}};return mixin;}
module.exports=createAutoBinder;},function(module,exports,__webpack_require__){var utils=__webpack_require__(4),data_emitter=__webpack_require__(12),ARRAY_MUTATORS=["fill","pop","push","reverse","shift","sort","splice","unshift"];function List(name,opt_data){data_emitter.DataEmitter.apply(this,arguments);this.modelName=name;this.collection=[];if(!opt_data){opt_data=name;name="List";}
utils.each(opt_data||[],function(item){this.collection.push(item);},this);}
utils.inherit(List,data_emitter.DataEmitter);utils.each(Object.getOwnPropertyNames(Array.prototype),function(name){var f=Array.prototype[name];if(!utils.isFunction(f)){return;}
if(!utils.contains(ARRAY_MUTATORS,name)){List.prototype[name]=function(){return f.apply(this.collection,arguments);};return;}
List.prototype[name]=function(){var ret=f.apply(this.collection,arguments);this.update();return ret;};});Object.defineProperty(List.prototype,"length",{get:function length(){return this.collection.length;}});List.prototype.update=function(){this.super_.prototype.update.call(this);};List.prototype.get=function(index){return this.collection[index];};List.prototype.set=function(values,options){this.collection=values;if(!options||options.silent!==true){this.update();}};List.prototype.toggle=function(value){if(this.collection.indexOf(value)===-1){this.collection.push(value);return true;}
this.collection=this.collection.filter(function(currentValue){return currentValue!=value;});return false;};List.prototype.valueOf=function(){return utils.map(this.collection,function(value){return(utils.isUndefined(value)||utils.isNull(value))?value:value.valueOf();});};module.exports=List;},function(module,exports,__webpack_require__){"use strict";var settings={debug:false,namespace:"",};Object.seal(settings);module.exports=settings;},function(module,exports,__webpack_require__){var utils=__webpack_require__(4);function Emitter(){this.count=0;this.on_={};this.all_={};}
Emitter.prototype.on=function(opt_event,listener,opt_thisArg){if(utils.isFunction(opt_event)){this.all_[++this.count]=listener?opt_event.bind(listener):opt_event;return this.count;}
if(!utils.has(this.on_,opt_event)){this.on_[opt_event]={};}
this.on_[opt_event][++this.count]=opt_thisArg?listener.bind(opt_thisArg):listener;return this.count;};Emitter.prototype.emit=function(event){var args;args=utils.toArray(arguments);utils.each(this.all_,function(l){l.apply(null,args);},this);args.shift();utils.each((this.on_[event]||{}),function(l,k){l.apply(null,args);},this);};Emitter.prototype.emitAsync=function(cb,event,args){var events=this.on_[event]||{},async=utils.size(events)+utils.size(this.all_);args=[args].concat(function popAsync(){if(async===0){throw new Error("cb fired more than once");}
async-=1;if(async===0){return cb&&cb();}});utils.each(this.all_,function(l){l.apply(null,args);},this);utils.each(events,function(l,k){l.apply(null,args);},this);};Emitter.prototype.off=function(opt_event_or_id){if(utils.isNumber(opt_event_or_id)){delete this.all_[opt_event_or_id];utils.each(this.on_,function(events,event){delete events[opt_event_or_id];});return;}
if(utils.isString(opt_event_or_id)){delete this.on_[opt_event_or_id];return;}
if(utils.isUndefined(opt_event_or_id)){this.all_={};this.on_={};return;}
throw new Error("WTF is "+opt_event_or_id+" ?");};module.exports=Emitter;},function(module,exports,__webpack_require__){"use strict";var utils=__webpack_require__(4),settings=__webpack_require__(8),localStorage;try{localStorage=window.localStorage;}catch(e){localStorage={};}
function LocalStorage(){}
LocalStorage.prototype.supported=function(){try{return'localStorage'in window&&window.localStorage!==null;}catch(e){return false;}};LocalStorage.prototype.getKey=function(namespace,model,id){return"floobits::"+(namespace||settings.namespace)+"::"+model.modelName+"::"+(id||model.id);};LocalStorage.prototype.save=function(namespace,model,id,cb){var key=this.getKey(namespace,model,id);try{localStorage[key]=JSON.stringify(model.valueOf());}catch(e){if(utils.isFunction(cb)){cb(e);return e;}}};LocalStorage.prototype.load=function(namespace,model,id,cb){var cereal,data,key=this.getKey(namespace,model,id);if(!utils.isFunction(cb)){cb=function(){};}
cereal=localStorage[key];if(!cereal){return cb(new Error("No data to load"));}
try{data=JSON.parse(cereal);}catch(e){console.warn(e);cb(e);return e;}
if(!utils.isFinite(model.id)&&!(model.id&&model.id.length)){model=new model(data);cb(null,model);return model;}
model.set(data);cb(null,model);return model;};module.exports=new LocalStorage();},function(module,exports,__webpack_require__){var utils=__webpack_require__(4),settings=__webpack_require__(8);function XHRStorage(getUrl){this.getUrl=getUrl;}
XHRStorage.prototype.supported=function(){return(typeof $!=="undefined")&&$.ajax;};XHRStorage.prototype.getUrl=function(namespace,model,id){var getUrl=model.getUrl||(model.prototype&&model.prototype.getUrl),getPath=model.getPath||(model.prototype&&model.prototype.getPath);if(utils.isFunction(getUrl)){return getUrl.call(model,id,namespace);}
if(namespace||settings.namespace){return(namespace||settings.namespace)+getPath.call(model,id,namespace);}
return window.location.protocol+"//"+window.location.host+getPath.call(model,id,namespace);};XHRStorage.prototype.save=function(namespace,model,id,cb){var data;try{data=JSON.stringify(model.valueOf());}catch(e){if(typeof cb!=="function"){cb(e);return e;}}
return $.ajax({data:data,url:this.getUrl(namespace,model),method:"post",complete:function(xhr,status){if(status==="error"){return cb(xhr);}else{return cb(null,xhr);}}});};XHRStorage.prototype.parse=function(model,data,id){model.set(data);};XHRStorage.prototype.load=function(namespace,model,id,cb){var isInstance=utils.isFinite(model.id)||(model.id&&model.id.length);if(typeof cb!=="function"){cb=function(){};}
return $.ajax({url:this.getUrl(namespace,model,id),method:"get",error:cb,success:(function(data){if(model.parse){return cb(null,model.parse(model,data,id));}
this.parse(model,data,id);return;}.bind(this)),});};module.exports=XHRStorage;},function(module,exports,__webpack_require__){var Emitter=__webpack_require__(9),utils=__webpack_require__(4),settings=__webpack_require__(8);function DataEmitter(){this.recursing_=false;this.silent_=false;Emitter.call(this);this.fieldName=null;}
utils.inherit(DataEmitter,Emitter);DataEmitter.prototype.validate=function(field){var err;if(settings.debug){err=this.schema[field](this.data,field,this.modelName);if(err)throw err;}};DataEmitter.prototype.load=function(key,cb){if(!this.backend){throw new Error("you must specify a backend");}
return this.backend.load(key,this,this.id,cb);};DataEmitter.prototype.update=function(fields){if(this.silent_||this.recursing_){return;}
this.recursing_=true;if(this.didUpdate(fields)===false){return;}
this.recursing_=false;this.emit.apply(this,arguments);};DataEmitter.prototype.didUpdate=function(){return true;};function isDataEmitter(value){return DataEmitter.prototype.isPrototypeOf(value);}
module.exports={DataEmitter:DataEmitter,isDataEmitter:isDataEmitter,};}])},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var flux=__webpack_require__(7);var util=__webpack_require__(9);var LEVEL_TO_STRING={};var id=0;var LEVEL={INFO:0,SUCCESS:1,WARNING:2,ERROR:3};_.each(LEVEL,function(v,k){LEVEL_TO_STRING[v]=k.toLowerCase();});var Message=flux.createModel({modelName:"Message",fieldTypes:{id:flux.FieldTypes.number,username:flux.FieldTypes.string,msg:flux.FieldTypes.string,type:flux.FieldTypes.string,level:flux.FieldTypes.number,time:flux.FieldTypes.number,tags:flux.FieldTypes.array,buttons:flux.FieldTypes.collection},getDefaultFields:function getDefaultFields(){return{id:++id,time:Date.now(),tags:[]};}});Object.defineProperty(Message.prototype,"levelName",{get:function get(){return LEVEL_TO_STRING[this.level];}});Object.defineProperty(Message.prototype,"prettyTime",{get:function get(){var d=util.formatDate(new Date(this.time));return d.hour+":"+d.minute+" "+d.meridian;}});var Messages=flux.createCollection({modelName:"Messages",model:Message,didUpdate:function didUpdate(){this.splice(1000);}});module.exports={LEVEL:LEVEL,Message:Message,Messages:Messages};},function(module,exports){"use strict";var util={},LANGS,extensions_to_mime,highlightColors;extensions_to_mime={"bmp":"bmp","cgm":"cgm","g3":"g3fax","gif":"gif","ief":"ief","jp2":"jp2","jpeg":"jpeg","jpg":"jpeg","jpe":"jpeg","pict":"pict","pic":"pict","pct":"pict","png":"png","btif":"prs.btif","svg":"svg+xml","svgz":"svg+xml","tiff":"tiff","tif":"tiff","psd":"vnd.adobe.photoshop","djvu":"vnd.djvu","djv":"vnd.djvu","dwg":"vnd.dwg","dxf":"vnd.dxf","fbs":"vnd.fastbidsheet","fpx":"vnd.fpx","fst":"vnd.fst","mmr":"vnd.fujixerox.edmics-mmr","rlc":"vnd.fujixerox.edmics-rlc","mdi":"vnd.ms-modi","npx":"vnd.net-fpx","wbmp":"vnd.wap.wbmp","xif":"vnd.xiff","ras":"x-cmu-raster","cmx":"x-cmx","ico":"x-icon","pntg":"x-macpaint","pnt":"x-macpaint","mac":"x-macpaint","pcx":"x-pcx","pnm":"x-portable-anymap","pbm":"x-portable-bitmap","pgm":"x-portable-graymap","ppm":"x-portable-pixmap","qtif":"x-quicktime","qti":"x-quicktime","rgb":"x-rgb","xbm":"x-xbitmap","xpm":"x-xpixmap","xwd":"x-xwindowdump"};highlightColors=["lime","black","blue","darkblue","fuchsia","gray","green","greenyellow","indigo","magenta","midnightblue","maroon","orange","orangered","purple","red","teal","yellow"];util.USERNAME_TO_COLOR={};util.userColor=function(username){var user_color=util.USERNAME_TO_COLOR[username];if(user_color){return user_color;}
var i=_.reduce(util.md5(username),function(memo,c){return memo+c.charCodeAt(0);},0);return highlightColors[i%highlightColors.length];};util.css_escape=function(css){var escaped=Base64.encode(css).replace(/\=/g,"");return escaped;};util.image_mime_from_extension=function(name){var extension=name.split(".").slice(-1);try{extension=extension[0].toLowerCase();return extensions_to_mime[extension];}catch(e){console.log("image_mime_from_extension:",e);}
return null;};util.is_binary=function(bytes,size){var i,max_bytes=1024,suspicious_bytes=0,total_bytes;if(size===0){return false;}
total_bytes=Math.min(size,max_bytes);if(size>=3&&bytes[0]===0xEF&&bytes[1]===0xBB&&bytes[2]===0xBF){return false;}
for(i=0;i<total_bytes;i++){if(bytes[i]===0){return true;}
if((bytes[i]<7||bytes[i]>14)&&(bytes[i]<32||bytes[i]>127)){if(bytes[i]>191&&bytes[i]<224&&i+1<total_bytes){i++;if(bytes[i]<192){continue;}}else if(bytes[i]>223&&bytes[i]<239&&i+2<total_bytes){i++;if(bytes[i]<192&&bytes[i+1]<192){i++;continue;}}
suspicious_bytes++;if(i>32&&suspicious_bytes*100/total_bytes>10){return true;}}}
if(suspicious_bytes*100/total_bytes>10){return true;}
return false;};util.md5=function(data){var md5=CryptoJS.MD5;if(!_.isString(data)){data=CryptoJS.lib.WordArray.create(data);}
return md5(data).toString(CryptoJS.enc.Hex);};util.padNum=function(padNum){var n;n=padNum.toString(10);if(n.length<2){return"0"+n;}
return n;};util.formatDate=function(date){var months,month,day,hour,h,minute,second,formatted,type="",year,oneyear,oneminute,alongtimeago,ashortimeago;months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];oneminute=1000*60;oneyear=oneminute*60*60*24*365;month=months[date.getMonth()];h=date.getHours();year=date.getFullYear();hour=util.padNum(h);day=util.padNum(date.getDate());minute=util.padNum(date.getMinutes());second=util.padNum(date.getSeconds());alongtimeago=date.getTime()<new Date().getTime()-oneyear;ashortimeago=date.getTime()>new Date().getTime()-oneminute*3;formatted=[month," ",alongtimeago?year+" ":"",day," ",hour,":",minute,ashortimeago?":"+second:""," ",type].join("");return{date:date,formatted:formatted,month:month,day:day,hour:hour,minute:minute,second:second,type:type,year:year,alongtimeago:alongtimeago,ashortimeago:ashortimeago,meridian:h<12?"AM":"PM"};};LANGS={apab:["apab"],asciidoc:["asciidoc"],applescript:["AppleScript","scpt"],c_cpp:["c","cc","cpp","cxx","h","hh","hpp","p","pwn"],clojure:["clj","cljs"],coffee:["Cakefile","coffee","cf","cson"],coldfusion:["cfm"],csharp:["cs"],css:["css"],curly:["curly"],dart:["dart"],diff:["diff","patch"],dot:["dot"],glsl:["frag","glsl","vert"],golang:["go"],groovy:["groovy"],haml:["haml","hml"],haskell:["hs"],haxe:["hx"],html:["htm","html","xhtml"],jade:["jade"],java:["java","pde"],javascript:["js"],json:["json"],jsp:["jsp"],jsx:["jsx"],latex:["latex","tex","ltx","bib"],less:["less"],liquid:["liquid"],lisp:["el","lisp"],lua:["lua"],luapage:["lp"],makefile:["Makefile","make"],markdown:["md","markdown"],objectivec:["m","mm"],ocaml:["ml","mli"],pascal:["pas","pascal"],perl:["pl","pm"],pgsql:["pgsql","psql"],php:["php","phtml","tpl"],powershell:["ps1"],python:["py"],r:["r"],rdoc:["rd","rdoc"],rhtml:["rhtml"],ruby:["ru","gemspec","rake","rb"],sass:["sass"],scad:["scad"],scala:["scala"],scss:["scss"],sh:["sh","bash","bat"],sql:["sql"],stylus:["styl","stylus"],svg:["svg"],tcl:["tcl"],tex:["tex"],text:["txt"],textile:["textile"],tm_snippet:["tmSnippet"],toml:["toml"],typescript:["str","ts","typescript"],vala:["vala","vapi"],vbscript:["vbs","vbe","wsf","wsc"],xml:["xml","rdf","rss","wsdl","xslt","atom","mathml","mml","xul","xbl"],xquery:["xq"],yaml:["yaml"]};util.modeForFile=function(path){var mode,parts,extension;mode="text";parts=path.split(".");if(parts.length>1){extension=_.last(parts);if(extension==="erb"&&parts.length>2){parts.pop();extension=_.last(parts);}
extension=extension.toLowerCase();_.each(LANGS,function(extensions,lang){if(_.includes(extensions,extension)){mode=lang;}});}
console.log("setting mode to",mode);return mode;};if(typeof Uint8ClampedArray!=="undefined"){util.Uint8ClampedArray=Uint8ClampedArray;}else if(typeof Uint8Array!=="undefined"){util.Uint8ClampedArray=Uint8Array;}else{util.Uint8ClampedArray=null;}
util.requestFullscreen=function(elem){if(elem.requestFullscreen){elem.requestFullscreen();}else if(elem.msRequestFullscreen){elem.msRequestFullscreen();}else if(elem.mozRequestFullScreen){elem.mozRequestFullScreen();}else if(elem.webkitRequestFullscreen){elem.webkitRequestFullscreen();}};util.exitFullscreen=function(){if(document.exitFullscreen){document.exitFullscreen();}else if(document.msExitFullscreen){document.msExitFullscreen();}else if(document.mozCancelFullScreen){document.mozCancelFullScreen();}else if(document.webkitExitFullscreen){document.webkitExitFullscreen();}};util.getFullscreenElement=function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement;};util.BROWSER_CLIENTS=["Atom","Chrome","Firefox","IE","Opera","Safari","web"];module.exports=util;},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var flux=__webpack_require__(7);var fieldTypes=flux.FieldTypes;var UserPref=flux.createModel({backend:flux.backends.local,followPaused:false,modelName:"UserPref",fieldTypes:{id:fieldTypes.string.defaults("UserPref"),theme:fieldTypes.string,sound:fieldTypes.bool.defaults(true),following:fieldTypes.bool,followUsers:fieldTypes.list,logLevel:fieldTypes.number,showNotifications:fieldTypes.bool,showImages:fieldTypes.bool.defaults(true),dnd:fieldTypes.bool,mugshots:fieldTypes.bool,audioOnly:fieldTypes.bool,canNotify:fieldTypes.bool.ephemeral()},getDefaultFields:function getDefaultFields(){var editorSettings=fl.editor_settings;return{theme:editorSettings.theme,sound:!!editorSettings.sound,following:!!editorSettings.follow_mode,logLevel:editorSettings.logLevel};},isFollowing:function isFollowing(username){if(this.followPaused){return false;}
if(_.isUndefined(username)){if(this.followUsers.length>0){return true;}
return this.following;}
if(this.followUsers.indexOf(username)!==-1){return true;}
return this.following;},pauseFollowMode:function pauseFollowMode(duration){var self=this;function resetFollowMode(){self.followPaused=false;delete self.pauseFollowTimeout;}
if(!this.following&&!this.followUsers.length){return;}
clearTimeout(this.pauseFollowTimeout);this.followPaused=true;this.pauseFollowTimeout=setTimeout(resetFollowMode,duration);},didUpdate:function didUpdate(field){if(field!=="showNotifications"){return;}
if(_.isArray(field)&&field.indexOf("showNotifications")===-1){return;}
this.requestNotificationPermission();},onNotificationPermission_:function onNotificationPermission_(permission){var canNotify=permission==="granted";if(canNotify===this.canNotify){return;}
this.set({canNotify:canNotify},{silent:true});this.save(fl.editor_settings.prefs_path);},requestNotificationPermission:function requestNotificationPermission(){if(!self.Notification||!_.isFunction(Notification.requestPermission)||!this.showNotifications){return;}
Notification.requestPermission(this.onNotificationPermission_.bind(this));}});var prefs=new UserPref(fl.editor_settings);prefs.load(fl.editor_settings.prefs_path);prefs.requestNotificationPermission();module.exports=prefs;},function(module,exports,__webpack_require__){"use strict";var modal=__webpack_require__(12);var ErrorView=React.createClass({mixins:[modal.ReactModalMixin],propTypes:{message:React.PropTypes.string},renderBody:function renderBody(){return React.createElement("p",{className:"alert-block alert-danger"},this.props.message);},renderFooter:function renderFooter(){return React.createElement("div",null,React.createElement("button",{className:"btn btn-default","data-dismiss":"modal"},"OK"));}});function show(message){modal.showModal(ErrorView,{message:message,title:"Floobits Error"});}
module.exports={show:show};},function(module,exports){"use strict";var el=void 0;var id=0;function killModal(){React.unmountComponentAtNode(el);}
function showModal(component,args){el=document.createElement("div");el.id="modal-id-"+ ++id;document.body.appendChild(el);React.render(React.createElement(component,args),el);}
var ReactModalMixin={componentDidMount:function componentDidMount(){if(el&&el.id!==this.getDOMNode().parentNode.id){killModal();}
if(!el){el=this.getDOMNode().parentNode;}
$(this.refs.modal.getDOMNode()).modal("show").on("hide.bs.modal",this.close);},close:function close(){if(this.isMounted()){killModal();}else{console.log("componenent isn't mounted. no-op");}},componentWillUnmount:function componentWillUnmount(){var node;node=$(this.refs.modal.getDOMNode());node.off("hide.bs.modal");node.modal("hide");el=null;},render:function render(){return React.createElement("div",{className:"modal",ref:"modal"},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},this.props.title||this.renderHeader&&this.renderHeader()),React.createElement("div",{className:"modal-body"},this.renderBody()),React.createElement("div",{className:"modal-footer"},this.renderFooter()))));}};var ReactModalView=React.createClass({mixins:[ReactModalMixin],propTypes:{body:React.PropTypes.string},renderBody:function renderBody(){return React.createElement("p",null,this.props.body);},renderFooter:function renderFooter(){return React.createElement("button",{className:"btn btn-primary","aria-hidden":"true","data-dismiss":"modal"},"OK");}});var ReactModalUnsafeView=React.createClass({mixins:[ReactModalMixin],propTypes:{body:React.PropTypes.string},renderBody:function renderBody(){return React.createElement("p",{dangerouslySetInnerHTML:{__html:this.props.body}});},renderFooter:function renderFooter(){return React.createElement("button",{className:"btn btn-primary","aria-hidden":"true","data-dismiss":"modal"},"OK");}});function showWithText(text,title){return showModal(ReactModalView,{body:text,title:title||""});}
function showWithUnsafeHTML(html,title){return showModal(ReactModalUnsafeView,{body:html,title:title||""});}
module.exports={showModal:showModal,showWithText:showWithText,showWithUnsafeHTML:showWithUnsafeHTML,ReactModalMixin:ReactModalMixin,killModal:killModal};},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var flux=__webpack_require__(7);var util=__webpack_require__(9);var editorAction=__webpack_require__(14);var handlerAction=__webpack_require__(15);var messageAction=__webpack_require__(5);var dmp=new DiffMatchPatch();var fields=flux.FieldTypes;var Buffer=flux.createModel({modelName:"Buffer",fieldTypes:{buf:fields.string,highlights:fields.array,id:fields.number,md5:fields.number,open:fields.bool,path:fields.string,visible:fields.bool,encoding:fields.string,populated:fields.bool},getDefaultFields:function getDefaultFields(){return{buf:null,encoding:"utf8"};}});Buffer.prototype.setGetBufTimeout=function(){var id=this.id;this.strike_timeout=setTimeout(function(){console.log("strikeout triggered because before md5s were different");handlerAction.get_buf(id);},1100);};Buffer.prototype.setSaveBufTimeout=function(){var id=this.id;clearTimeout(this.saveTimeout);this.saveTimeout=setTimeout(function(){handlerAction.save_buf(id);},2500);};Buffer.prototype.patch=function(patch_obj){var clean_patch=true,newTextPointer,i,md5_before,md5_after,patches,result,text;if(!this.populated){return;}
try{patches=dmp.patch_fromText(patch_obj.patch);}catch(e){throw new Error("Received Invalid bytes from workspace."+e.toString()+"Patch was: "+patch_obj.patch);}
console.debug("applying",patch_obj.patch,"to",patch_obj.path);md5_before=util.md5(this.buf);if(patch_obj.md5_before!==md5_before){console.log("starting md5s don't match! ours:",md5_before,"patch's:",patch_obj.md5_before);}
if(_.isEmpty(patches)){console.log("Got an empty set of patches.");return;}
try{result=dmp.patch_apply(patches,this.buf);}catch(e){console.sError("Patch apply error on web.",{patch:patches,buf:this.buf,result:result,subject:"Patch Apply Failed ",error:e,message:{description:"Patch apply failed"}});throw e;}
text=result[0];for(i=0;i<result[1].length;i++){if(result[1][i]!==true){clean_patch=false;break;}}
if(clean_patch===false){console.error("Couldn't apply patch. Getting buffer from server...",result);messageAction.log("Couldn't apply patch to buffer "+this.path+" Re-fetching buffer from server...");this.populated=false;clearTimeout(this.strike_timeout);handlerAction.get_buf(this.id);return;}
md5_after=util.md5(text);if(patch_obj.md5_before===md5_before&&patch_obj.md5_after!==md5_after){console.log("md5's don't match! buffer is",md5_after,"but we expected",patch_obj.md5_after);this.populated=false;clearTimeout(this.strike_timeout);handlerAction.get_buf(this.id);return;}
newTextPointer=[text];editorAction.patch(this.id,result,newTextPointer);this.set({"buf":newTextPointer[0]},{silent:true});if(this.buf===text){clearTimeout(this.strike_timeout);if(patch_obj.md5_after!==md5_after){this.setGetBufTimeout();}}else if(patch_obj.md5_before!==md5_before){clearTimeout(this.strike_timeout);this.setGetBufTimeout();}else{console.log("replacing didn't match :( should be",text,"but was",this.buf);try{console.log(dmp.patch_toText(dmp.patch_make(this.buf,text)));}catch(e){console.log("Error making patch of text --> this.buf:",e);}}};var Buffers=flux.createCollection({modelName:"Buffers",model:Buffer});module.exports={Buffer:Buffer,Buffers:Buffers};},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var flux=__webpack_require__(7);var line=null;var lastOpenedBuffer=null;var Actions=flux.createActions({kick:function kick(connectionID){return connectionID;},open:function open(bufferID,line_){var buf=this.buffers.get(bufferID);if(!buf){return new Error("No buffer with id "+bufferID);}
lastOpenedBuffer=buf;line=line_;return[buf,line_];},open_term:function open_term(id){var term=this.terminals.get(id);if(!term){return new Error("No terminal with id "+id+" was found");}
return term;},close_term:function close_term(id){var term=this.terminals.get(id);if(!term){return new Error("No terminal with id "+id+" was found");}
return term;},close:function close(bufferID){var buf=this.buffers.get(bufferID);if(!buf){return new Error("No buffer with id "+bufferID);}
if(buf===lastOpenedBuffer){lastOpenedBuffer=null;}
return buf;},close_last:function close_last(){return;},split_editor:function split_editor(type){return type;},unsplit_editor:function unsplit_editor(){return;},open_from_path:function open_from_path(path,line_){var buffer;buffer=this.buffers.find(function(buf){return buf.path===path;});if(!buffer){return new Error("Buffer not found: "+path);}
this.open(buffer.id,line_);return buffer;},create_buf:function create_buf(path,buf,type,switchToBuf){return[path,buf,type,switchToBuf];},created:function created(buf){return buf;},cursor:function cursor(buf,pos){return[buf,pos];},highlight:function highlight(bufferID,ranges,connectionID,username,summon){var buf=this.buffers.get(bufferID);if(!buf){return new Error("No buffer with id "+bufferID);}
return[buf,ranges,connectionID,username,summon];},remove_highlight:function remove_highlight(connectionID){return connectionID;},patch:function patch(bufferID,dmpPatchResult,newTextPointer){return[bufferID,dmpPatchResult,newTextPointer];},imagify:function imagify(buf){return buf;},new_file_prompt:function new_file_prompt(pathPrefix){return pathPrefix||"";},new_file:function new_file(path){var _this=this;var id;id=this.on(this.CREATED,function(buf){if(buf.path===path){_this.open(buf.id);_this.off(id);}});return path;},delete_buf:function delete_buf(bufferID){return bufferID;},download:function download(){var bufName,data,encoding;if(!lastOpenedBuffer){return;}
bufName=lastOpenedBuffer.path.split("/").slice(-1)[0];data=lastOpenedBuffer.buf;encoding="text/plain;charset=UTF-8";if(lastOpenedBuffer.encoding==="base64"){data=StringView.base64ToBytes(data);encoding="application/octet-stream";}
saveAs(new Blob([data],{type:encoding,endings:"transparent"}),bufName);return;},rename_prompt:function rename_prompt(){return;},start_rename_prompt:function start_rename_prompt(bufferId){var buffer=this.buffers.get(bufferId);if(!buffer){return new Error("Couldn't find buffer for buffer id: "+bufferId);}
return buffer.path;},rename_request:function rename_request(newPath){if(!lastOpenedBuffer){return null;}
lastOpenedBuffer.path=newPath;this.rename(lastOpenedBuffer);this.open(lastOpenedBuffer.id,line);return[lastOpenedBuffer,newPath];},rename:function rename(buf){return buf;},fullscreen:function fullscreen(){return;},follow:function follow(username){if(username){this.prefs.followUsers.toggle(username);return this.pref("followUsers",this.prefs.followUsers,true);}
return this.pref("following",!this.prefs.following);},summon:function summon(){return;},request_perms:function request_perms(){return;},pref:function pref(name,value,force){if(this.prefs[name]===value&&!force){return new Error("Preference "+name+" already has value "+value);}
this.prefs[name]=value;this.prefs.save(fl.editor_settings.prefs_path);return[this.prefs,name];},pull_repo:function pull_repo(repoType,repoURL,repoBranch){return[repoType,repoURL,repoBranch];},upload:function upload(){return;},open_default_buf:function open_default_buf(filetree){var keys,i,buffer,textfile,dirs=[],leaf;keys=Object.keys(filetree);for(i=0;i<keys.length;i++){leaf=filetree[keys[i]];if(_.isNumber(leaf)){buffer=this.buffers.get(leaf);if(!buffer){continue;}
if(buffer.path.split("/").pop().indexOf("README")!==-1){this.open(buffer.id);return true;}
if(!textfile&&buffer.encoding==="utf8"){textfile=buffer;}}else{dirs.push(leaf);}}
if(textfile){this.open(textfile.id);return true;}
for(i=0;i<dirs.length;i++){if(this.open_default_buf(dirs[i])){return null;}}
return false;},editor_settings:function editor_settings(){return;},tab_settings_change:function tab_settings_change(){return;}});Actions.prototype.set=function(buffers,terminals,prefs){this.buffers=buffers;this.terminals=terminals;this.prefs=prefs;};module.exports=new Actions();},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var flux=__webpack_require__(7);var Actions=flux.createActions({get_buf:function get_buf(bufferID){return bufferID;},patch_buf:function patch_buf(patchInfo){return patchInfo;},save_buf:function save_buf(bufferID){return bufferID;},send_highlight:function send_highlight(bufferID,ranges,following,summon){var buf=this.buffers.get(bufferID);if(!buf){return new Error("No buffer with bufferID "+bufferID);}
if(!buf.populated){return new Error("Buffer is not yet populated "+bufferID);}
if(_.isEqual([bufferID,ranges,following,summon],this.prevHighlight)){return new Error("Not sending duplicate highlight: "+this.prevHighlight);}
this.prevHighlight=[bufferID,ranges,following,summon];return[bufferID,ranges,following,summon];},send_message:function send_message(message){if(message){return message;}
return new Error("Empty message.");},update_perms:function update_perms(connectionID,perms){return[connectionID,perms];},emit_data_message:function emit_data_message(data,to){return[data,to];},broadcast_data_message:function broadcast_data_message(data){return data;},broadcast_data_message_for_perm:function broadcast_data_message_for_perm(data,permission){return[data,permission];},edit_permissions:function edit_permissions(){console.log("edit_permissions");return;},connection_joined:function connection_joined(connection){return connection;},ready:function ready(roomInfo){return roomInfo;},hangout:function hangout(){return;},set_temp_data:function set_temp_data(temp_data){return temp_data;}});Actions.prototype.setBuffers=function(buffers){this.buffers=buffers;};module.exports=new Actions();},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var AceDocument=ace.require("ace/document").Document;var EditSession=ace.require("ace/edit_session").EditSession;var UndoManager=ace.require("ace/undomanager").UndoManager;var AceRange=ace.require("ace/range").Range;var handlerAction=__webpack_require__(15);var prefs=__webpack_require__(10);var util=__webpack_require__(9);var editorAction=__webpack_require__(14);var flux=__webpack_require__(7);var dmp=new DiffMatchPatch();var AceEditorModel=flux.createModel({modelName:"AceEditor",fieldTypes:{id:flux.FieldTypes.number,ace:flux.FieldTypes.object.ephemeral(),tabs:flux.List,activeTab:flux.FieldTypes.number,activeBuf:flux.FieldTypes.number,terminals:flux.List,elem:flux.FieldTypes.object.ephemeral(),active:flux.FieldTypes.bool},getID:function getID(){return"editor_"+this.id;},getDefaultFields:function getDefaultFields(){var elem=document.createElement("div");return{elem:elem,ace:ace.edit(elem),terminals:new flux.List(),tabs:new flux.List()};},init:function init(){var _this=this;this.elem.setAttribute("id",this.getID());this.elem.className="ace_editor";editorAction.onOPEN_TERM(function(term){if(!_this.active){return;}
if(_this.terminals.indexOf(term)!==-1){return;}
_this.terminals.push(term);});editorAction.onCLOSE_TERM(function(term){if(!_this.active){return;}
console.log("before this.terminals",_this.terminals);_this.terminals.toggle(term);console.log("after this.terminals",_this.terminals);});}});var Editor=flux.createCollection({model:AceEditorModel,activeEditor:null,name:"Editor",handlers:{},docs:{},editorSessions:{},highlights:{},bufs:null,ignoreChanges:false,init:function init(unused,bufs){this.bufs=bufs;editorAction.on(function(event){var args=_.toArray(arguments).slice(1);switch(event){case editorAction.OPEN:this.openBuffer.apply(this,args);break;case editorAction.CLOSE:this.closeBuffer.apply(this,args);break;case editorAction.PATCH:this.patch.apply(this,args);break;case editorAction.HIGHLIGHT:this.highlight.apply(this,args);break;case editorAction.REMOVE_HIGHLIGHT:this.removeHighlight.apply(this,args);break;default:return;}},this);if(fl.editor_settings.patch_test){this.patchTestInterval=setInterval(this.patchTest.bind(this),2000);}},activateEditor:function activateEditor(model){this.activeEditor=model.id;this.silent_=true;this.map(function(editor){editor.active=editor.id===model.id;});this.silent_=false;},createEditor:function createEditor(){var model=new AceEditorModel();model.docs=this.docs;model.editorSessions=this.editorSessions;this.add(model);model.ace.on("focus",this.activateEditor.bind(this,model));this.activateEditor(model);},on_selectionChange:function on_selectionChange(buf,event,selection){editorAction.cursor(buf,selection.getCursor());if(this.ignoreChanges){return;}
var following=prefs.isFollowing();prefs.pauseFollowMode(2000);var iter=selection.getAllRanges();if(iter.length===0){iter=[selection.getRange()];}
var doc=selection.doc;var ranges=_.map(iter,function(r){return[doc.positionToIndex(r.start,0),doc.positionToIndex(r.end,0)];});handlerAction.send_highlight(buf.id,ranges,following);},removeHighlight:function removeHighlight(connectionID){var _this2=this;var highlights=this.highlights[connectionID];_.each(highlights,function(highlight){var es=_this2.editorSessions[highlight.bufID];if(!es){return;}
try{es.removeMarker(highlight.markerID);}catch(e){console.log(e);}});this.highlights[connectionID]=[];},on_documentChange:function on_documentChange(bufID,change,doc){var buf,patches,patchInfo,newTxt;if(this.ignoreChanges){return;}
buf=this.bufs.get(bufID);if(!buf||!buf.populated){return;}
newTxt=doc.getValue();patches=dmp.patch_make(buf.buf,newTxt);if(patches.length===0){return;}
patchInfo={md5_before:util.md5(buf.buf),md5_after:util.md5(newTxt),id:buf.id,patch:dmp.patch_toText(patches)};handlerAction.patch_buf(patchInfo);buf.set({"buf":newTxt},{silent:true});prefs.pauseFollowMode(2000);},patchTest:function patchTest(){var _this3=this;this.forEach(function(editor){var doc=_this3.docs[editor.activeBuf];if(!doc){return;}
doc.setValue(doc.getValue()+"blah"+Date.now()+"\n");});},openBuffer:function openBuffer(buf,line){var _this4=this;var doc,es,bufID=buf.id,firstPopulation=true,handlers=this.handlers[bufID];if(!handlers){handlers=this.handlers[bufID]={};}
doc=this.docs[bufID];if(!doc){doc=new AceDocument(buf.buf||"");doc.setNewLineMode("unix");handlers.documentChange=this.on_documentChange.bind(this,bufID);doc.on("change",handlers.documentChange);this.docs[bufID]=doc;}
es=this.editorSessions[bufID];if(!es){es=new EditSession(doc);console.log("set",buf,". mode to "+util.modeForFile(buf.path));es.setMode("ace/mode/"+util.modeForFile(buf.path));es.setUseWrapMode(true);handlers.selectionChange=_.debounce(this.on_selectionChange.bind(this,buf),250);es.selection.on("changeCursor",handlers.selectionChange);es.selection.on("changeSelection",handlers.selectionChange);configureEditSession(es);this.editorSessions[bufID]=es;}
if(!_.isUndefined(handlers.buf)){return;}
handlers.buf=buf.on(function(){if(!buf.populated){return;}
if(firstPopulation){_this4.setDoc(buf,line);firstPopulation=false;es.setUndoManager(new UndoManager());}else{_this4.setDoc(buf);}});},closeBuffer:function closeBuffer(buf){var doc,es,close=0,handlers=this.handlers[buf.id];this.forEach(function(editor){editor.tabs.forEach(function(id){if(id===buf.id){close++;}});});if(close>1){return;}
delete this.handlers[buf.id];if(!handlers){return;}
doc=this.docs[buf.id];doc.removeListener("change",handlers.documentChange);delete this.docs[buf.id];es=this.editorSessions[buf.id];es.selection.removeListener("changeCursor",handlers.selectionChange);es.selection.removeListener("changeSelection",handlers.selectionChange);delete this.editorSessions[buf.id];buf.off(handlers.buf);},setDoc:function setDoc(buf,line){var _this5=this;var bytes,hex,es,doc,left,top;var positions={};var mime_type=util.image_mime_from_extension(buf.path);this.ignoreChanges=true;this.map(function(editor){if(buf.id!==editor.activeBuf){return;}
try{positions[editor.id]=editor.ace.getCursorPosition();}catch(ignored){}});es=this.editorSessions[buf.id];left=es.getScrollLeft();top=es.getScrollTop();doc=this.docs[buf.id];console.log("setting buf",buf.path);if(buf.encoding!=="base64"){if(doc){doc.setValue(buf.buf);}}else{bytes=StringView.base64ToBytes(buf.buf);if(mime_type){buf.img="data:image/"+mime_type+";base64,"+buf.buf;editorAction.imagify(buf);}else{hex=StringView.bytesToHex(bytes);if(doc){doc.setValue(hex);}}}
_.each(positions,function(pos,id){_this5.get(id).ace.moveCursorToPosition(pos);});if(_.isFinite(line)){_.each(positions,function(pos,id){_this5.get(id).ace.gotoLine(line);});}else{es.setScrollLeft(left);es.setScrollTop(top);}
this.ignoreChanges=false;},highlight:function highlight(buf,ranges,connectionID,username,summon){var _this6=this;var doc,gotoLine,id,es;doc=this.docs[buf.id];if(!doc||!buf.populated){if(!summon&&!prefs.isFollowing(username)){return;}
id=buf.on(function(){if(!buf.populated){return;}
_this6.highlight(buf,ranges,connectionID,username,summon);buf.off(id);});editorAction.open(buf.id);return;}
this.removeHighlight(connectionID);es=this.editorSessions[buf.id];_.each(ranges,function(range){var markerID,start,end,klass="highlight highlight_"+util.userColor(username);if(range[0]===range[1]){range[1]++;}
start=doc.indexToPosition(range[0],0);end=doc.indexToPosition(range[1],0);markerID=es.addMarker(new AceRange(start.row,start.column,end.row,end.column),klass,username,true);_this6.highlights[connectionID].push({bufID:buf.id,markerID:markerID});gotoLine=start.row;});if(summon){prefs.pauseFollowMode(5000);}
if(!summon&&!prefs.isFollowing(username)){return;}
editorAction.open(buf.id,gotoLine+1);},patch:function patch(bufID,dmpPatchResult,newTextPointer){var _this7=this;var doc=this.docs[bufID],buf=this.bufs.get(bufID);if(!doc){return;}
if(!buf.populated){return;}
this.ignoreChanges=true;_.each(dmpPatchResult[2],function(patch){var offset=patch[0],length=patch[1],replace=patch[2],startPos=doc.indexToPosition(offset,0),endPos=doc.indexToPosition(offset+length,0),r=new AceRange(startPos.row,startPos.column,endPos.row,endPos.column);console.log("replacing",r,replace);_this7.map(function(editor){editor.ace.$blockScrolling++;});doc.replace(r,replace);_this7.map(function(editor){editor.ace.$blockScrolling--;});});newTextPointer[0]=doc.getValue();this.ignoreChanges=false;}});function configureEditSession(es){console.log("Configuring editor session");es.setTabSize(parseInt(localStorage.getItem("tabSize"),10)||2);es.setUseSoftTabs(_.isNull(localStorage.getItem("softTabs"))?true:localStorage.getItem("softTabs")==="true");}
module.exports={Editor:Editor,configureEditSession:configureEditSession};},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var flux=__webpack_require__(7);var id=0;var Filetree=flux.createModel({modelName:"tree",fieldTypes:{id:flux.FieldTypes.number,tree:flux.FieldTypes.object},getDefaultFields:function getDefaultFields(){return{id:++id};},addBuf:function addBuf(buf){var node=this.tree,paths=buf.path.split("/"),name=paths.pop();try{_.each(paths,function(p){var n=node[p];if(!n){n={};node[p]=n;}
node=n;});node[name]=buf.id;}catch(e){console.error("Path conflict for",buf.path);return;}
this.update();},removePath:function removePath(bufPath){var i,name,node=this.tree,paths=bufPath.split("/");name=paths.pop();for(i=0;i<paths.length;i++){node=node[paths[i]];if(!node){console.error("Couldn't find filetree node for path",bufPath);return;}}
delete node[name];if(!paths.length){this.update();return;}
if(_.size(node)===0){this.removePath(paths.join("/"));return;}
this.update();}});Filetree.Event={OPEN:"open"};module.exports=Filetree;},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var Handler=__webpack_require__(19);var Socket=__webpack_require__(21);var perms=__webpack_require__(22);var Buffer=__webpack_require__(13).Buffer;var editorAction=__webpack_require__(14);var handlerAction=__webpack_require__(15);var messageAction=__webpack_require__(5);var webrtcAction=__webpack_require__(24);var appHistory=__webpack_require__(25);var prefs=__webpack_require__(10);var util=__webpack_require__(9);function FlooHandler(settings,users,me,bufs,filetree,terminals){Handler.call(this,settings.api_key,settings.auth_secret,settings.username);this.users=users;this.me=me;this.bufs=bufs;this.filetree=filetree;this.terminals=terminals;this.saveTimeout=null;this.lastHighlight=null;editorAction.on(this.handleActions_.bind(this,"editor"));messageAction.on(this.handleActions_.bind(this,"messages"));handlerAction.on(this.handleActions_.bind(this,"handler"));}
FlooHandler.prototype=Object.create(Handler.prototype);FlooHandler.prototype.constructor=FlooHandler;_.assign(FlooHandler.prototype,{messages:null,users:null,user:null,on_room_info:function on_room_info(workspace){var _this=this;this.users.reset([]);var myConnectionIds=[];this.me.connections.forEach(function(conn){myConnectionIds.push(conn.id);});myConnectionIds.forEach(function(id){this.me.connections.remove(id);}.bind(this));this.me.myConnectionID=workspace.user_id;fl.username=workspace.users[workspace.user_id].username;console.log("room info",workspace);console.log("my user id",workspace.user_id);perms.set(workspace.perms,{silent:true});setTimeout(perms.update.bind(perms),0);this.setUsersFromWorkspace(workspace.users,workspace.user_id,this.users,this.me);this.filetree.tree=workspace.tree;_.each(workspace.bufs,function(buf){_this.bufs.add(new Buffer(buf));});_.each(workspace.terms,function(term,termId){var user=_this.users.getByConnectionID(term.owner);_this.terminals.addTerminal(termId,term.term_name,term.size[0],term.size[1],user.id);});messageAction.success("You have joined "+this.path_+".");if(!appHistory.start()){editorAction.open_default_buf(this.filetree.tree);}
this.permsChanged();if(perms.indexOf("patch")===-1){prefs.following=true;messageAction.info("Following changes because you don't have edit permission.");}
handlerAction.ready(workspace);this.temp_data={};workspace.temp_data=workspace.temp_data||{};this.handle_temp_data(workspace.temp_data);this.temp_data=workspace.temp_data;if(this.newWorkspace){editorAction.upload();}},on_ack:function on_ack(){return;},on_patch:function on_patch(data){var buf=this.bufs.get(data.id);if(!buf){return;}
if(!buf.populated){console.log("buf isn't populated. fetching");Socket.send_get_buf(buf.id);return;}
if(buf.encoding==="base64"){console.log("Floobits can't handle binary patches at the moment. Re-fetching.");Socket.send_get_buf(buf.id);return;}
buf.patch(data);},on_term_stdin:function on_term_stdin(data){var user=this.users.getByConnectionID(data.user_id);if(!user){console.error("on_term_stdin: No user with conn id.",data.user_id);return;}
if(data.summon||prefs.isFollowing(user.id)){editorAction.open_term(data.id);}},on_disconnect:function on_disconnect(){Handler.prototype.on_disconnect.apply(this,arguments);this.users.reset([]);},on_join:function on_join(connInfo){var foundUser,user,image,conn,result;console.log("connInfo",connInfo);util.USERNAME_TO_COLOR[connInfo.username]=connInfo.color;foundUser=this.users.get(connInfo.username);result=this.upsertUser(connInfo,foundUser);user=result.user;conn=result.conn;messageAction.log(connInfo.username+" joined using "+connInfo.client+" on "+connInfo.platform,null,true);handlerAction.connection_joined(connInfo);if(!foundUser){this.users.add(user);}
image=this.me.getMyConnection().image;if(!image||!conn.isWeb()){return;}
Socket.emitDataMessage({name:"user_image",image:image},[connInfo.user_id]);},on_perms:function on_perms(data){var user,permissions;user=this.users.getByConnectionID(data.user_id);if(!user){console.log("user not found",data.user_id);return;}
permissions=user.permissions.valueOf();switch(data.action){case"add":permissions=_.uniq(permissions.concat(data.perms));break;case"remove":permissions=_.difference(permissions,data.perms);break;case"set":permissions=_.clone(data.perms);break;default:console.log("Unhandled permission type");break;}
user.permissions.set(permissions);if(user.isMe){perms.set(permissions.valueOf());this.permsChanged();}},permsChanged:function permsChanged(){var args=[];if(perms.indexOf("kick")!==-1){messageAction.log("You have permission to administer this workspace.");return;}
if(perms.indexOf("patch")!==-1){messageAction.log("You have permission to edit this workspace.");return;}
if(perms.indexOf("request_perms")!==-1){args.push({name:"Request edit permission",classNames:["btn-warning"],action:function action(){Socket.send_request_perms({perms:["edit_room"]});}});}
if(this.me.isAnon){args.push({name:"Sign in",classNames:["btn-primary"],action:fl.showLoginForm});}
if(args.length){messageAction.interactive("You don't have permission to edit this workspace.",args);}else{messageAction.log("You don't have permission to edit this workspace.");}},on_request_perms:function on_request_perms(data){var user,permMapping={"edit_room":"edit","admin_room":"admin"},permsEvent;user=this.users.getByConnectionID(data.user_id);if(!user){console.error("No user for conn id",data.user_id);return;}
permsEvent={user_id:data.user_id,perms:data.perms};messageAction.interactive(user.username+" is requesting "+permMapping[data.perms]+" permission.",[{name:"Allow",classNames:["btn-danger"],action:function action(){permsEvent.action="add";Socket.send_perms(permsEvent);}},{name:"Reject",classNames:["btn-warning"],action:function action(){permsEvent.action="reject";Socket.send_perms(permsEvent);}},{name:"Ignore"}]);},on_part:function on_part(partData){var connId,connInfo,username,user;connId=partData.user_id;username=partData.username;user=this.users.get(username);if(!user){console.log("part: Unknown user parted.",username);return;}
connInfo=user.connections.get(connId);messageAction.log(username+" left. (Using "+connInfo.client+" on "+connInfo.platform+")",null,true);webrtcAction.stop_video_chat(connId);user.connections.remove(connId);if(user.connections.length<1){this.users.remove(user.id);}
editorAction.remove_highlight(connId);},on_create_buf:function on_create_buf(data){var b=new Buffer(data);this.bufs.add(b);this.filetree.addBuf(b);editorAction.created(b);messageAction.info(data.username+" created "+data.path);},on_get_buf:function on_get_buf(data){var b=this.bufs.get(data.id);data.populated=true;b.set(data);clearTimeout(b.strike_timeout);},on_rename_buf:function on_rename_buf(data){var b=this.bufs.get(data.id);if(!b){return;}
b.path=data.path;this.filetree.removePath(data.old_path);this.filetree.addBuf(b);editorAction.rename(b);},on_delete_buf:function on_delete_buf(data){var b=this.bufs.get(data.id);if(!b){return;}
editorAction.close(b.id);this.bufs.remove(b.id);this.filetree.removePath(b.path);messageAction.info(data.username+" deleted "+data.path);},on_msg:function on_msg(msg){console.log("got message",msg);if(msg.from){messageAction.private(msg.from,msg.data,msg.time);return;}
messageAction.user(msg.username,msg.data,msg.time);},on_datamsg:function on_datamsg(msg){var user;console.log("Data message",msg);if(msg.data.name==="user_image"){user=this.users.getByConnectionID(msg.user_id);if(!user){return;}
user.connections.get(msg.user_id).image=msg.data.image;}},handle_temp_data:function handle_temp_data(data){if(!data.hangout||!data.hangout.url){if(this.temp_data.hangout&&this.temp_data.hangout.url){messageAction.info("This workspace is no longer being edited in a Hangout");}
return;}
messageAction.interactive("This workspace is being edited in a Google Hangout",[{name:"Open Hangout",classNames:["btn-success"],action:function action(){self.location.href=data.hangout.url;}}]);},on_set_temp_data:function on_set_temp_data(data){this.handle_temp_data(data.data);_.extend(this.temp_data,data.data);},on_delete_temp_data:function on_delete_temp_data(data){var _this2=this;this.handle_temp_data(data.data);_.each(data.data,function(k){delete _this2.temp_data[k];});},sendMessage:function sendMessage(message){Socket.send_msg({"data":message});this.on_msg({username:this.me.username,data:message,time:Date.now()/1000});},renameBuf:function renameBuf(buf,newPath){Socket.send_rename_buf({"id":buf.id,"path":newPath});},createBuf:function createBuf(data){Socket.send_create_buf({buf:data.buf||"",path:data.path,encoding:data.encoding||"utf8"});},deleteBuf:function deleteBuf(bufID){Socket.send_delete_buf({id:bufID});},handleActions_:function handleActions_(prefix,action){var func,args,functionName;args=_.toArray(arguments).slice(2);functionName="onAction_"+prefix+"_"+action;func=this[functionName];console.log("handling action",functionName);if(_.isFunction(func)){func.apply(this,args);}},on_highlight:function on_highlight(data){if(!data||_.size(data.ranges)===0){return;}
editorAction.highlight(data.id,data.ranges,data.user_id,data.username,data.summon);this.lastHighlight=data;}});FlooHandler.prototype["onAction_handler_"+handlerAction.UPDATE_PERMS]=function(connectionID,new_perms){Socket.send_perms({user_id:connectionID,perms:new_perms,action:"set"});};FlooHandler.prototype["onAction_handler_"+handlerAction.SEND_HIGHLIGHT]=function(bufID,ranges,following,summon){Socket.send_highlight({id:bufID,ranges:ranges,following:following,summon:summon});};FlooHandler.prototype["onAction_handler_"+handlerAction.SAVE_BUF]=function(bufID){Socket.send_saved({id:bufID});};FlooHandler.prototype["onAction_handler_"+handlerAction.GET_BUF]=function(bufID){Socket.send_get_buf(bufID);};FlooHandler.prototype["onAction_handler_"+handlerAction.PATCH_BUF]=function(patchInfo){Socket.send_patch(patchInfo);if(this.saveTimeout){clearTimeout(this.saveTimeout);}
this.saveTimeout=setTimeout(function(){Socket.send_saved({id:patchInfo.id});this.saveTimeout=null;}.bind(this),5000);};FlooHandler.prototype["onAction_editor_"+editorAction.KICK]=function(connectionID){Socket.send_kick({user_id:connectionID});};FlooHandler.prototype["onAction_editor_"+editorAction.FOLLOW]=function(){if(this.lastHighlight&&prefs.isFollowing()){this.on_highlight(this.lastHighlight);}};FlooHandler.prototype["onAction_editor_"+editorAction.OPEN]=function(buf){if(!buf.populated){Socket.send_get_buf(buf.id);}};FlooHandler.prototype["onAction_editor_"+editorAction.DELETE_BUF]=function(bufID){this.deleteBuf(bufID);};FlooHandler.prototype["onAction_editor_"+editorAction.NEW_FILE]=function(path){this.createBuf({path:path});};FlooHandler.prototype["onAction_editor_"+editorAction.CREATE_BUF]=function(path,buf,encoding){this.createBuf({path:path,buf:buf,encoding:encoding});};FlooHandler.prototype["onAction_editor_"+editorAction.PULL_REPO]=function(repoType,repoURL,repoBranch){Socket.send_pull_repo({type:repoType,url:repoURL,branch:repoBranch});};FlooHandler.prototype["onAction_editor_"+editorAction.RENAME_REQUEST]=function(buf,newPath){this.renameBuf(buf,newPath);};FlooHandler.prototype["onAction_editor_"+editorAction.REQUEST_PERMS]=function(){if(perms.indexOf("request_perms")===-1){messageAction.log("You don't have permission to edit this workspace.");return;}
Socket.send_request_perms({perms:["edit_room"]});};FlooHandler.prototype["onAction_handler_"+handlerAction.HANGOUT]=function(){var url=fl.editor_settings.new_hangout_url;if(this.temp_data.hangout&&this.temp_data.hangout.url){url=this.temp_data.hangout.url;}
self.location.href=url;};FlooHandler.prototype["onAction_handler_"+handlerAction.SET_TEMP_DATA]=function(temp_data){Socket.send_set_temp_data({data:temp_data});};FlooHandler.prototype["onAction_handler_"+handlerAction.SEND_MESSAGE]=function(message){console.log("sending message",message);this.sendMessage(message);};FlooHandler.prototype["onAction_handler_"+handlerAction.EMIT_DATA_MESSAGE]=function(data,to){Socket.emitDataMessage(data,to);};FlooHandler.prototype["onAction_handler_"+handlerAction.BROADCAST_DATA_MESSAGE]=function(data){return this.workspaceDataMessage(data);};FlooHandler.prototype["onAction_handler_"+handlerAction.BROADCAST_DATA_MESSAGE_FOR_PERM]=function(data,perm){return this.workspaceMessageForPerm("datamsg",{data:data},perm);};FlooHandler.prototype.workspaceDataMessage=function(data){var ids=_.chain(this.users.data.collection).flatten("connections").filter(function(conn){return!conn.isMe;}).map(function(conn){return conn.id;}).value();return Socket.emitDataMessage(data,ids);};FlooHandler.prototype.workspaceMessageForPerm=function(name,data,perm){var f=Socket["send_"+name],ids;ids=_.chain(this.users.data.collection).flatten("connections").filter(function(conn){return!conn.isMe&&_.includes(util.BROWSER_CLIENTS,conn.client)&&conn.perms.indexOf(perm)>-1;}).map(function(conn){return conn.id;}).value();data.to=ids;return f(data);};module.exports=FlooHandler;},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var flux=__webpack_require__(7);var util=__webpack_require__(9);var User=__webpack_require__(20).User;var Socket=__webpack_require__(21);var BaseHandler=__webpack_require__(23);var messageAction=__webpack_require__(5);function Handler(apiKey,apiSecret,username,isHangout){BaseHandler.call(this);this.apiKey_=apiKey;this.apiSecret_=apiSecret;this.username_=username;this.isHangout_=isHangout;this.owner_="";this.workspace_="";this.path_="";this.newWorkspace=false;}
Handler.prototype=Object.create(BaseHandler.prototype);Handler.prototype.constructor=Handler;_.assign(Handler.prototype,{__VERSION__:"0.11",on_error:function on_error(data){console.error("error data",data.msg);messageAction.error(data.msg);messageAction.modal(data.msg);},on_disconnect:function on_disconnect(data){var msg=data&&data.reason;messageAction.warn(msg||"Disconnected from workspace");if(!msg){return;}
messageAction.modal(msg);Socket.disconnect();},go:function go(owner,workspace,path,newWorkspace){this.owner_=owner;this.workspace_=workspace;this.path_=path;this.newWorkspace=newWorkspace;console.log("connection connecting",owner,workspace,path);Socket.connect();},on_sio_connect:function on_sio_connect(){console.log("connection auth",this.path_,this.workspace_,this.owner_);Socket.auth({"username":this.username_,"api_key":this.apiKey_,"secret":this.apiSecret_,"path":this.path_,"platform":this.platform(),"client":this.client(),"supported_encodings":["utf8","base64"],"version":this.__VERSION__});},platform:function platform(){if(navigator.appVersion.indexOf("Win")!==-1){return"win32";}else if(navigator.appVersion.indexOf("Mac")!==-1){return"darwin";}else if(navigator.appVersion.indexOf("X11")!==-1){return"unix";}else if(navigator.appVersion.indexOf("Linux")!==-1){return"linux";}
return"unknown";},client:function client(){var vendor=navigator.vendor||"";var userAgent=navigator.userAgent||"";if(this.isHangout_){return"web-hangout";}
if(userAgent.indexOf("OPR")!==-1){return"Opera";}
if(vendor.indexOf("Google")!==-1){return"Chrome";}
if(userAgent.indexOf("Firefox")!==-1){return"Firefox";}
if(vendor.indexOf("Microsoft")!==-1){return"IE";}
if(vendor.indexOf("Apple")!==-1){return"Safari";}
return"web";},setUsersFromWorkspace:function setUsersFromWorkspace(workspaceUsers,userId,users,me){var _this=this;var usersMap={};users.reset();usersMap[workspaceUsers[userId].username]=me;_.each(workspaceUsers,function(connection){util.USERNAME_TO_COLOR[connection.username]=connection.color;usersMap[connection.username]=_this.upsertUser(connection,usersMap[connection.username],userId).user;});users.set(_.values(usersMap));},upsertUser:function upsertUser(connection,opt_user,opt_myUserId){var conn,user,username,isMe=connection.user_id===opt_myUserId;username=connection.username;user=opt_user||new User();conn=user.createConnection(connection.user_id,connection.client,connection.platform,connection.version,isMe);user.set({isMe:isMe,can_contract:connection.can_contract,rate:connection.rate,id:username,permissions:new flux.List(connection.perms),isAnon:connection.is_anon,gravatar:connection.gravatar});return{conn:conn,user:user};}});module.exports=Handler;},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var flux=__webpack_require__(7);var util=__webpack_require__(9);var editorAction=__webpack_require__(14);var context=null;try{context=self.AudioContext&&new self.AudioContext();}catch(e){console.log("Unable to create context.",e);}
var Visualizer=flux.createActions({visualize:function visualize(width){return width;}});var Connection=flux.createModel({modelName:"Connection",fieldTypes:{id:flux.FieldTypes.number,path:flux.FieldTypes.string,bufId:flux.FieldTypes.number,client:flux.FieldTypes.string,platform:flux.FieldTypes.string,version:flux.FieldTypes.string,connected:flux.FieldTypes.bool,isMe:flux.FieldTypes.bool,image:flux.FieldTypes.object.defaults(null),streamURL:flux.FieldTypes.string,audioOnly:flux.FieldTypes.bool,inVideoChat:flux.FieldTypes.bool,screenStreamURL:flux.FieldTypes.string},init:function init(){this.visualizer=new Visualizer();},visualizer:null,jsProcessor:null,stream:null,screenStream:null,isWeb:function isWeb(){return _.includes(util.BROWSER_CLIENTS,this.client);},onSoundEvent:function onSoundEvent(analyser){var data=new Uint8Array(analyser.frequencyBinCount),max=0;analyser.getByteFrequencyData(data);if(!data.length){return;}
_.each(data,function(frame){max=Math.max(max,frame);});max=max/7.96875;this.visualizer.visualize(Math.min(max,32));},stopStream:function stopStream(){if(this.jsProcessor){this.jsProcessor.disconnect();}
this.jsProcessor=null;},processStream:function processStream(stream){if(!context||!context.createAnalyser||!context.createScriptProcessor){console.log("Browser has no audio analyser.");return;}
console.log("begin audio thing");var audioSource=null;try{audioSource=context.createMediaStreamSource(stream);}catch(e){console.log("Unable to create media stream source.",e);return;}
var analyser=context.createAnalyser();analyser.fftSize=32;analyser.smoothingTimeConstant=0.3;var jsProcessor=context.createScriptProcessor(2048,1,1);jsProcessor.onaudioprocess=this.onSoundEvent.bind(this,analyser);audioSource.connect(analyser);analyser.connect(jsProcessor);jsProcessor.connect(context.destination);this.stopStream();this.jsProcessor=jsProcessor;}});var Connections=flux.createCollection({modelName:"Connections",model:Connection,sort:function sort(a,b){var aIsWeb=a.isWeb(),bIsWeb=b.isWeb();if(a.image&&!b.image){return-1;}
if(b.image&&!a.image){return 1;}
if(aIsWeb&&!bIsWeb){return-1;}
if(bIsWeb&&!aIsWeb){return 1;}
if(a.id>b.id){return-1;}
return 1;}});function User(){User.super_.apply(this,arguments);}
flux.inherit(User,flux.createModel({modelName:"User",fieldTypes:{connections:Connections,id:flux.FieldTypes.string,permissions:flux.FieldTypes.list,isMe:flux.FieldTypes.bool,client:flux.FieldTypes.string,platform:flux.FieldTypes.string,isAnon:flux.FieldTypes.bool,version:flux.FieldTypes.string,can_contract:flux.FieldTypes.bool,rate:flux.FieldTypes.number,gravatar:flux.FieldTypes.string},getDefaultFields:function getDefaultFields(){return{isAnon:true,permissions:new flux.List(),connections:new Connections()};}}));Object.defineProperty(User.prototype,"color",{get:function id(){if(this.color_){return this.color_;}
this.color_=util.userColor(this.id);return this.color_;}});Object.defineProperty(User.prototype,"isAdmin",{get:function isAdmin(){return this.permissions.indexOf("kick")!==-1;}});Object.defineProperty(User.prototype,"username",{get:function getUsername(){return this.id;}});User.prototype.getConnectionID=function(){var conn=this.connections.valueOf()[0];return conn&&conn.id;};User.prototype.createConnection=function(connectionId,client,platform,version,isMe){var conn=new Connection({id:connectionId,path:"",bufId:0,client:client,platform:platform,version:version,connected:true,isMe:isMe,inVideoChat:false});this.connections.add(conn);return conn;};User.prototype.kick=function(){this.connections.forEach(function(conn){console.log("kicking",conn);editorAction.kick(conn.id);});};User.prototype.getMyConnection=function(){var conn=_.find(this.connections.valueOf(),function(c){return c.isMe;});return conn&&this.connections.get(conn.id);};function Users(){Users.super_.apply(this,arguments);}
flux.inherit(Users,flux.createCollection({modelName:"Users",model:User}));Users.prototype.getByConnectionID=function(connectionId){return _.find(this.data.collection,function(user){return user.connections.get(connectionId);});};Users.prototype.getConnectionByConnectionID=function(connectionId){var user=this.getByConnectionID(connectionId);return user&&user.connections.get(connectionId);};module.exports={Connection:Connection,User:User,Users:Users};},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var flux=__webpack_require__(7);var messageAction=__webpack_require__(5);var perms=__webpack_require__(22);var authorized=false;var reqCallbacks={};var patchActions=["mute","quit","reject","start","stop","unmute"];var actions={socket_:null,capturedEvents:null,captureEvents:null,requestId:0,reconnectTimeout:null,engineIoURL:null};var EventsIn=["ack","create_buf","create_term","datamsg","delete_buf","delete_temp_data","delete_term","error","get_buf","highlight","join","kick","msg","part","patch","perms","ping","pong","rename_buf","request_perms","room_info","saved","set_temp_data","solicit","sync","term_stdin","term_stdout","update_term","user_info","webrtc"];var EventsOut=["auth","create_buf","datamsg","delete_buf","delete_temp_data","get_buf","highlight","kick","msg","patch","perms","ping","pong","pull_repo","rename_buf","request_perms","saved","set_temp_data","solicit","term_stdin","term_stdout","webrtc"];_.each(EventsOut,function(name){actions["send_"+name]=function actionOut(data,cb,that){this.send_(name,data,cb,that);return data;};});function actionIn(data){return data;}
_.each(EventsIn,function(name){actions[name]=actionIn;});actions.auth=function(auth){return this.send_(null,auth);};actions.ping=function(data){return this.send_("pong",{res_id:data.req_id});};actions.send_get_buf=function(id,cb){return this.send_("get_buf",{id:id},cb);};actions.disconnect=function(msg){var socket=this.socket_;this.socket_=null;authorized=false;if(socket){socket.off();clearInterval(this.reconnectTimeout);socket.close();}
return msg;};actions.sio_connect=function(){return;};actions.sio_disconnect=function(){return;};var Socket=flux.createActions(actions);Socket.prototype.send_=function(name,msg,cb,that){if(this.socket_===null){console.log("There is no socket to send with. We are currently disconnected.");return null;}
msg=msg||{};if(name){if(name!=="auth"&&!authorized){console.log("Not authorized yet.");return null;}
if(perms.indexOf(name)===-1){console.error("OMG no permission to send",name);return null;}
if(name==="webrtc"){if(perms.indexOf("patch")===-1&&patchActions.indexOf(msg.action)!==-1){console.error("Floo No permission to send webrtc",msg.action);return null;}}
msg.name=name;}
if(!msg.res_id){msg.req_id=++this.requestId;}
console.log("emit",msg);this.socket_.send(JSON.stringify(msg));if(cb){reqCallbacks[msg.req_id]=cb.bind(that);}
return msg.req_id;};Socket.prototype.emitDataMessage=function(data,to){console.log("emitting data message",data,to);return this.send_("datamsg",{data:data,to:to});};Socket.prototype.connect=function(engineIoURL){var s;console.log("Connecting to",engineIoURL);this.engineIoURL=engineIoURL;try{s=new eio.Socket(engineIoURL,{transports:["websocket"]});}catch(e){messageAction.modal("Error connecting to Engine.io:"+e+"\n\n Refresh this page to try again. :(");return;}
this.socket_=s;this.requestId=0;s.on("open",function(){this.sio_connect();}.bind(this));s.on("close",function(){this.reconnect_();}.bind(this));s.on("message",function(msg){msg=JSON.parse(msg);if(!msg.name){return;}
if(msg.name==="room_info"){console.log("Now authorized.");authorized=true;}
var res_id=msg.res_id;var registered_callback=reqCallbacks[res_id];if(registered_callback){delete reqCallbacks[res_id];try{if(msg.name==="error"){registered_callback(msg);}else{registered_callback(null,msg);}}catch(e){console.error("Error in cb for",res_id,msg.name,e);}}
var f=this[msg.name];if(!f){console.error("no action for "+msg.name);return;}
f(msg);}.bind(this));s.on("error",this.reconnect_.bind(this));};Socket.prototype.reconnect_=function(){authorized=false;if(this.socket_===null){console.log("Not reconnecting, no socket.");return null;}
messageAction.log("Reconnecting...");this.socket_.off();this.socket_.close();if(this.reconnectTimeout){return null;}
this.reconnectTimeout=setTimeout(function(){this.reconnectTimeout=null;this.connect(this.engineIoURL);}.bind(this),1500);return new Error("don't emit me");};module.exports=new Socket();console.log("Socket ready.",module.exports);},function(module,exports,__webpack_require__){"use strict";var flux=__webpack_require__(7);module.exports=new flux.List("Permission");},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var Socket=__webpack_require__(21);function BaseHandler(){Socket.on(_.bind(this.handle_,this));}
BaseHandler.prototype.handle_=function(name,data){var f;if(name===Socket.PING){return;}
f=this["on_"+name.toLowerCase()];if(!_.isFunction(f)){return;}
console.log(this.constructor.name,"handler handling",name,this[name]);f.call(this,data);};module.exports=BaseHandler;},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var flux=__webpack_require__(7);var Modal=__webpack_require__(12);var editorAction=__webpack_require__(14);var messageAction=__webpack_require__(5);var perms=__webpack_require__(22);var prefs=__webpack_require__(10);var canShareScreen=false;var cantStartVideoChat=false;var Actions=flux.createActions({start_video_chat:function start_video_chat(connId){if(cantStartVideoChat){return new Error("Can't start video yet.");}
if(prefs.dnd){editorAction.pref("dnd",false);messageAction.info("Do not disturb disabled.");}
if(perms.indexOf("patch")===-1){messageAction.info("You need edit permissions to video chat.");return new Error("No permission to video chat.");}
if(prefs.audioOnly){this.start_audio_chat(connId);return new Error("Starting audio chat.");}
return connId;},stop_video_chat:function stop_video_chat(connId){if(prefs.audioOnly){this.stop_audio_chat(connId);return new Error("Stopping audio chat.");}
return connId;},start_audio_chat:function start_audio_chat(connId){return connId;},stop_audio_chat:function stop_audio_chat(connId){return connId;},start_screen:function start_screen(connId){var errMsg;if(canShareScreen){if(prefs.dnd){editorAction.pref("dnd",false);messageAction.info("Do not disturb disabled.");}
return connId;}
if(!self.chrome||!chrome.app){errMsg="Screen sharing requires Google Chrome and the Floobits screen sharing extension.";Modal.showWithText(errMsg,"Can't Share Screen");messageAction.warn(errMsg);return new Error(errMsg);}
try{chrome.webstore.install(fl.chrome_extension_url,function(){self.location.reload();},function(err){console.error("Error in chrome.webstore.install:",err);errMsg="To share your screen, you need to <a href=\""+fl.chrome_extension_url+"\" target=\"_blank\">install our Chrome extension</a>.";Modal.showWithUnsafeHTML(errMsg);});}catch(e){console.error("Exception in chrome.webstore.install:",e);self.open(fl.chrome_extension_url);}
return new Error("User may install extension");},stop_screen:function stop_screen(connId){return connId;},can_share_screen:function can_share_screen(can){canShareScreen=can;return can;},closedStreams:function closedStreams(){if(cantStartVideoChat){return;}
cantStartVideoChat=true;_.delay(function(){cantStartVideoChat=false;},2000);}});module.exports=new Actions();},function(module,exports){"use strict";var routes,loadQuery;routes=[];loadQuery=self.location.search;function handleState(event){var path,found=false;event=event||{state:null};path=decodeURI(self.location.pathname);routes.forEach(function(route){if(route.path.test(path)){route.callbacks.forEach(function(cb){found=true;cb(path,event.state);});}});return found;}
self.onpopstate=handleState;module.exports=Object.create({},{addRoute:{value:function value(path,callbacks){routes.push(Object.create({},{path:{value:path},callbacks:{value:callbacks},name:{value:name}}));}},start:{value:handleState},navigate:{value:function value(path,state,replace){path=encodeURI(path);try{if(replace){history.replaceState({state:state,path:path},"",""+path+loadQuery);}else{history.pushState({state:state,path:path},"",""+path+loadQuery);}}catch(e){console.log("Push state error.",arguments,e);}}}});},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var flux=__webpack_require__(7);var util=__webpack_require__(9);var handlerAction=__webpack_require__(15);var LogMessageView=React.createClass({propTypes:{message:React.PropTypes.string,repeatCount:React.PropTypes.number},render:function render(){var message=this.props.message;var repeatCountHTML="";if(this.props.repeatCount>0){repeatCountHTML=React.createElement("span",{className:"message-log-repeat"},"x",this.props.repeatCount+1);}
return React.createElement("div",{className:"message alert alert-"+message.levelName,role:"alert"},React.createElement("div",{className:"message-content"},React.createElement("div",{className:"message-timestamp"},message.prettyTime),React.createElement("div",{className:"message-text"},message.msg," ",repeatCountHTML," ")));}});var UserMessageView=React.createClass({propTypes:{message:React.PropTypes.string},getInitialState:function getInitialState(){return{ignoredURLs:[]};},ignoreURL:function ignoreURL(url,event){if(event){event.stopPropagation();event.preventDefault();}
var ignoredURLs=this.state.ignoredURLs;ignoredURLs.push(url);this.setState({ignoredURLs:ignoredURLs});},render:function render(){var message=this.props.message,urlRegexp=/https?:\/\/\S+/g,userColor=util.userColor(message.username),result,msgTxt=[],before,after,key=0,prevIndex=0;while(true){result=urlRegexp.exec(message.msg);if(!result){msgTxt.push(message.msg.slice(prevIndex));break;}
before=message.msg.slice(prevIndex,result.index);prevIndex=result.index+result[0].length;after=message.msg.slice(prevIndex,urlRegexp.lastIndex);var imgOrTxt=result[0];if(this.state.ignoredURLs.indexOf(imgOrTxt)===-1&&util.image_mime_from_extension(imgOrTxt)){imgOrTxt=React.createElement("div",{className:"messages-image-container"},React.createElement("i",{className:"glyphicon glyphicon-remove messages-remove-image",onClick:this.ignoreURL.bind(this,imgOrTxt)}),React.createElement("img",{src:imgOrTxt}));}
msgTxt.push(React.createElement("span",{key:key++},before,React.createElement("a",{target:"_blank",href:result[0]},imgOrTxt),after));}
return React.createElement("div",{className:"message"},React.createElement("div",{className:"message-content"},React.createElement("div",{style:{},className:"message-timestamp"},message.prettyTime),React.createElement("div",{style:{},className:"message-text"},React.createElement("span",{className:"message-username"},React.createElement("span",{className:"user-color-square",style:{backgroundColor:userColor}}),message.username||message.type,":"),msgTxt)));}});var InteractiveMessageView=React.createClass({propTypes:{message:React.PropTypes.string},getInitialState:function getInitialState(){return{clicked:null};},onClick:function onClick(button){if(this.state.clicked!==null){return;}
button.action();this.setState({clicked:button.id});},render:function render(){var _this=this;var message=this.props.message,buttons=message.buttons||[];buttons=buttons.map(function(b){var classes="btn ",clicked=_this.state.clicked;if(clicked===null||clicked===b.id){classes+=b.classNames.join(" ");}
if(clicked===b.id){classes+=" dim";}
return React.createElement("button",{key:b.id,className:classes,onClick:_this.onClick.bind(_this,b)},b.name);});return React.createElement("div",{className:"message"},React.createElement("div",{className:"message-content"},React.createElement("div",{className:"message-timestamp"},message.prettyTime),React.createElement("div",{className:"message-text"},message.msg,buttons.length&&React.createElement("div",{className:"buttons"},buttons))));}});var MessagesView=React.createClass({mixins:[flux.createAutoBinder(["messages"])],propTypes:{focus:React.PropTypes.bool,hideChat:React.PropTypes.bool,messages:React.PropTypes.array},handleMessage_:function handleMessage_(event){var input,ret;event.preventDefault();input=this.refs.newMessage.getDOMNode();ret=handlerAction.send_message(input.value);if(ret){console.error(ret);}
input.value="";},componentDidMount:function componentDidMount(){if(this.props.focus&&this.refs.newMessage){this.refs.newMessage.getDOMNode().focus();}},getMessages:function getMessages(){var messages=[];var prevLogMessage=null;this.props.messages.forEach(function(message){if(message.type!=="log"){prevLogMessage=null;messages.push({message:message});return;}
if(prevLogMessage===message.msg){_.last(messages).repeatCount+=1;return;}
messages.push({message:message,repeatCount:0});prevLogMessage=message.msg;});return messages;},render:function render(){var nodes,chatInput="";nodes=this.getMessages().map(function(messageObj){var message=messageObj.message;switch(message.type){case"user":return React.createElement(UserMessageView,{message:message,key:message.id});case"log":return React.createElement(LogMessageView,{repeatCount:messageObj.repeatCount,message:message,key:message.id});case"interactive":return React.createElement(InteractiveMessageView,{message:message,key:message.id});default:console.error("Unknown message type:",message.type);break;}});if(!this.props.hideChat){chatInput=React.createElement("div",{className:"chat-input-container"},React.createElement("form",{onSubmit:this.handleMessage_},React.createElement("input",{type:"text",ref:"newMessage",defaultValue:"",className:"chat-input",placeholder:"type here to chat"})));}
return React.createElement("div",{className:"messages-container"},chatInput,React.createElement("div",{className:"messages-list"},nodes));}});module.exports=MessagesView;},,function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var handlerActions=__webpack_require__(15);var messageAction=__webpack_require__(5);var perms=__webpack_require__(22);var WebRTC=__webpack_require__(29);var THUMB_WIDTH=228;var THUMB_HEIGHT=228;function MugShot(){this.snapshotInterval=null;this.drawTimeouts={};this.stream=null;}
MugShot.prototype.start=function(myConn){if(perms.indexOf("patch")===-1){messageAction.info("Mugshots require edit permission.");return;}
this.stop();this.myConn=myConn;this.snapshotInterval=setInterval(_.bind(this.snapshot,this),60000);this.snapshot();};MugShot.prototype.stop=function(){clearInterval(this.snapshotInterval);this.snapshotInterval=null;this.clearDrawTimeouts();this.stopStream();if(this.myConn){this.myConn.image=null;}};MugShot.prototype.snapshot=function(){console.log("Creating snapshot.");getUserMedia({audio:false,video:{optional:[{facingMode:"user"},{maxWidth:THUMB_WIDTH},{maxHeight:THUMB_HEIGHT}]}},_.bind(this.gotUserMedia,this));};MugShot.prototype.clearDrawTimeouts=function(){_.each(this.drawTimeouts,function(timeout){clearTimeout(timeout);});this.drawTimeouts={};};MugShot.prototype.stopStream=function(){if(this.stream){try{WebRTC.stopStream(this.stream);}catch(e){console.error("Error stopping stream in stopStream:",e);}
this.stream=null;}
this.clearDrawTimeouts();};MugShot.prototype.gotUserMedia=function(err,stream){if(err){console.error("Error getting snapshot!",err);return;}
if(this.stream){console.error("Mug shot stream already exists! Killing old stream");try{this.stream.stop();}catch(e){console.error("Error stopping stream in gotUserMedia:",e);}}
this.stream=stream;this.getSnapshotFromStream(stream,function(snapErr,data){if(snapErr){console.error("Error getting snapshot from stream:",snapErr);}
handlerActions.broadcast_data_message_for_perm({name:"user_image",image:data},"get_buf");this.myConn.image=data;this.stopStream();}.bind(this));};MugShot.prototype.getSnapshotFromStream=function(stream,cb){var self=this;var video=document.createElement("video");video.setAttribute("width",THUMB_WIDTH);video.setAttribute("height",THUMB_HEIGHT);var canvas=document.createElement("canvas");canvas.setAttribute("width",THUMB_WIDTH);canvas.setAttribute("height",THUMB_HEIGHT);var canvasContext=canvas.getContext("2d");video.src=window.URL&&window.URL.createObjectURL(stream)||stream;video.play();function done(err,result){try{video.pause();video.src="";video=null;}catch(e){console.error("Mugshot draw: Error pausing video:",e);}
try{delete self.drawTimeouts[stream];}catch(unused){}
return cb(err,result);}
var i=45;function draw(){var data;i--;try{canvasContext.clearRect(0,0,canvas.width,canvas.height);canvasContext.drawImage(video,0,0,video.width,video.height);if(fl.editor_settings.logLevel>0){canvasContext.fillText(Date().toString(),1,10);canvasContext.fillText("i:"+i,1,25);}}catch(e){console.log("Capture self shot failed.",e);}
data=self.handleFrame_(canvas,canvasContext,false);if(data){console.log("handled snapshot");return done(null,data);}
if(i<=0){console.log("snapshot still not ready. forcing");data=self.handleFrame_(canvas,canvasContext,true);return done(null,data);}
self.drawTimeouts[stream]=setTimeout(draw,34);}
_.defer(draw.bind(this));};MugShot.prototype.cancelSnapshot=function(){handlerActions.broadcast_data_message_for_perm({name:"user_image",image:null},"get_buf");};MugShot.prototype.handleFrame_=function(canvas,canvasContext,force){var data,i,r,g,b,imageData=canvasContext.getImageData(0,0,canvas.width,canvas.height),goodPixels=0;data=new Array(imageData.data.length/4);for(i=0;i<data.length;i++){r=imageData.data[i*4];g=imageData.data[i*4+1];b=imageData.data[i*4+2];data[i]=Math.round(0.21*r+0.72*g+0.07*b);imageData.data[i*4]=data[i];imageData.data[i*4+1]=data[i];imageData.data[i*4+2]=data[i];if(data[i]>20&&data[i]<240){goodPixels++;}}
if(goodPixels<imageData.data.length*0.10&&!force){return null;}
canvasContext.putImageData(imageData,0,0);data={width:canvas.width,height:canvas.height,data:canvas.toDataURL()};return data;};module.exports=new MugShot();},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var ExtMessaging=__webpack_require__(30);var Socket=__webpack_require__(21);var SoundEffects=__webpack_require__(31);var Modal=__webpack_require__(12);var handlerAction=__webpack_require__(15);var messageAction=__webpack_require__(5);var webrtcAction=__webpack_require__(24);var perms=__webpack_require__(22);var prefs=__webpack_require__(10);ExtMessaging.init();var mediaConstraints={video:{audio:{optional:[]},video:{optional:[{facingMode:"user"},{maxWidth:228},{maxHeight:228}]}},audio:{audio:{optional:[]},optional:[{chromeRenderToAssociatedSink:true}]},screen:{audio:false,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:null,maxWidth:1920,maxHeight:1080},optional:[{maxFrameRate:10}]}}};var connConfig={debug:false,iceServers:[{url:"stun:stun.l.google.com:19302"},{url:"turns:turn.floobits.com:5349",username:"floobits",credential:"stiboolf"}],limits:{audio:128,video:256},sdpHack:true};var connConstraints={optional:[{DtlsSrtpKeyAgreement:true},{RtpDataChannels:true}]};function WebRTC(users,me,isChat){var _this=this;var self=this;this.users=users;this.me=me;this.isChat=isChat;this.down_peers_={};this.up_peers_={};this.commStream=null;this.screenStream=null;this.partedUsers={};this.hasAudio=false;this.hasVideo=false;function enableMedia(sources){sources.forEach(function(source){if(source.kind.indexOf("audio")!==-1){self.hasAudio=true;}
if(source.kind.indexOf("video")!==-1){self.hasVideo=true;}});console.log("has audio:",self.hasAudio);console.log("has video:",self.hasVideo);}
if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){navigator.mediaDevices.enumerateDevices().then(enableMedia);}else if(window.MediaStreamTrack&&MediaStreamTrack.getSources){MediaStreamTrack.getSources(enableMedia);}else{this.hasAudio=true;this.hasVideo=true;}
this.soundEffects=true;Socket.onWEBRTC(_.bind(this.handleMsg_,this));Socket.onPART(_.bind(this.handlePart_,this));webrtcAction.onSTART_VIDEO_CHAT(this.startVideo,this);webrtcAction.onSTOP_VIDEO_CHAT(this.stopVideo,this);webrtcAction.onSTART_AUDIO_CHAT(this.startAudio,this);webrtcAction.onSTOP_AUDIO_CHAT(this.stopAudio,this);webrtcAction.onSTART_SCREEN(this.startScreen,this);webrtcAction.onSTOP_SCREEN(this.stopScreen,this);prefs.on(function(){if(!prefs.dnd){return;}
if(_this.commStream||_this.screenStream){messageAction.info("Stopping video chat because you enabled Do Not Disturb.");}
_this.stopUserMedia();});handlerAction.onREADY(function(roomInfo){if(_.includes(roomInfo.perms,"patch")){return;}
_this.soundEffects=false;setTimeout(function(){_this.soundEffects=true;},4000);});handlerAction.on(handlerAction.CONNECTION_JOINED,function(connectionInfo){if(!_this.commStream&&!_this.screenStream){return;}
Socket.send_webrtc({action:"marco",data:_this.myStreams(),to:[connectionInfo.user_id]});});}
WebRTC.prototype.gotUserMedia_=function(type,users,err,stream){var err_msg,myConnId=this.myConnId_();if(_.isArray(users)){users=_.filter(users,function(u){return u!==myConnId;});}
if(err){console.error("WebRTC error!",err);if(err.name){err=err.name;}
if(type==="screen"){err_msg="Please read our <a href=\"/help/webrtc#screenshare\" target=\"_blank\">guide to setting up WebRTC screen sharing</a>.";}else{if(err==="DevicesNotFoundError"){err_msg="Could not detect camera or microphone.";}else{err_msg="Please read our <a href=\"/help/webrtc\" target=\"_blank\">guide to setting up WebRTC</a>.";}}
Modal.showWithUnsafeHTML("Error activating WebRTC: "+err+"\n<br />"+err_msg);return;}
if(type==="screen"){this.screenStream=stream;}else if(type==="video"||type==="audio"){this.commStream=stream;}
stream._streamType=type;if(users){Socket.send_webrtc({action:"start",data:this.myStreams(),to:users});}
Socket.send_webrtc({action:"marco",data:this.myStreams(),to:[]});stream.onended=_.bind(this.stopStream,this,stream,type);this.addStream_(this.me.getMyConnection(),stream,type);};WebRTC.prototype.myConnId_=function(){return this.me.getMyConnection().id;};WebRTC.prototype.log_=function(otherConnId,msg){var otherUser;otherUser=this.users.getByConnectionID(otherConnId);if(!otherUser){return;}
msg=otherUser.id+msg;messageAction.info(msg,true);};WebRTC.prototype.handlePolo_=function(otherConnId,streams){var self=this,otherUser;if(!self.commStream&&!self.screenStream){return;}
console.log("Handling webrtc polo from",otherConnId);otherUser=this.users.getByConnectionID(otherConnId);if(!otherUser){console.log("No user for conn id",otherConnId);return;}
_.each(streams,function(type){delete self.partedUsers[otherConnId+"_"+type];self.createNewOffer_(otherConnId,type);});};WebRTC.prototype.myStreams=function(){var streams=[];if(this.commStream){streams.push(this.commStream._streamType);}
if(this.screenStream){streams.push(this.screenStream._streamType);}
return streams;};WebRTC.prototype.sendReject=function(username,otherUserId){var reason;if(prefs.dnd){messageAction.info("Rejected "+username+"s video chat because you enabled Do Not Disturb.",true);reason="Do Not Disturb on";}else if(!webrtcsupport.PeerConnection){messageAction.info("Rejected "+username+"s video chat because your browser doesnt support WebRTC.",true);reason="Peer's browser doesn't support WebRTC.";}else if(perms.indexOf("patch")===-1){messageAction.info("Rejected "+username+"s video chat because you dont have edit permission.",true);reason="User does not have edit permission.";}
Socket.send_webrtc({action:"reject",data:reason,to:[otherUserId]});};WebRTC.prototype.handleMarco_=function(otherUserId,streams){var self=this,username;if(prefs.dnd||!webrtcsupport.PeerConnection){username=this.users.getByConnectionID(otherUserId).id;this.sendReject(username,otherUserId);return;}
if(this.isChat&&_.size(this.myStreams())===0){return;}
Socket.send_webrtc({action:"polo",data:this.myStreams(),to:[otherUserId]});_.each(streams,function(type){delete self.partedUsers[otherUserId+"_"+type];self.createNewOffer_(otherUserId,type);});};WebRTC.prototype.createNewOffer_=function(connId,type){var pc;pc=this.setupPeer_(this.down_peers_,connId,type);if(pc.sent_offer){console.log("PeerConnection offer for user",connId,type,"has already been sent");return;}
this.log_(connId," is connecting to your video chat.");pc.on("close",_.bind(this.handleClosedConnection_,this,connId,type));pc.sent_offer=true;pc.offer(function(err,sdp){if(err){console.error("sessionDescription error",err.toString());return;}
Socket.send_webrtc({action:"offer_sdp",data:sdp,stream_type:type,to:[connId]});});};WebRTC.prototype.setupPeer_=function(peers,connId,type){var pc,pcKey,config=_.cloneDeep(connConfig),ice_name;if(peers===this.up_peers_){ice_name="ice_down";}else if(peers===this.down_peers_){ice_name="ice_up";}else{throw new Error("setupPeer_ got weird peers list that is neither up nor down!");}
config.sdpHack=type!=="screen";console.log("setting sdp hack?",config.sdpHack);pcKey=connId+"_"+type;if(_.has(peers,pcKey)){console.log("setupPeer:",pcKey,"already exists. not doing anything");return peers[pcKey];}
pc=new PeerConnection(config,connConstraints);peers[pcKey]=pc;pc.on("iceConnectionStateChange",function(event){var peer=peers[pcKey];console.log("iceConnectionStateChange",event);if(connId>=this.me.getMyConnection().id){return;}
if(_.has(this.partedUsers,pcKey)){console.log(pcKey,"in partedUsers. Bailing.");return;}
if(pc.iceConnectionState!=="disconnected"){return;}
if(!peer){console.log("No peerConnection. Reconnecting to",pcKey);this.createNewOffer_(connId,type);return;}
console.log("Reconnecting to",pcKey);delete peers[pcKey];peer.once("close",function(){console.debug("closed",pcKey);this.createNewOffer_(connId,type);}.bind(this));peer.close();}.bind(this));pc.on("removeStream",function(event){console.debug("removeStream",event);});pc.on("ice",function(event){Socket.send_webrtc({action:ice_name,data:event,stream_type:type,to:[connId]});});pc.on("addStream",function(evt){console.debug("addStream",evt);if(this.soundEffects){SoundEffects.join(this.users.getByConnectionID(connId).id);}
this.addStream_(this.users.getConnectionByConnectionID(connId),evt.stream,type);}.bind(this));pc.on("error",console.log);return pc;};WebRTC.prototype.handleClosedConnection_=function(connId,type){var conn=this.users.getConnectionByConnectionID(connId);conn.stopStream();if(type==="screen"){conn.screenStream=null;conn.screenStreamURL=null;}else{conn.stream=null;conn.streamURL=null;}
console.debug("Like *poof*.",connId);this.log_(connId," has disconnected from your video chat.");if(this.soundEffects){SoundEffects.leave(this.users.getByConnectionID(connId).id);}
this.stopVideoIfAlone();};WebRTC.prototype.stopVideoIfAlone=function(){var otherStreams,me=this.myConnId_();otherStreams=_.find(this.users.valueOf(),function(u){return _.find(u.connections.valueOf(),function(c){return(c.streamURL||c.screenStreamURL)&&c.id!==me;});});if(!otherStreams){this.stopUserMedia();}};WebRTC.prototype.addStream_=function(connection,stream,type){if(type==="screen"){connection.screenStream=stream;connection.screenStreamURL=URL.createObjectURL(stream);return;}
connection.stream=stream;connection.processStream(stream);connection.set({streamURL:URL.createObjectURL(stream),audioOnly:type==="audio"});};WebRTC.prototype.handleMsg_=function(msg){var down_pc,up_pc,pcKey,supportedMessages,data,user,conn,rejectMsg;console.log("Webrtc got a data message",msg);supportedMessages=["answer_sdp","ice_down","ice_up","marco","mute","offer_sdp","polo","quit","reject","start","stop","unmute"];if(!_.includes(supportedMessages,msg.action)){console.error("Unknown webrtc message action",msg.action);return;}
data=msg.data;conn=this.users.getConnectionByConnectionID(msg.user_id);pcKey=msg.user_id+"_"+msg.stream_type;down_pc=this.down_peers_[pcKey];up_pc=this.up_peers_[pcKey];var chatType=void 0;switch(msg.action){case"mute":console.log("muting user",data.mute);this.mute(data.mute,true);break;case"unmute":console.log("unmuting user",data.unmute);this.mute(data.unmute,false);break;case"reject":user=this.users.getByConnectionID(msg.user_id);rejectMsg=user.id+" rejected your video chat request.";if(data){rejectMsg+=" Reason: "+data;}
messageAction.log(rejectMsg);break;case"quit":conn.inVideoChat=false;this.partedUsers[pcKey]=true;this.closePeer_(msg.user_id,msg.stream_type);break;case"ice_down":if(down_pc){console.log("Processing downstream PC ICE",data);down_pc.processIce(data);}else{console.log("No PC for downstream ICE",data);}
break;case"ice_up":if(up_pc){console.log("Processing upstream PC ICE",data);up_pc.processIce(data);}else{console.log("No PC for upstream ICE",data);}
break;case"offer_sdp":this.processOfferSDP_(msg.user_id,msg.stream_type,data);break;case"answer_sdp":if(down_pc){down_pc.handleAnswer(data);}else{console.log("No PC for downstream SDP",data);}
break;case"marco":conn.inVideoChat=true;this.handleMarco_(msg.user_id,data);break;case"polo":this.handlePolo_(msg.user_id,data);break;case"start":if(perms.indexOf("patch")===-1||prefs.dnd||!webrtcsupport.PeerConnection){user=this.users.getByConnectionID(msg.user_id);this.sendReject(user.id,msg.user_id);break;}
chatType=prefs.audioOnly?"audio":"video";messageAction.notify("You are joining "+chatType+" chat.");if(this.commStream){Socket.send_webrtc({action:"marco",data:this.myStreams(),to:[msg.user_id]});}else{this.startUserMedia(chatType);}
break;case"stop":if(_.includes(data,"video")){this.stopUserMedia(this.commStream,"video");}
if(_.includes(data,"audio")){this.stopUserMedia(this.commStream,"audio");}
if(_.includes(data,"screen")){this.stopUserMedia(this.screenStream,"screen");}
break;default:console.error("Unknown webrtc event action",data);break;}};WebRTC.prototype.processOfferSDP_=function(userId,type,offer){if(!this.screenStream&&!this.commStream){console.log("No stream, do not create peer connection.");return;}
var pc=this.setupPeer_(this.up_peers_,userId,type);if(!pc||!pc.pc){console.log("no pc.pc for",userId,type);return;}
pc.answer(offer,function(err,answer){if(err){console.log("Got answer error",err.toString());return;}
Socket.send_webrtc({action:"answer_sdp",data:answer,stream_type:type,to:[userId]});});if(type==="screen"){pc.addStream(this.screenStream);}else{pc.addStream(this.commStream);}};WebRTC.prototype.handlePart_=function(data){var self=this;_.each(["audio","video","screen"],function(type){self.partedUsers[data.user_id+"_"+type]=true;console.log("closing peer "+data.user_id+"_"+type);self.closePeer_(data.user_id,type);});self.stopVideoIfAlone();};WebRTC.prototype.closePeer_=function(connId,type,opt_silent){var self=this,key=connId+"_"+type,conn,down_pc;down_pc=this.down_peers_[key];if(down_pc&&opt_silent===false){this.log_(connId," has quit video chat.");}
conn=self.users.getConnectionByConnectionID(connId);if(conn){conn.stopStream();}
try{down_pc.close();}catch(unused){}
delete this.down_peers_[key];setTimeout(function(){var still_connected=_.some(["video","audio","screen"],function(t){return!!self.down_peers_[connId+"_"+t];});if(still_connected){return;}
_.each(["video","audio","screen"],function(t){var pcKey=connId+"_"+t,pc=self.up_peers_[pcKey];delete self.up_peers_[pcKey];try{pc.close();}catch(unused){}});},2000);};WebRTC.prototype.startAudio=function(connId){if(this.commStream){Socket.send_webrtc({action:"start",data:this.myStreams(),to:[connId]});}else{this.startUserMedia("audio",[connId]);}};WebRTC.prototype.stopAudio=function(connId){if(this.myConnId_()===connId){this.stopUserMedia(this.commStream,"audio");}else{Socket.send_webrtc({action:"stop",data:["audio"],to:[connId]});}};WebRTC.prototype.reloadShareScreen=function(){window.location.reload(true);};WebRTC.prototype.startScreen=function(){var self=this,downPeers;downPeers=_.map(this.down_peers_,function(peer,key){return parseInt(key.split("_")[0],10);});if(this.screenStream){Socket.send_webrtc({action:"start",data:this.myStreams(),to:downPeers});return;}
if(navigator.userAgent.toLowerCase().indexOf("chrome")===-1){Modal.showWithUnsafeHTML("Sorry, only Chrome supports WebRTC screen sharing. Please read our <a href=\"/help/webrtc#screenshare\" target=\"_blank\">guide to setting up WebRTC screen sharing</a>.");return;}
console.log("setting up content script in webpage");ExtMessaging.getSharedScreenId(function(id){if(!id){console.log("no idea. bailing");return;}
console.log("media source id is",id);mediaConstraints.screen.video.mandatory.chromeMediaSourceId=id;self.startUserMedia("screen",downPeers);});};WebRTC.prototype.stopScreen=function(connId){if(this.myConnId_()===connId){this.stopUserMedia(this.screenStream,"screen");}else{Socket.send_webrtc({action:"stop",data:["screen"],to:[connId]});}};WebRTC.prototype.startVideo=function(connId){if(this.commStream){Socket.send_webrtc({action:"start",data:this.myStreams(),to:[connId]});}else{this.startUserMedia("video",[connId]);}};WebRTC.prototype.stopVideo=function(connId){if(this.myConnId_()===connId){this.stopUserMedia(this.commStream,"video");}else{Socket.send_webrtc({action:"stop",data:["video"],to:[connId]});}};WebRTC.prototype.startUserMedia=function(type,users){if(type==="video"&&!this.hasVideo){messageAction.notify("No video capabilities detected. Using audio-only.",true);type="audio";}
if(type==="audio"&&!this.hasAudio){messageAction.notify("No video or audio capabilities detected.",true);return;}
var mcs=mediaConstraints[type];if(!mcs){console.error("No constraints for type",type);return;}
if(type==="screen"&&this.screenStream){console.log("Screen share already open");return;}
if((type==="video"||type==="audio")&&this.commStream){console.log("Comm stream already open.");this.stopStream(this.commStream);}
console.log("Media constraints:",mcs);getUserMedia(mcs,_.bind(this.gotUserMedia_,this,type,users));};WebRTC.prototype.getStreamType=function(stream){var type;if(stream===this.commStream){type=stream.getVideoTracks().length>0?"video":"audio";}else if(stream===this.screenStream){type="screen";}else{throw new Error("Unknown type for stream",stream);}
return type;};WebRTC.prototype.stopStream=function(stream,type){var _this2=this;var conn;if(!stream){return;}
if(!type){type=this.getStreamType(stream);}
if(stream._____stopped){return;}
stream._____stopped=true;WebRTC.stopStream(stream);conn=this.users.getConnectionByConnectionID(this.myConnId_());if(conn){if(type==="screen"){this.screenStream=null;conn.screenStream=null;conn.screenStreamURL=null;}else{this.commStream=null;conn.stream=null;conn.streamURL=null;}
conn.stopStream();}
Socket.send_webrtc({action:"quit",stream_type:type,data:{},to:[]});_.each(this.up_peers_,function(pc,pcKey){if(pcKey.split("_")[1]!==type){return;}
delete _this2.up_peers_[pcKey];try{pc.close();}catch(unused){}});};WebRTC.prototype.stopUserMedia=function(stream,type){var self=this;if(!this.commStream&&!this.screenStream){return;}
if(type){console.log("Stopping video for stream.",stream,type);this.stopStream(stream,type);}else{if(this.commStream){type=this.getStreamType(this.commStream);this.stopStream(this.commStream);}
if(this.screenStream){type="screen";this.stopStream(this.screenStream,type);}}
if(this.commStream||this.screenStream){return;}
function closePeers(peers){var openPeers=[];_.each(peers,function(peer,k){var userId=k.split("_")[0],t=k.split("_")[1];openPeers.push(k);peer.once("close",function(){openPeers=_.without(openPeers,k);if(_.isEmpty(openPeers)){console.log("all done closing");}});try{self.closePeer_(userId,t,true);}catch(e){console.debug(e);}});webrtcAction.closedStreams();}
closePeers(this.up_peers_);closePeers(this.down_peers_);self.hideVideoChat();};WebRTC.prototype.hideVideoChat=function(){this.partedUsers={};};WebRTC.stopStream=function(stream){try{stream.getTracks().forEach(function(track){track.stop();stream.removeTrack(track);});}catch(e){console.log("Stopping stream track is not supported in this browser.");}};module.exports=WebRTC;},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var handlerAction=__webpack_require__(15);var webrtcAction=__webpack_require__(24);var callback=void 0;function handleMessage(event){event=event.originalEvent;if(!event.data){return;}
switch(event.data.name){case"flooScreenShareResponse":console.log("Got content script stuff",event);callback(event.data.id);break;case"flooScreenHasExtension":console.log("Website: user has extension");webrtcAction.can_share_screen(true);break;default:break;}}
function getSharedScreenId(cb){callback=cb;setTimeout(function(){console.log("Getting screen share id");window.postMessage({text:"flooScreenShare"},"*");},1);}
function getCanShare(){setTimeout(function(){console.log("Checking to see if we have a chrome extension.");window.postMessage({text:"flooScreenDoWeHaveAnExtension"},"*");},0);}
function init(){console.log("Initing ext msg.");$(window).on("message",handleMessage);function changeListener(evt){var evt_data,origin,parse_url;parse_url=function parse_url(url){var a=document.createElement("a");a.href=url;return{hostname:a.hostname,port:a.port,protocol:a.protocol};};origin=parse_url(evt.origin);if(origin.protocol!=="https:"||!origin.hostname.match(/\.googleusercontent\.com$/)){console.log("discarding because event origin is",origin);return;}
console.log("got event",evt.data);try{evt_data=JSON.parse(evt.data);}catch(e){console.log("Couldn't parse event json:",e);return;}
if(evt_data.temp_data){fl.editor_settings.temp_data=_.extend(fl.editor_settings.temp_data,evt_data.temp_data);try{handlerAction.set_temp_data(evt_data.temp_data);}catch(e){console.log(e);}}}
if(window.parent){if(window.addEventListener){window.addEventListener("message",changeListener,false);}else if(window.attachEvent){window.attachEvent("onmessage",changeListener);}
window.parent.postMessage(JSON.stringify({owner:fl.editor_settings.room_owner,room:fl.editor_settings.room}),"*");}}
module.exports={getSharedScreenId:getSharedScreenId,getCanShare:getCanShare,init:init};},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var prefs=__webpack_require__(10);var util=__webpack_require__(9);window.AudioContext=window.AudioContext||window.webkitAudioContext;window.PannerNode=window.PannerNode||window.webkitAudioPannerNode;var semitone=1.0594545454545454;var harmonicMinor=[0,2,3,5,7,9,11,12];var tempo=0.1;var duration={whole:tempo*4,half:tempo*2,quarter:tempo,eighth:tempo/2};function SoundEffects(){if(!window.AudioContext){return;}
try{this.context=new window.AudioContext();}catch(e){console.error("Unable to create AudioContext for sound effects. :( Exception:",e);return;}
try{this.gainNode=this.context.createGain();this.gainNode.gain.value=0.2;this.gainNode.connect(this.context.destination);}catch(e){console.log("Your browser can't createGain(). Things might be loud. :( Exception:",e);this.gainNode=this.context.destination;}
try{this.panner=this.context.createPanner();this.panner.panningModel=window.PannerNode.HRTF;this.panner.setPosition(0,1,1);this.panner.connect(this.gainNode);}catch(e){console.log("Your browser can't createPanner(). Things might sound weird. :( Exception:",e);this.panner=this.gainNode;}
this.waveform="square";this.scale=this.makeScale(harmonicMinor,220,15);console.log("sound effects initialized");}
SoundEffects.prototype.playNote=function(type,frequency,noteDuration,offset){var osc;if(!this.context){return;}
if(!prefs.sound){console.debug("sound disabled. not playing",frequency,"for",noteDuration);return;}
console.debug("playing",frequency,"for",noteDuration);osc=this.context.createOscillator();offset=offset||0;osc.type=type;osc.frequency.value=frequency;osc.connect(this.panner);osc.start(this.context.currentTime+offset);osc.stop(this.context.currentTime+offset+noteDuration);};SoundEffects.prototype.audioAnalyseTracker={};SoundEffects.prototype.makeScale=function(scale,root,len){var s,current,position;s=[];current=root;for(position=0;s.length<len;position++){if(_.includes(scale,position%12)){s.push(current);}
current=current*semitone;}
return s;};SoundEffects.prototype.join=function(username){var i,note;i=_.reduce(util.md5(username),function(memo,c){return memo+c.charCodeAt(0);},0);note=this.scale[i%_.size(this.scale)];this.playNote(this.waveform,this.scale[0],duration.quarter,0);this.playNote(this.waveform,note,duration.quarter,duration.quarter);};SoundEffects.prototype.leave=function(username){var i,note;i=_.reduce(util.md5(username),function(memo,c){return memo+c.charCodeAt(0);},0);note=this.scale[i%_.size(this.scale)];this.playNote(this.waveform,note,duration.quarter,0);this.playNote(this.waveform,this.scale[0],duration.quarter,duration.quarter);};module.exports=new SoundEffects();},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var flux=__webpack_require__(7);var Socket=__webpack_require__(21);var editorAction=__webpack_require__(14);var TerminalModel=flux.createModel({modelName:"Terminal",fieldTypes:{id:flux.FieldTypes.number,term:flux.FieldTypes.object.ephemeral(),username:flux.FieldTypes.string,div:flux.FieldTypes.object.ephemeral(),title:flux.FieldTypes.string,deleted:flux.FieldTypes.bool.ephemeral()}});var Terminals=flux.createCollection({model:TerminalModel,modelName:"Terminals",users:null,getTerm_:function getTerm_(id){var term=this.get(id);return term&&term.term;},init:function init(args,args2){var _this=this;this.users=args2.users;editorAction.onCLOSE_TERM(function(term){if(!term.deleted){return;}
_this.remove(term.id);term.term.destroy();});Socket.onCREATE_TERM(function(term){var user=_this.users.getByConnectionID(term.owner);_this.addTerminal(term.id,term.term_name,term.size[0],term.size[1],user.id);});Socket.onDELETE_TERM(function(data){var term=_this.get(data.id);if(!term||!term.term){return;}
term.term.write("\r\n   *** TERMINAL CLOSED ***   \r\n");term.deleted=true;});Socket.onTERM_STDOUT(function(data){var term=_this.getTerm_(data.id);if(!term||!term.children){return;}
try{term.write(StringView.makeFromBase64(data.data,"UTF-8").toString());}catch(e){console.warn(e);}});Socket.onUPDATE_TERM(function(data){var term=_this.getTerm_(data.id);console.log("update term",data);if(term&&data.size){term.resize(data.size[0],data.size[1]);}});Socket.onSYNC(function(terms){console.log("Attempting to sync...");_.each(terms,function(data,id){var term=_this.getTerm_(id);if(!term){return;}
term.resize(data.cols,data.rows);});});},addTerminal:function addTerminal(id,title,cols,rows,username){var div,term;id=parseInt(id,10);term=new Terminal({cols:cols,rows:rows,title:title,handler:this.onData.bind(this,id)});div=document.createElement("div");term.open(div);term.id=id;term.title=title;term.deleted=false;this.add({id:id,term:term,username:username,div:div,title:title});},onData:function onData(id,data){Socket.send_term_stdin({id:id,data:new StringView(data).toBase64()});}});module.exports={Terminals:Terminals};},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var flux=__webpack_require__(7);var modal=__webpack_require__(12);var PermissionView=__webpack_require__(34);var perms=__webpack_require__(22);var editorAction=__webpack_require__(14);var userModel=__webpack_require__(20);var webrtcAction=__webpack_require__(24);var solicitationActions=__webpack_require__(35);var util=__webpack_require__(9);var Connection=React.createClass({componentName:"Connection",propTypes:{connection:React.PropTypes.instanceOf(userModel.Connection),isAdmin:React.PropTypes.bool},getInitialState:function getInitialState(){return{showPopover:false};},kick_:function kick_(){editorAction.kick(this.props.connection.id);},render:function render(){var connection=this.props.connection;return React.createElement("div",{className:"user-conn"},React.createElement("span",{className:"user-client-name"},connection.client," ",connection.isMe&&" (this client)"),React.createElement("span",{className:"pull-right"},connection.path),this.props.isAdmin&&React.createElement("span",{className:"btn-group pull-right",onClick:this.kick_},React.createElement("a",{href:"#"},React.createElement("i",{className:"glyphicon glyphicon-eject"})," Kick")));}});var IsMeUserView=React.createClass({propTypes:{connection:React.PropTypes.instanceOf(userModel.Connection)},getInitialState:function getInitialState(){return{sharing:false};},shareScreen:function shareScreen(event){var err;event.preventDefault();event.stopPropagation();if(this.state.sharing){webrtcAction.stop_screen(this.props.connection.id);this.setState({sharing:false});return;}
err=webrtcAction.start_screen();if(err instanceof Error){return;}
this.setState({sharing:true});},render:function render(){return React.createElement("div",null,React.createElement("div",{style:{display:"inline-block"}},React.createElement("a",{href:"https://chrome.google.com/webstore/detail/floobits-screen-sharing/lmojaknpofhmdnbpanagbbeinbjmbodo"}),React.createElement("a",{href:"#",onClick:this.shareScreen},React.createElement("i",{className:"glyphicon glyphicon-facetime-video"})," ",this.state.sharing?"Stop Screen Sharing":"Share Screen")),"",React.createElement("div",{style:{display:"inline-block",paddingTop:8}},React.createElement("a",{href:"/help/webrtc#screenshare",target:"_blank",title:"Screen Share Help"},React.createElement("i",{className:"glyphicon glyphicon-question-sign"}))));}});var NotMeUserView=React.createClass({propTypes:{isAdmin:React.PropTypes.bool,isFollowing:React.PropTypes.bool,isListView:React.PropTypes.bool,me:React.PropTypes.instanceOf(userModel.User),user:React.PropTypes.instanceOf(userModel.User)},kick_:function kick_(){this.props.user.kick();},editPerms_:function editPerms_(){modal.showModal(PermissionView,{user:this.props.user,me:this.props.me,title:"Edit Permissions for "+this.props.user.id});},followUser_:function followUser_(){editorAction.follow(this.props.user.id);},render:function render(){var isAdmin=this.props.isAdmin,user=this.props.user;return React.createElement("div",null,React.createElement("span",{className:"user-client-name"},user.id),React.createElement("span",{className:"pull-right"},React.createElement("a",{target:"_blank",href:"/"+user.id+"/"},React.createElement("i",{className:"glyphicon glyphicon-info-sign"})," Info")),isAdmin&&React.createElement("div",{onClick:this.kick_,className:"pull-right",style:{clear:"both"}},React.createElement("a",{href:"#"},React.createElement("i",{className:"glyphicon glyphicon-eject"})," Kick")),!this.props.isListView&&React.createElement("div",{onClick:this.followUser_,className:"pull-right",style:{clear:"both"}},React.createElement("a",{href:"#"},React.createElement("i",{className:"glyphicon glyphicon-magnet"})," ",this.props.isFollowing?"Unfollow":"Follow")),isAdmin&&React.createElement("div",{onClick:this.editPerms_,className:"pull-right",style:{clear:"both"}},React.createElement("a",{href:"#"},React.createElement("i",{className:"glyphicon glyphicon-cog"})," Permissions")));}});var UserView={mixins:[flux.createAutoBinder(["prefs"])],getInitialState:function getInitialState(){return{opened:false};},followUser_:function followUser_(){editorAction.follow(this.props.user.id);},settingsClick:function settingsClick(){$(this.refs.user.getDOMNode()).toggleClass("opened");this.state.opened=!!this.state.opened;},hire_:function hire_(username){solicitationActions.hire_preferred_pro(username,this.props.user.rate);},render:function render(){var _this=this;var user=this.props.user;var me=this.props.me;var isAdmin=me.isAdmin;var isListView=this.props.isListView;var connectionNodes=[];var inVideoChat=false;user.connections.forEach(function(connection){if(!inVideoChat&&connection.inVideoChat){inVideoChat=true;}
if(!connection.connected){return;}
connectionNodes.push(React.createElement(Connection,{connection:connection,key:connection.id,me:me,username:user.username,isListView:_this.props.isListView,isAdmin:isAdmin}));});var isFollowing=this.props.prefs.followUsers.indexOf(user.id)!==-1;return React.createElement("div",{ref:"user",className:"user"+(this.state.opened?" opened":"")},React.createElement("div",null,!this.props.isListView&&React.createElement("i",{title:isFollowing?"Stop following "+user.id:"Follow "+user.id+"'s changes",className:"glyphicon user-indicator user-following"+(isFollowing?" enabled":""),onClick:this.followUser_}),inVideoChat&&React.createElement("i",{title:user.id+" is in video chat",className:"glyphicon user-indicator in-video"}),isAdmin&&user.can_contract&&!user.isMe&&!isListView&&React.createElement("span",{title:"hire "+user.id+" on FloobitsPro",onClick:this.hire_.bind(this,user.id),className:"hire-me"},"hire me"),this.body()),React.createElement("div",{ref:"settings",className:"user-info"},React.createElement("div",{className:"stack-up"},React.createElement("div",{className:"stack-up-content"},connectionNodes.length," connection",connectionNodes.length===1?"":"s"),React.createElement("hr",null),React.createElement("div",{className:"stack-up-content"},connectionNodes),React.createElement("hr",null),React.createElement("div",{className:"stack-up-content"},this.props.connection.isMe?React.createElement(IsMeUserView,{user:user,isAdmin:isAdmin,connection:this.props.connection}):React.createElement(NotMeUserView,{user:user,isAdmin:isAdmin,isListView:isListView,isFollowing:isFollowing})),React.createElement("hr",{style:{clear:"both"}}))),React.createElement("div",{className:"user-bar",onClick:this.settingsClick},React.createElement("span",{className:"user-color-square highlight_"+user.color,style:{backgroundColor:user.color}}),React.createElement("span",{className:"user-username"},user.id),React.createElement("i",{className:"glyphicon user-arrow"})));}};var GravatarThumbnailView=React.createClass({mixins:[UserView],propTypes:{connection:React.PropTypes.instanceOf(userModel.Connection),user:React.PropTypes.instanceOf(userModel.User)},onClick:function onClick(){webrtcAction.start_video_chat(this.props.connection.id);},body:function body(){var src=this.props.user.gravatar;var dndMode=fl.editor_settings.prefs_path==="chat"&&!!_.find(this.props.user.connections.valueOf(),function(user){return["Chrome","Firefox"].indexOf(user.client)!==-1;});console.log("dndMode?",dndMode);var canEdit=perms.indexOf("patch")!==-1;if(src){src+="?s=228";}else{src="/static/images/anonymous.png";}
return React.createElement("div",null,React.createElement("img",{src:src,className:"user-thumb",title:canEdit?"Start video chat":null,onClick:this.onClick}),dndMode&&React.createElement("i",{title:"User is currently in do not disturb mode.",className:"dnd-mode-icon glyphicon glyphicon-time"}));}});var ImageThumbnailView=React.createClass({mixins:[UserView],propTypes:{connection:React.PropTypes.instanceOf(userModel.Connection)},componentDidUpdate:function componentDidUpdate(){this.refs.mugshot.getDOMNode().setAttribute("src",this.props.connection.image.data);},onClick:function onClick(){webrtcAction.start_video_chat(this.props.connection.id);},body:function body(){var conn=this.props.connection,canEdit=perms.indexOf("patch")!==-1,clickToVideo="",everyone="";if(canEdit){if(conn.isMe){everyone=React.createElement("div",null,"with everyone");}
clickToVideo=React.createElement("div",{className:"click-to-video"},React.createElement("i",{className:"glyphicon glyphicon-facetime-video"})," Start video chat ",everyone);}
return React.createElement("div",{className:"user-face",onClick:this.onClick},React.createElement("img",{ref:"mugshot",className:"user-thumb"+(conn.isMe?" user-my-conn":""),style:{width:conn.image.width,height:conn.image.height},title:canEdit?"Start video chat":null,src:conn.image.data}),clickToVideo);}});var VideoThumbnailView=React.createClass({mixins:[UserView],propTypes:{connection:React.PropTypes.instanceOf(userModel.Connection),screenShare:React.PropTypes.bool,src:React.PropTypes.string,user:React.PropTypes.instanceOf(userModel.User)},getInitialState:function getInitialState(){var poster="/static/images/anonymous.png";var conn=this.props.connection;if(conn.image){poster=conn.image.data;}else if(this.props.user.gravatar){poster=this.props.user.gravatar+"?s=228";}
return{poster:poster,noMic:conn.isMe||navigator.userAgent.indexOf("Firefox")!==-1};},componentDidMount:function componentDidMount(){var _this2=this;var n=this.refs.volume.getDOMNode();this.id=this.props.connection.visualizer.onVISUALIZE(function(volume){n.style.height=volume+"px";n.style.width=volume+"px";if(_this2.state.noMic&&volume){_this2.setState({noMic:false});}});},componentWillUnmount:function componentWillUnmount(){var elem=this.refs["user-thumb-"+this.props.connection.id].getDOMNode();this.props.connection.visualizer.off(this.id);if(util.getFullscreenElement()===elem){console.log("exiting full screen before unmounting");util.exitFullscreen();}},onClick:function onClick(){var elem=this.refs["user-thumb-"+this.props.connection.id].getDOMNode(),fullscreenElement=util.getFullscreenElement();if(fullscreenElement===elem){util.exitFullscreen();return;}
util.requestFullscreen(elem);},stop:function stop(){if(this.props.screenShare){return webrtcAction.stop_screen(this.props.connection.id);}
if(this.props.connection.audioOnly){webrtcAction.stop_audio_chat(this.props.connection.id);}else{webrtcAction.stop_video_chat(this.props.connection.id);}},body:function body(){var classNames=["user-thumb"];if(this.props.connection.isMe&&!this.props.screenShare){classNames.push("user-my-conn");}
if(this.props.connection.audioOnly){classNames.push("audio-only");}
return React.createElement("div",null,React.createElement("i",{className:"glyphicon user-indicator user-stop",title:"Stop video chat",onClick:this.stop}),React.createElement("div",{className:"visualizer-container"},React.createElement("div",{className:"visualizer",ref:"volume"})),React.createElement("div",{className:"user-face"},React.createElement("video",{className:classNames.join(" "),ref:"user-thumb-"+this.props.connection.id,src:this.props.src,srcObject:this.props.screenShare?this.props.connection.screenStream:this.props.connection.stream,autoPlay:"autoplay",poster:this.poster,muted:this.props.connection.isMe?"muted":null}),React.createElement("div",{className:"click-to-video",onClick:this.onClick},React.createElement("i",{className:"glyphicon glyphicon-fullscreen"})," Fullscreen video")),this.state.noMic&&React.createElement("i",{className:"glyphicon user-indicator no-mic",title:"No sound detected from microphone."}));}});var ListViewMixin={mixins:[flux.createAutoBinder(["users"])],render:function render(){var thumbnailNodes=[],isListView=void 0,me=void 0,prefs=void 0;me=this.props.me;isListView=this.isListView;prefs=this.props.prefs;this.props.users.forEach(function(user){var hasRendered=false;user.connections.sort();user.connections.forEach(function(connection){if(!connection.connected){return;}
var args={connection:connection,key:connection.id,user:user,me:me,isListView:isListView,prefs:prefs};if(connection.streamURL){hasRendered=true;args.src=connection.streamURL;args.key+="video";thumbnailNodes.push(React.createElement(VideoThumbnailView,args));}else if(connection.image){hasRendered=true;args.key+="image";thumbnailNodes.push(React.createElement(ImageThumbnailView,args));}
if(!hasRendered){hasRendered=true;args.key+="gravatar";thumbnailNodes.push(React.createElement(GravatarThumbnailView,args));}
if(connection.screenStreamURL){args.src=connection.screenStreamURL;args.key+="screen";args.screenShare=true;thumbnailNodes.push(React.createElement(VideoThumbnailView,args));}});});return React.createElement("div",{className:"user-list"},thumbnailNodes);}};var ChatUserlistView=React.createClass({mixins:[ListViewMixin],componentName:"ChatUserlistView",isListView:true});var UserlistView=React.createClass({componentName:"UserlistView",mixins:[ListViewMixin],isListView:false});module.exports={ChatUserlistView:ChatUserlistView,Connection:Connection,IsMeUserView:IsMeUserView,NotMeUserView:NotMeUserView,UserlistView:UserlistView};},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var handlerAction=__webpack_require__(15);var modal=__webpack_require__(12);var PermissionView=React.createClass({mixins:[modal.ReactModalMixin],propTypes:{user:React.PropTypes.object},getInitialState:function getInitialState(){var permissions;permissions=this.props.user.permissions;return{admin_room:permissions.indexOf("kick")!==-1,view_room:permissions.indexOf("get_buf")!==-1,edit_room:permissions.indexOf("set_buf")!==-1,request_perms:permissions.indexOf("request_perms")!==-1};},componentDidMount:function componentDidMount(){return;},renderField:function renderField(label,name,description){return React.createElement("div",{className:"field_wrapper",key:name},React.createElement("label",{htmlFor:"id_"+name},label),React.createElement("input",{onChange:_.bind(this.handleChange_,this,name),ref:name,id:"id_"+name,type:"checkbox",checked:this.state[name]}),React.createElement("div",null,React.createElement("small",{className:"text-info"},description)));},renderBody:function renderBody(){var _this=this;var fields=[["View","view_room","view files and terminals in this workspace"],["Request permissions","request_perms","ask admins for permission to edit files in this workspace"],["Edit","edit_room","edit files in this workspace"],["Administer","admin_room","set permissions and type in all terminals"]].map(function(perm){return _this.renderField.apply(_this,perm);});return React.createElement("form",null,React.createElement("fieldset",null,fields));},handleSubmit_:function handleSubmit_(event){var _this2=this;var newPerms;event.preventDefault();newPerms=["view_room","edit_room","request_perms","admin_room"].filter(function(perm){return _this2.state[perm];});handlerAction.update_perms(this.props.user.getConnectionID(),newPerms);this.close();},handleChange_:function handleChange_(type,event){var _this3=this;var index,permissions,state,checked;permissions=["view_room","request_perms","edit_room","admin_room"];checked=event.target.checked;index=permissions.indexOf(type);state={};permissions.forEach(function(perm,i){if(i<index&&checked){state[perm]=checked;}else if(i>index&&!checked){state[perm]=checked;}else if(i===index){state[perm]=checked;}else{state[perm]=_this3.state[perm];}});this.setState(state);},renderFooter:function renderFooter(){return React.createElement("div",null,React.createElement("button",{className:"btn btn-default","data-dismiss":"modal"},"Close"),React.createElement("button",{className:"btn btn-success",onClick:this.handleSubmit_},"Save"));}});module.exports=PermissionView;},function(module,exports,__webpack_require__){"use strict";var flux=__webpack_require__(7);var actions=new(flux.createActions({hire_preferred_pro:function hire_preferred_pro(username,rate){return[username,rate];},toggle:function toggle(){},create:function create(description,tags){return[description,tags];},cancel:function cancel(){return;},finish:function finish(){return;},change_state:function change_state(state){return state;},available:function available(numAvail){return numAvail;}}))();function countPros(){$.get("/api/solicitations/pros/available/",function(data){actions.available(data.count);});_.delay(function(){countPros();},60*1000);}
countPros();module.exports=actions;},,function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var upArrowKeyCode=38;var downArrowKeyCode=40;var enterKey=13;var tabKey=9;var escapeKey=27;var allowedKeys=[escapeKey,enterKey,upArrowKeyCode,downArrowKeyCode,tabKey];var Selector=React.createClass({propTypes:{handleSelect:React.PropTypes.func,items:React.PropTypes.array,selectDisplay:React.PropTypes.string,selected:React.PropTypes.bool},getInitialState:function getInitialState(){return{focused:false,filteredItems:this.props.items,selected:null};},componentWillReceiveProps:function componentWillReceiveProps(props){this.filter(props.items);},handleSelect:function handleSelect(item){this.refs.filter.getDOMNode().value="";this.props.handleSelect(item);},handleKeyDown:function handleKeyDown(event){var current,index,kc=event.which;if(allowedKeys.indexOf(kc)===-1){return;}
event.preventDefault();event.stopPropagation();if(kc===escapeKey){if(this.state.focused){this.refs.filter.getDOMNode().blur();}
return;}
if(_.isEmpty(this.state.filteredItems)){return;}
current=this.state.selected;if(!current){current=this.state.filteredItems[0];}
if(kc===enterKey){this.handleSelect(current);this.refs.filter.getDOMNode().value="";return;}
if(kc===tabKey){this.props.handleSelect(current);this.refs.filter.getDOMNode().value="";return;}
if(this.state.filteredItems.length===1){this.setState({selected:current});return;}
index=this.state.filteredItems.indexOf(current);if(kc===upArrowKeyCode){index--;if(index<0){index=this.state.filteredItems.length-1;}}else{index++;}
if(index>=this.state.filteredItems.length){index=0;}
this.setState({"selected":this.state.filteredItems[index]});},handleKeyUp:function handleKeyUp(event){var kc=event.which;if(allowedKeys.indexOf(kc)!==-1){return;}
this.filter();},filter:function filter(optItems){var filteredItems;var val=this.refs.filter.getDOMNode().value;var items=optItems||this.props.items;if(!val.length){this.setState({filteredItems:items});}
filteredItems=items.filter(function(item){return item.displayName.indexOf(val)===0;});if(_.isEmpty(filteredItems)){this.setState({filteredItems:[],selected:null});return;}
this.setState({filteredItems:filteredItems,selected:filteredItems[0]});},onFocus:function onFocus(){if(!this.isMounted()){return;}
this.setState({focused:true});this.refs.filter.getDOMNode().focus();},onBlur:function onBlur(){_.delay(function(){if(this.state.focused){if(!this.isMounted()){return;}
this.setState({focused:false});}}.bind(this),150);},componentDidUpdate:function componentDidUpdate(){var el=this.getDOMNode().getElementsByClassName("selected-item");el=el&&el[0];if(!el){return;}
if(_.isFunction(el.scrollIntoViewIfNeeded)){el.scrollIntoViewIfNeeded();}else{el.scrollIntoView();}},render:function render(){var _this=this;var items=this.state.filteredItems.map(function(item){var selected=item===_this.state.selected;return React.createElement("li",{className:"select-item"+(selected?" selected-item":""),onClick:_.partial(_this.handleSelect,item),ref:item.displayName,key:item.displayName},item.displayName);});var hasTyped=false;if(this.state.focused){hasTyped=!!this.refs.filter.getDOMNode().value;}
return React.createElement("div",{className:"select-container"},!this.state.focused&&React.createElement("p",{className:"select-display form-control",style:{display:"none"},onClick:this.onFocus},this.props.selectDisplay),React.createElement("input",{type:"text",ref:"filter",className:"select-input-filter form-control",id:"id-tag-input",onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.handleKeyDown,placeholder:"enter tags...",onKeyUp:this.handleKeyUp}),this.state.focused&&hasTyped&&React.createElement("ul",{className:"select-list"},items));}});var List=React.createClass({propTypes:{handleRemove:React.PropTypes.func,items:React.PropTypes.array},handleRemove:function handleRemove(item){this.props.handleRemove(item);},render:function render(){var _this2=this;var canRemove=this.props.handleRemove;var listItems=this.props.items.map(function(item){return React.createElement("li",{className:"select-list-item label",key:item.displayName},React.createElement("input",{type:"hidden",name:"tags",value:item.displayName,readOnly:true}),item.displayName,!canRemove?"":React.createElement("span",{className:"select-list-item-remove",onClick:_.partial(_this2.handleRemove,item)},"x"));});return React.createElement("ul",{className:"select-list-container"},listItems);}});var Item={};function createItem(displayName,data){return Object.create(Item,{displayName:{value:displayName,enumerable:true},data:{value:data,enumerable:true}});}
module.exports={Selector:Selector,List:List,Item:Item,createItem:createItem};},,,,function(module,exports,__webpack_require__){"use strict";var solicitationModel=__webpack_require__(42);module.exports={Button:__webpack_require__(43),View:__webpack_require__(44),Model:solicitationModel.Solicitation,Collection:solicitationModel.Solicitations,Contractor:solicitationModel.Contractor,Contractors:solicitationModel.Contractors};},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var flux=__webpack_require__(7);var SOLICIT_STATES={DNE:-1,CREATED:1,BIDDED:2,CANCELED:3,HIRED:4,JOINED:5,ABSOLVED:6,COMPLETED:7,FEEDBACKED:8};var SOLICIT_STATES_REVERSE={};_.forEach(SOLICIT_STATES,function(v,k){SOLICIT_STATES_REVERSE[v]=k;});var ContractorModel=flux.createModel({modelName:"Contractor",fieldTypes:{id:flux.FieldTypes.string,gravatar:flux.FieldTypes.string,description:flux.FieldTypes.string,url:flux.FieldTypes.string,rate:flux.FieldTypes.number,selected:flux.FieldTypes.bool},get:function get(){var self=this;$.ajax({url:"/api/user/"+self.id,headers:{"Authorization":"Basic "+btoa(fl.editor_settings.username+":"+fl.editor_settings.auth_secret)},success:function success(data){console.log(data);self.set({gravatar:data.gravatar,description:data.description,url:data.url});},error:function error(data){console.error("OMG",data);}});}});var Contractors=flux.createCollection({modelName:"Contractors",model:ContractorModel});var Solicitation=flux.createModel({modelName:"Solicitation",fieldTypes:{id:flux.FieldTypes.number,creator:flux.FieldTypes.string,client_account:flux.FieldTypes.string,contractor:ContractorModel,contractors:Contractors,preferred_contractor:flux.FieldTypes.string,state:flux.FieldTypes.oneOf(_.keys(SOLICIT_STATES)).defaults("DNE"),path:flux.FieldTypes.string,description:flux.FieldTypes.string,duration:flux.FieldTypes.number,start:flux.FieldTypes.number,end:flux.FieldTypes.number,tags:flux.FieldTypes.list,cut:flux.FieldTypes.number,total_bill:flux.FieldTypes.number,applied_bonus_minutes:flux.FieldTypes.number,remaining_client_bonus_minutes:flux.FieldTypes.number},SOLICIT_STATES:SOLICIT_STATES,SOLICIT_STATES_REVERSE:SOLICIT_STATES_REVERSE,human_time:function human_time(){var duration;if(this.duration){duration=this.duration;}else{duration=(this.end-this.start)/(60*1000);}
return duration.toFixed(0)+" minutes";}});Solicitation.SOLICIT_STATES=SOLICIT_STATES;Solicitation.SOLICIT_STATES_REVERSE=SOLICIT_STATES_REVERSE;var Solicitations=flux.createCollection({modelName:"Solicitations",model:Solicitation});module.exports={Solicitation:Solicitation,Solicitations:Solicitations,Contractor:ContractorModel,Contractors:Contractors};},function(module,exports,__webpack_require__){"use strict";var actions=__webpack_require__(35);var SolicitationButton=React.createClass({propTypes:{solicitation:React.PropTypes.object},getInitialState:function getInitialState(){return{contractors:null,isPro:false,available:0};},componentWillMount:function componentWillMount(){var _this=this;actions.onCHANGE_STATE(function(state){if(state==="PRO"){_this.setState({isPro:true});}});},componentDidMount:function componentDidMount(){var that=this;var solicitation=this.props.solicitation;solicitation.on(function(){if(solicitation.state===solicitation.SOLICIT_STATES.BID){that.setState({contractors:solicitation.contractors.length});return;}
that.setState({contractors:null});});actions.onAVAILABLE(this.onAvailable);},onAvailable:function onAvailable(available){this.setState({available:available});},toggle:function toggle(){actions.toggle(this.state.available);},render:function render(){var badge="";var contractors=this.state.contractors;if(contractors!==null){if(contractors===0){badge=React.createElement("span",{className:"glyphicon glyphicon-refresh spinning"});}else{badge=React.createElement("span",{style:{color:"#215E93",background:"#fff"},className:"badge pro-badge"},this.state.contractors);}}
return React.createElement("button",{className:"btn btn-xs",title:this.state.available?"Click to hire a pro":"No pros available right now, click to send us a message.",onClick:this.toggle},React.createElement("img",{src:"/static/images/pro/pro_logo.png",style:{height:20}})," ",badge);}});module.exports=SolicitationButton;},function(module,exports,__webpack_require__){"use strict";var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _=__webpack_require__(2);var actions=__webpack_require__(35);var models=__webpack_require__(42);var Socket=__webpack_require__(21);var ClientView=__webpack_require__(45);var ProView=__webpack_require__(49);var usersModel=__webpack_require__(20);var panelsModel=__webpack_require__(50);var SolicitationView=React.createClass({STATES:{UNKNOWN:"UNKNOWN",CLIENT:"CLIENT",PRO:"PRO",EVERYONE_ELSE:"EVERYONE_ELSE"},socket_handlers:[],propTypes:{me:React.PropTypes.instanceOf(usersModel.User),panel:React.PropTypes.instanceOf(panelsModel.Item),solicitation:React.PropTypes.instanceOf(models.Solicitation)},getInitialState:function getInitialState(){return{state:this.STATES.UNKNOWN,stuff_can_pro:fl.pro_perms,preferredPro:null,available:0};},componentWillMount:function componentWillMount(){this.solicitation=this.props.solicitation;this.determineRelationshipToSolicitation();},componentDidMount:function componentDidMount(){if(!document.getElementById("go-pro-button")){return;}
actions.onHIRE_PREFERRED_PRO(this.onHirePreferredPro);actions.onTOGGLE(this.onToggle);actions.onAVAILABLE(this.onAvailable);this.socket_handlers.push(Socket.onSOLICIT(this.onSolicit));},onAvailable:function onAvailable(available){this.setState({available:available});},componentWillUnmount:function componentWillUnmount(){_.each(this.socket_handlers,function(id){Socket.off(id);});},minimize:function minimize(){if(!this.isMounted()){return;}
this.previousSize=this.props.panel.size;this.props.panel.resize(0.01);},maximize:function maximize(){if(!this.isMounted()){return;}
var s=this.previousSize||Math.max(window.innerWidth/3,500);this.props.panel.resize(s);var node=this.getDOMNode().getElementsByTagName("form");if(!node||!node.length){return;}
var elements=node[0].elements;if(!elements||!elements.length){return;}
var element=elements[0];if(!element||!element.focus){return;}
element.focus();if(!element.value){return;}
if(!element.setSelectionRange){element.value=element.value;return;}
element.setSelectionRange(element.value.length,element.value.length);},onHirePreferredPro:function onHirePreferredPro(username,rate){var state=this.state;if(this.state.state===this.STATES.UNKNOWN){state.state=this.STATES.CLIENT;}
state.preferredPro=[username,rate];this.setState(state);this.maximize();},onToggle:function onToggle(){if(!this.isMounted()){return;}
if(this.props.panel.size>1){this.minimize();}else{this.maximize();}},change_state:function change_state(state){this.setState({state:state});actions.change_state(state);},determineRelationshipToSolicitation:function determineRelationshipToSolicitation(){var STATES=this.STATES;if(this.state.state!==STATES.UNKNOWN){return;}
if(!this.solicitation.id&&this.state.stuff_can_pro.length){this.setState({state:STATES.CLIENT});return;}
var creator=this.solicitation.creator;if(this.solicitation.creator===fl.username){this.setState({state:STATES.CLIENT});return;}
var state=_.includes(this.state.orgsCanAdmin,creator)?STATES.CLIENT:STATES.EVERYONE_ELSE;this.change_state(state);},onSolicit:function onSolicit(m){var data=m.data;if(!data){if(!m.res_id){console.error("No data in event",m);}
return;}
var state=void 0;var STATES=this.STATES;var contractors=this.solicitation.contractors;_.each(data.contractors,function(contractor){var username=contractor.username;var c=contractors.get(username);if(!c){c=contractors.add_({id:username,rate:contractor.rate},{silent:true});c.get();}
if(contractor.selected){this.solicitation.contractor=c;}
if(c.id===fl.username){state=STATES.PRO;}}.bind(this));delete data.contractors;if(data.state==="COMPLETED"&&m.action==="feedback"){data.state="FEEDBACKED";}
this.solicitation.set(data);if(state){this.change_state(state);}else{this.determineRelationshipToSolicitation();}
if(this.state.state!==STATES.CLIENT&&this.state.state!==STATES.PRO){return;}
if(this.props.panel.size<1){this.maximize();}},render:function render(){var states=this.STATES;var props=this.props;props.minimize=this.minimize;props.maximize=this.maximize;var body=void 0;switch(this.state.state){case states.CLIENT:body=React.createElement(ClientView,_extends({},this.props,{available:this.state.available,preferredPro:this.state.preferredPro}));break;case states.PRO:body=React.createElement(ProView,this.props);break;default:body=React.createElement("div",null);}
return React.createElement("div",{id:"pro-panel"},React.createElement("div",{className:"container-fluid"},React.createElement("h3",null,React.createElement("img",{src:"/static/images/pro/pro_logo.png"})),React.createElement("hr",null),body));}});module.exports=SolicitationView;},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var Socket=__webpack_require__(21);var flux=__webpack_require__(7);var StarView=__webpack_require__(46);var selector=__webpack_require__(37);var ContractorView=__webpack_require__(47);var messageAction=__webpack_require__(5);var solicitAction=__webpack_require__(35);var solicitModel=__webpack_require__(42);var userModel=__webpack_require__(20);var TAGS=[];var ClientView=React.createClass({hireInterval:null,mixins:[flux.createAutoBinder(["solicitation"]),React.addons.LinkedStateMixin],propTypes:{available:React.PropTypes.bool,me:React.PropTypes.instanceOf(userModel.User),minimize:React.PropTypes.func,preferredPro:React.PropTypes.array,solicitation:React.PropTypes.instanceOf(solicitModel.Solicitation),users:React.PropTypes.instanceOf(userModel.Users)},getInitialState:function getInitialState(){return{selectedTags:this.props.solicitation.tags.map(function(t){return selector.createItem(t,t);}),tags:TAGS,description:"Help me with "+fl.editor_settings.path+".",contractors:{}};},componentWillMount:function componentWillMount(){this.socket_handlers=[];this.toggleID=null;this.rating=null;this.solicitation=this.props.solicitation;},componentDidMount:function componentDidMount(){if(TAGS.length){this.setState({tags:TAGS});return;}
$.get("/api/tags",function(data){TAGS.push.apply(TAGS,data.map(function(tag){return selector.createItem(tag,tag);}));this.setState({tags:TAGS});}.bind(this));},render:function render(){var f=void 0;f=this["render_"+this.solicitation.state.toLowerCase()];if(!_.isFunction(f)){return React.createElement("div",null);}
return React.createElement("div",{id:"pro-panel-inner"},f.call(this));},onRating_:function onRating_(rating){this.rating=rating;},send:function send(action,data,f,binding){var msg={action:action,data:data};if(this.solicitation.id){msg.data.id=this.solicitation.id;}
Socket.send_solicit(msg,f,binding);},create_:function create_(e){var _this=this;var description=this.refs.description.getDOMNode();e.preventDefault();if(!description.value){$(this.refs["description-form-group"].getDOMNode()).addClass("has-error");return;}
var tags=_.map(this.state.selectedTags,function(tag){return tag.displayName;});var account=this.refs.account.getDOMNode().selectedOptions[0].dataset.name;var pro=this.refs.pro&&this.refs.pro.getDOMNode().selectedOptions[0].dataset.name;if(!this.props.available){this.sendRequest(description.value,tags,account);messageAction.log("Message sent, we'll get back to you shortly!");solicitAction.toggle();return;}
this.solicitation.set({description:description.value,tags:tags,id:0,client_account:account});this.setState({description:description.value,selectedTags:tags.map(function(t){return selector.createItem(t,t);})});this.send("create",this.solicitation.valueOf(),function(err){if(err){console.error(err);return;}
if(!pro){_this.solicitation.set({state:"CREATED"});return;}
var contractors=_this.solicitation.contractors;var c=contractors.get(pro);if(!c){var rate=_this.props.preferredPro[1];c=contractors.add_({id:pro,rate:rate},{silent:true});c.get();}
_this.hire_(pro);});},sendRequest:function sendRequest(description,tags,account){$.post("/api/solicitations/pro/request",{description:description,tags:tags,account:account,path:self.fl.editor_settings.path},function(){console.log("Pro request went OK.");});},cancel_:function cancel_(e){var _this2=this;if(e&&e.preventDefault){e.preventDefault();}
if(!this.solicitation.id){if(this.solicitation.state!=="DNE"){this.solicitation.set({state:"DNE"});return;}
this.props.minimize();return;}
this.send("cancel",{},function(err){if(err){return;}
_this2.solicitation.set({state:"CANCELED"});});},hire_:function hire_(username){var _this3=this;var contractor=this.solicitation.contractors.get(username);this.send("hire",{username:username},function(err){if(err){return;}
_this3.solicitation.set({state:"HIRED",contractor:contractor,start:Date.now()});});},absolve_:function absolve_(){var _this4=this;this.send("absolve",{},function(err){if(err){return;}
_this4.solicitation.set({state:"ABSOLVED"});});},complete_:function complete_(){var _this5=this;this.send("complete",{},function(err){if(err){return;}
_this5.solicitation.set({state:"COMPLETED"});});},feedback_:function feedback_(event){var feedback=this.state.feedback;event.preventDefault();if(feedback){feedback=feedback.trim();}
if(!this.rating){$(this.refs.rating.getDOMNode()).addClass("has-error");return;}
var contractor=this.solicitation.contractor;this.send("feedback",{rating:this.rating,for_user:contractor.id,text:feedback});var u=this.props.users.get(contractor.id);if(u){u.kick();}},close_:function close_(event){event.preventDefault();this.reset_();this.props.minimize();},reset_:function reset_(){this.solicitation.set({id:0,contractor:"",client_account:"",contractors:[],preferred_contractor:"",state:"DNE",duration:0,start:0,end:0,rate:0});},handleTagRemove:function handleTagRemove(item){var newTags=_.filter(this.state.selectedTags,function(tag){return tag.displayName!==item.displayName;});this.setState({"selectedTags":newTags});},handleTagSelect:function handleTagSelect(item){if(!_.isEmpty(_.filter(this.state.selectedTags,function(tag){return item.displayName===tag.displayName;}))){return;}
var selectedTags=this.state.selectedTags.concat([item]);console.log("new selected tags:",selectedTags);this.setState({"selectedTags":selectedTags});},render_dne:function render_dne(){var users=fl.pro_perms.map(function(p){var text=p[0];if(p[1]){text+=" ("+p[1]+" free minutes)";}
return React.createElement("option",{"data-name":p[0],key:p[0]},text);});var pros=[];if(this.props.preferredPro){var pro=this.props.preferredPro[0];var rate=this.props.preferredPro[1];pros.push(React.createElement("option",{"data-name":pro,key:pro},pro+" ($"+rate+"/hour)"));pros.push(React.createElement("option",{"data-name":"",key:"None"},"No Preference"));}
var notAvailHTML=React.createElement("p",null,React.createElement("strong",null,"No pros are available right now, but you can request someone to contact you by completing this form."));var findButtonText=this.props.available?"Find Help":"Send Request";return React.createElement("div",null,React.createElement("p",null,"Floobits Pros are experts you can hire for 10 minutes or more. If it doesn't work out, cancel within the first five minutes at no cost."),React.createElement("p",null,"All pros are required to agree to our ",React.createElement("a",{href:"/tos/nda",target:"blank"},"non-disclosure agreement"),"."),!this.props.available&&notAvailHTML,React.createElement("hr",null),React.createElement("form",{className:""},React.createElement("div",{className:"form-group",ref:"description-form-group"},React.createElement("label",{htmlFor:"id_account",className:"control-label"},"Floobits Account"),React.createElement("select",{ref:"account",className:"form-control",id:"id_account"},users)),!pros.length?"":React.createElement("div",{className:"form-group",ref:"description-form-group"},React.createElement("label",{htmlFor:"id_pro",className:"control-label"},"Pro"),React.createElement("select",{ref:"pro",className:"form-control",id:"id_pro"},pros)),React.createElement("div",{className:"form-group",ref:"description-form-group"},React.createElement("label",{htmlFor:"id_description",className:"control-label"},"Description"),React.createElement("textarea",{className:"form-control",ref:"description",id:"id_description",name:"description",valueLink:this.linkState("description"),rows:"5"})),React.createElement("div",{className:"form-group"},React.createElement("label",{className:"control-label"},"Tags"),React.createElement(selector.List,{items:this.state.selectedTags,handleRemove:this.handleTagRemove}),React.createElement(selector.Selector,{selectDisplay:"Select a tag...",items:this.state.tags,handleSelect:this.handleTagSelect})),React.createElement("div",{className:"pull-right"},React.createElement("button",{className:"btn btn-default btn-sm",onClick:this.cancel_},"Cancel"),React.createElement("button",{className:"btn btn-primary btn-sm",onClick:this.create_},findButtonText))));},render_created:function render_created(contractors){var solicitation=this.props.solicitation;var tags=this.props.solicitation.tags.valueOf()||[];return React.createElement("div",null,React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-3 valign-center"},React.createElement("b",null,"Account:")),React.createElement("div",{className:"col-md-9 valign-center clearfix"},solicitation.client_account),React.createElement("br",null),React.createElement("div",{className:"col-md-3 valign-center"},React.createElement("b",null,"Tags:")),React.createElement("div",{className:"col-md-9 valign-center clearfix"},React.createElement(selector.List,{items:tags.map(selector.createItem)})),React.createElement("br",null),React.createElement("div",{className:"col-md-3 valign-center"},React.createElement("b",null,"Description:")),React.createElement("div",{className:"col-md-9 valign-center clearfix"},solicitation.description),React.createElement("br",null),React.createElement("div",{className:"col-md-12",style:{marginTop:15}},React.createElement("div",{className:"progress"},React.createElement("div",{className:"progress-bar progress-bar-info progress-bar-striped active",role:"progressbar","aria-valuenow":"45","aria-valuemin":"0","aria-valuemax":"100",style:{width:"100%"}},"Finding Pros")),React.createElement("button",{className:"btn btn-default pull-right btn-sm",onClick:this.cancel_},"Cancel"))),React.createElement("hr",null),contractors);},render_bidded:function render_bidded(){var _this6=this;var contractors=this.solicitation.contractors.map(function(contractor){var button=React.createElement("button",{className:"btn btn-primary btn-sm",onClick:_this6.hire_.bind(_this6,contractor.id)},"Hire for $",contractor.rate,"/hr");return React.createElement(ContractorView,{button:button,contractor:contractor,key:contractor.id,me:_this6.props.me});});return this.render_created(contractors);},render_canceled:function render_canceled(){return React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-12"},React.createElement("p",{className:"alert alert-info"},"Your request has been cancelled."),React.createElement("button",{type:"button",className:"btn btn-primary pull-right btn-sm",onClick:this.reset_}," Ok ")));},render_hired:function render_hired(){var contractor=this.solicitation.contractor;var button=React.createElement("button",{className:"btn btn-primary btn-sm",disabled:true},"Hired for ",contractor.rate,"$/hr");return React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-12"},React.createElement("div",{className:"progress"},React.createElement("div",{className:"progress-bar progress-bar-info progress-bar-striped active",role:"progressbar","aria-valuenow":"45","aria-valuemin":"0","aria-valuemax":"100",style:{width:"100%"}},"Waiting for ",contractor.id," to join...")),React.createElement("button",{className:"btn btn-primary btn-sm pull-right",onClick:this.absolve_},"Cancel"),React.createElement("br",null),React.createElement("hr",null),React.createElement(ContractorView,{contractor:this.solicitation.contractor,button:button,me:this.props.me})));},render_joined:function render_joined(){var contractor=this.solicitation.contractor;var button=React.createElement("button",{className:"btn btn-primary btn-sm",disabled:true},"Hired for $",contractor.rate,"/hr");return React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-12"},this.solicitation.human_time(),React.createElement("button",{className:"btn btn-sm btn-primary pull-right",onClick:this.complete_},"Finish ",React.createElement("i",{className:"glyphicon glyphicon-remove"})),React.createElement("button",{className:"btn btn-sm pull-right",onClick:this.absolve_},"Cancel ",React.createElement("i",{className:"glyphicon glyphicon-remove"})),React.createElement("br",null),React.createElement("hr",null),React.createElement(ContractorView,{contractor:contractor,button:button,me:this.props.me})));},render_absolved:function render_absolved(){return React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-12"},React.createElement("p",{className:"alert alert-info"},"Your request has been canceled. You will not be charged."),React.createElement("button",{type:"button",className:"btn btn-primary pull-right btn-sm",onClick:this.reset_}," Ok ")));},render_completed:function render_completed(){return React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-12"},"Completed session with ",this.solicitation.contractor.id,"."),React.createElement("div",{className:"col-md-12"},"Time: ",this.solicitation.human_time()),React.createElement("div",{className:"col-md-12"},"Rate: $",this.solicitation.contractor.rate,"/hour"),React.createElement("div",{className:"col-md-12"},"Cost: $",this.solicitation.total_bill/100),React.createElement("div",{className:"col-md-12"},React.createElement("hr",null),React.createElement("fieldset",null,React.createElement("div",{className:"form-group",ref:"rating"},React.createElement("label",{className:"control-label",htmlFor:"id_rating"},"Rating"),React.createElement("br",null),React.createElement(StarView,{onRating:this.onRating_})),React.createElement("div",{className:"form-group"},React.createElement("label",{className:"control-label",htmlFor:"id_feedback"},"Review"),React.createElement("br",null),React.createElement("textarea",{className:"form-control",ref:"feedback",id:"id_feedback",name:"feedback",rows:"10",valueLink:this.linkState("feedback")})),React.createElement("div",{className:"form-group"},React.createElement("button",{type:"button",className:"btn btn-primary pull-right btn-sm",onClick:this.feedback_},"Send Feedback"),React.createElement("button",{type:"button",className:"btn btn-default pull-right btn-sm",onClick:this.close_},"Cancel")))));},render_feedbacked:function render_feedbacked(){return React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-12"},React.createElement("p",{className:"alert alert-success"},"Thank you!"),React.createElement("button",{type:"button",className:"btn btn-default pull-right btn-sm",onClick:this.close_}," Ok ")));}});module.exports=ClientView;},function(module,exports){"use strict";var StarView=React.createClass({propTypes:{onRating:React.PropTypes.func},getInitialState:function getInitialState(){return{rating:0};},onMouseOver:function onMouseOver(n){this.setState({rating:n});},onClick:function onClick(n){this.rating=n;this.props.onRating(this.rating);},onMouseLeave:function onMouseLeave(){if(!this.rating){this.setState({rating:0});return;}
this.onMouseOver(this.rating);},render:function render(){var stars=[];var star,style,i;for(i=1;i<=5;i++){style={fontSize:20};if(i<=this.state.rating){style.color="#FF9100";}else{style.color="#FFF";}
star=React.createElement("i",{className:"glyphicon glyphicon-star",style:style,key:i,onMouseOver:this.onMouseOver.bind(this,i),onClick:this.onClick.bind(this,i)});stars.push(star);}
return React.createElement("div",{onMouseLeave:this.onMouseLeave},stars);}});module.exports=StarView;},function(module,exports,__webpack_require__){"use strict";var PrivateChatView=__webpack_require__(48);var SHORT_WORD_LIMIT=60;var ContractorView=React.createClass({propTypes:{button:React.PropTypes.string,contractor:React.PropTypes.object,description:React.PropTypes.string,me:React.PropTypes.object},getInitialState:function getInitialState(){return{descriptionShort:true};},toggle:function toggle(){this.setState({descriptionShort:!this.state.descriptionShort});},render_is_short:function render_is_short(){return React.createElement("div",{className:"col-md-12"},this.props.description);},render_is_long:function render_is_long(){return React.createElement("div",{className:"col-md-12 clickable",onClick:this.toggle},this.state.descriptionShort?this.descriptionShort:this.props.contractor.description);},render:function render(){var contractor=this.props.contractor;var username=contractor.id;this.descriptionShort=contractor.description;var words=this.descriptionShort.split(" ");this.isShort=false;if(this.descriptionShort.length>SHORT_WORD_LIMIT){this.descriptionShort=words.slice(0,SHORT_WORD_LIMIT).join(" ")+"...";this.isShort=false;}
return React.createElement("div",{className:"pro-solicit-contractor"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-12 valign-center"},React.createElement("div",{className:"pro-solicit-contractor-container"},React.createElement("h4",null,React.createElement("a",{href:"/"+username,target:"_blank"},React.createElement("img",{src:contractor.gravatar+"?s=100",alt:"Gravatar",className:"gravatar"})),"")),React.createElement("div",{className:"pro-solicit-contractor-info"},React.createElement("h4",null,username,React.createElement("small",null,React.createElement("a",{href:"/"+username+"#floobits-user-info",target:"_blank"},"profile"),"",React.createElement("a",{href:"/"+username+"#floobits-user-feedback",target:"_blank"},"feedback & rating"),"",contractor.url?React.createElement("a",{href:contractor.url,target:"_blank"},"website"):""))),React.createElement("div",{className:"pro-solicit-hire-button"},this.props.button||""))),React.createElement("div",{className:"row"},this.isShort?this.render_is_short():this.render_is_long()),React.createElement(PrivateChatView,{username:contractor.id,me:this.props.me}));}});module.exports=ContractorView;},function(module,exports,__webpack_require__){"use strict";var Socket=__webpack_require__(21);var MessageAction=__webpack_require__(5);var util=__webpack_require__(9);var privateMessages=MessageAction.privateMessages;var PrivateChatView=React.createClass({propTypes:{me:React.PropTypes.object,username:React.PropTypes.string},componentDidMount:function componentDidMount(){var _this=this;privateMessages.on(function(){if(!_this.isMounted()){return;}
_this.forceUpdate();});},getChatMessages:function getChatMessages(){var self=this;var chatMessages=[];privateMessages.map(function(message,index){if(message.username!==self.props.username&&message.username!==self.props.me.username){return;}
var time=util.formatDate(new Date(message.time));var userColor=util.userColor(message.username);chatMessages.push(React.createElement("div",{className:"pro-private-chat-message",key:index},React.createElement("span",{className:"timestamp"},time.hour+":"+time.minute+time.meridian),React.createElement("span",{className:"user-color-square",style:{backgroundColor:userColor}}),React.createElement("span",{className:"username"},message.username,":")," ",React.createElement("span",{className:"message"},message.data.msg)));});return chatMessages;},handleChat:function handleChat(e){e.preventDefault();var input=this.refs.chatInput.getDOMNode();var data=input.value;if(!data.length){return;}
var username=this.props.me.username;var to=this.props.username;input.value="";var time=Date.now()/1000;Socket.send_("msg",{username:username,data:data,to:to,time:time,name:"msg"});MessageAction.private(username,data,time,username);},render:function render(){var chatMessages=this.getChatMessages();var classes=React.addons.classSet({"pro-private-chat-container":true,"private-contractor-chat":true,"private-contractor-chat-open":chatMessages.length});return React.createElement("div",{className:classes},React.createElement("form",{className:"",onSubmit:this.handleChat},React.createElement("input",{type:"text",ref:"chatInput",placeholder:"Chat with "+this.props.username})),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-12 pro-private-chat-messages"},chatMessages)));}});module.exports=PrivateChatView;},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var Socket=__webpack_require__(21);var ContractorView=__webpack_require__(47);var ProView=React.createClass({propTypes:{me:React.PropTypes.object,solicitation:React.PropTypes.object},getInitialState:function getInitialState(){return{gravatar:"",description:"",url:"",id:""};},componentWillMount:function componentWillMount(){var _this=this;var solicitation=this.props.solicitation;this.on_solicitation=solicitation.on(function(){if(solicitation.state!=="JOINED"){_this.keep_alive=clearInterval(_this.keep_alive);return;}
if(_this.keep_alive){return;}
_this.keep_alive=setInterval(function(){_this.send("keep_alive",{});},5*1000);});$.ajax({url:"/api/user/"+this.props.solicitation.client_account,headers:{"Authorization":"Basic "+btoa(fl.editor_settings.username+":"+fl.editor_settings.auth_secret)},success:function success(data){console.log(data);_this.setState({gravatar:data.gravatar,description:data.description,url:data.url,id:data.username});},error:function error(data){console.error("OMG",data);}});},componentWillUnmount:function componentWillUnmount(){this.keep_alive=clearInterval(this.keep_alive);this.props.solicitation.off(this.on_solicitation);},send:function send(action,data,f,binding){var msg={action:action,data:data};if(this.props.solicitation.id){msg.data.id=this.props.solicitation.id;}else{console.error("NO SOLICITATION WITH AN ID");return;}
Socket.send_solicit(msg,f,binding);},complete_:function complete_(){this.send("complete",{});},cancel_:function cancel_(){this.send("absolve",{});},render_absolved:function render_absolved(){return React.createElement("div",null,"You did not make any money.");},render_completed:function render_completed(){var s=this.props.solicitation;var dollars=(s.total_bill/100).toFixed(2);var cut=(dollars*s.cut/100).toFixed(2);return React.createElement("div",null,"You will be paid $",dollars-cut," ($",dollars," - $",cut,") for ",s.human_time()," * $",s.contractor.rate,"/hour.");},render:function render(){var f=this["render_"+this.props.solicitation.state.toLowerCase()];if(!_.isFunction(f)){return React.createElement("div",null);}
return React.createElement("div",null,React.createElement("h3",{style:{textAlign:"center"}},"Floobits Pro"),React.createElement("hr",null),f.call(this));},render_joined:function render_joined(){var client=this.state;var solicitation=this.props.solicitation;var tags=this.props.solicitation.tags.valueOf();return React.createElement("div",null,React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-3 valign-center"},React.createElement("b",null,"Problem:")),React.createElement("div",{className:"col-md-9 valign-center clearfix"},solicitation.description),React.createElement("div",{className:"col-md-3"},React.createElement("b",null,"Time:")),React.createElement("div",{className:"col-md-9 valign-center clearfix"},solicitation.human_time()),React.createElement("div",{className:"col-md-3 valign-center"},React.createElement("b",null,"Tags:")),React.createElement("div",{className:"col-md-9 valign-center clearfix"},tags||React.createElement("br",null)),React.createElement("div",{className:"col-md-12 valign-center pull-right"},React.createElement("button",{className:"btn btn-default btn-sm ",onClick:this.cancel_}," Cancel "),React.createElement("button",{className:"btn btn-primary btn-sm ",onClick:this.complete_}," Complete "))),React.createElement("hr",null),React.createElement(ContractorView,{contractor:client,me:this.props.me}));}});module.exports=ProView;},function(module,exports,__webpack_require__){"use strict";var id=0;var flux=__webpack_require__(7);var Item=flux.createModel({modelName:"PanelItem",fieldTypes:{id:flux.FieldTypes.string,size:flux.FieldTypes.number.defaults(NaN),headerClass:flux.FieldTypes.string.ephemeral(),component:flux.FieldTypes.object.ephemeral().required(),props:flux.FieldTypes.object.ephemeral().required(),defaultSize:flux.FieldTypes.number.ephemeral().defaults(NaN),minSize:flux.FieldTypes.number.ephemeral().defaults(0),maxSize:flux.FieldTypes.number.ephemeral().defaults(Infinity),grid:flux.FieldTypes.number.ephemeral().defaults(null)},gridify:function gridify(newSize){if(!this.grid){return newSize;}
return Math.round(newSize/this.grid)*this.grid;},fixInRange:function fixInRange(newSize){return Math.min(Math.max(this.gridify(newSize),this.minSize),this.maxSize);}});var Items=flux.createCollection({model:Item,modelName:"PanelItems"});var Panels=flux.createModel({backend:flux.backends.local,modelName:"Panels",fieldTypes:{items:Items,id:flux.FieldTypes.string.ephemeral(),draggable:flux.FieldTypes.bool.ephemeral().defaults(true)},getDefaultFields:function getDefaultFields(){return{items:new Items(),id:++id};}});module.exports={Item:Item,Items:Items,Panels:Panels};},function(module,exports,__webpack_require__){"use strict";var panel=__webpack_require__(50);var panelView=__webpack_require__(52);var EditorView=__webpack_require__(54);var editorAction=__webpack_require__(14);var EditorContainerView=React.createClass({propTypes:{bufs:React.PropTypes.object,editors:React.PropTypes.object},getInitialState:function getInitialState(){return{orientation:null,panels:null};},getSize:function getSize(){var node=$(this.getDOMNode().parentNode);return this.state.orientation==="horizontal"?node.width():node.height();},componentDidUpdate:function componentDidUpdate(){this.resize();},componentDidMount:function componentDidMount(){var _this=this;var getItems=function getItems(){return _this.props.editors.map(function(editor,id){return{size:_this.getSize()/_this.props.editors.length,minSize:10,headerClass:"sidebar-header sidebar-header-top",id:"Editor"+id,component:EditorView,props:{editor:editor,bufs:_this.props.bufs,key:id}};});};editorAction.onSPLIT_EDITOR(function(direction){if(!_this.state.orientation||_this.state.orientation===direction){_this.props.editors.createEditor();}
_this.setState({orientation:direction});_this.state.panels.items.set(getItems());});editorAction.onRENAME_PROMPT(function(){var activeEditor=_this.props.editors.find(function(editor){return editor.active;});if(activeEditor){editorAction.start_rename_prompt(activeEditor.activeTab);}});editorAction.onUNSPLIT_EDITOR(function(){var activeIndex;_this.props.editors.forEach(function(editor,index){if(editor.active){activeIndex=index;return false;}});_this.props.editors.splice(0,activeIndex);_this.props.editors.splice(1);_this.state.panels.items.set(getItems());});this.setState({panels:new panel.Panels({size:this.getSize()||1,items:getItems()})});},resize:function resize(){this.props.editors.forEach(function(editor){editor.ace.resize(true);});},render:function render(){if(!this.state.panels){return React.createElement("div",null);}
if(this.state.orientation==="horizontal"){return React.createElement(panelView.PanelViewHorizontal,{panels:this.state.panels});}
return React.createElement(panelView.PanelViewVertical,{panels:this.state.panels});}});module.exports=EditorContainerView;},function(module,exports,__webpack_require__){"use strict";function _defineEnumerableProperties(obj,descs){for(var key in descs){var desc=descs[key];desc.configurable=desc.enumerable=true;if("value"in desc)desc.writable=true;Object.defineProperty(obj,key,desc);}return obj;}
var _=__webpack_require__(2);var panelAction=__webpack_require__(53);var flux=__webpack_require__(7);var PanelItemView=React.createClass({propTypes:{axis:React.PropTypes.string,item:React.PropTypes.object},getInitialState:function getInitialState(){var item=this.props.item;var size=_.isFinite(item.size)?item.size:item.defaultSize;size=item.fixInRange(size,0,10000);return{flex:size};},size:function size(){var rect;if(!this.isMounted()){return 0;}
try{rect=this.getDOMNode().getBoundingClientRect();}catch(e){return this.props.item.size;}
return rect[this.props.axis];},componentWillMount:function componentWillMount(){var _size,_props$panel,_mutatorMap;var item=this.props.item,props=_.clone(item.props);var that=this;props.panel=(_props$panel={resize:function resize(size){var node=that.refs.panel.getDOMNode();var klass=node.getAttribute("class");node.setAttribute("class",klass+" panel-transition");setTimeout(function(){item.size=size;},0);setTimeout(function(){that.refs.panel.getDOMNode().setAttribute("class",klass);},400);},item:item,get size(){return that.size();}},_size="size",_mutatorMap={},_mutatorMap[_size]=_mutatorMap[_size]||{},_mutatorMap[_size].set=function(s){item.size=s;},_defineEnumerableProperties(_props$panel,_mutatorMap),_props$panel);this.component=React.createElement(item.component,props);},componentDidUpdate:function componentDidUpdate(){panelAction.resize();},componentDidMount:function componentDidMount(){var _this=this;var item=this.props.item;panelAction.resize();item.on(function(){if(item.size===_this.state.flex){return;}
_this.setState({flex:item.size});});},render:function render(){var klass,style;style={flexGrow:this.state.flex};if(this.props.item.grid){style.flexGrow=0;style.width=this.state.flex;style.flex="0 0 auto";}
style.WebkitFlexGrow=style.flexGrow;style.WebkitFlex=style.flex;klass="panel-item-body-"+this.props.axis;if(this.state.transitioning){klass+=" panel-transition";}
return React.createElement("div",{ref:"panel",className:klass,style:style},React.createElement("div",{className:"panel-item-body-child"},this.component));}});var DragHandleView=React.createClass({propTypes:{axis:React.PropTypes.string,dragStart:React.PropTypes.func},onMouseDown:function onMouseDown(event){this.props.dragStart(event);},render:function render(){return React.createElement("div",{onMouseDown:this.onMouseDown,className:"panel-drag-handle panel-drag-handle-"+this.props.axis});}});var PanelView={componentName:"PanelView",mixins:[flux.createAutoBinder(["panels"])],componentDidMount:function componentDidMount(){var rect=this.getDOMNode().getBoundingClientRect();var size=rect[this.axis];var empty=[];var items=this.props.panels.items;items.forEach(function(item){if(_.isFinite(item.size)){size-=item.size;return;}
if(_.isFinite(item.defaultSize)){size-=item.defaultSize;return;}
empty.push(item);});empty.forEach(function(item){item.size=size/empty.length;});},setFlexGrow:function setFlexGrow(prevSize,nextSize){var totalScale=prevSize+nextSize;var prevGrow=totalScale*prevSize/totalScale;var nextGrow=totalScale*nextSize/totalScale;prevSize=this.prevModel.fixInRange(prevGrow,0,10000);if(prevSize!==prevGrow){nextGrow+=prevGrow-prevSize;}
nextSize=this.nextModel.fixInRange(nextGrow,0,10000);if(nextSize!==nextGrow){prevSize+=nextGrow-nextSize;}
this.prevModel.size=prevSize;this.nextModel.size=nextSize;this.props.panels.save();},fixInRange:function fixInRange(val,minValue,maxValue){return Math.min(Math.max(val,minValue),maxValue);},dragStop:function dragStop(){document.removeEventListener("mousemove",this.handleDrag);document.removeEventListener("mouseup",this.dragStop);this.previousSibling=null;this.nextSibling=null;this.prevModel=null;this.nextModel=null;},dragStart:function dragStart(index,event){var items=this.props.panels.items;event.stopPropagation();event.preventDefault();this.previousSibling=this.refs["item"+(index-1)].getDOMNode();this.nextSibling=this.refs["item"+index].getDOMNode();this.prevModel=items.byIndex(index-1);this.nextModel=items.byIndex(index);document.addEventListener("mousemove",this.handleDrag);document.addEventListener("mouseup",this.dragStop);},handleDrag:function handleDrag(event){event.stopPropagation();event.preventDefault();this.handleDrag_(event,this.previousSibling,this.nextSibling);},render:function render(){var _this2=this;var nodes=[],panels=this.props.panels;if(panels){panels.items.forEach(function(item,index){if(index!==0){nodes.push(React.createElement(DragHandleView,{key:"drag-handle"+index,axis:_this2.axis,dragStart:_this2.dragStart.bind(_this2,index)}));}
nodes.push(React.createElement(PanelItemView,{ref:"item"+index,key:"item"+index,item:item,axis:_this2.axis}));});}
return React.createElement("div",{className:"panel-view",style:{flexDirection:this.flexDirection,WebkitFlexDirection:this.flexDirection}},nodes);}};var PanelViewHorizontal=React.createClass({mixins:[PanelView],axis:"width",flexDirection:"row",handleDrag_:function handleDrag_(event,previousSibling,nextSibling){var totalWidth=previousSibling.clientWidth+nextSibling.clientWidth;var leftWidth=event.clientX-previousSibling.getBoundingClientRect().left;leftWidth=this.fixInRange(leftWidth,0,totalWidth);this.setFlexGrow(leftWidth,totalWidth-leftWidth);}});var PanelViewVertical=React.createClass({mixins:[PanelView],axis:"height",flexDirection:"column",handleDrag_:function handleDrag_(event,previousSibling,nextSibling){var totalHeight=previousSibling.clientHeight+nextSibling.clientHeight;var topHeight=event.clientY-previousSibling.getBoundingClientRect().top;topHeight=this.fixInRange(topHeight,0,totalHeight);this.setFlexGrow(topHeight,totalHeight-topHeight);}});module.exports={PanelViewVertical:PanelViewVertical,PanelViewHorizontal:PanelViewHorizontal};},function(module,exports,__webpack_require__){"use strict";var flux=__webpack_require__(7);var Actions=flux.createActions({resize:function resize(){return;}});var actions=new Actions();window.addEventListener("resize",actions.resize);module.exports=actions;},function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
var _=__webpack_require__(2);var editorAction=__webpack_require__(14);var perms=__webpack_require__(22);var handlerAction=__webpack_require__(15);var EditSession=ace.require("ace/edit_session").EditSession;var util=__webpack_require__(9);var flux=__webpack_require__(7);var prefs=__webpack_require__(10);var panelAction=__webpack_require__(53);var editorModel=__webpack_require__(16);var DRAG_POSITION={RIGHT:0,LEFT:1};var TabDragPlacement=function TabDragPlacement(bufId,pos){_classCallCheck(this,TabDragPlacement);this.bufId=bufId;this.position=pos;};var EditorView=React.createClass({mixins:[flux.createAutoBinder(["editor.terminals"])],propTypes:{bufs:React.PropTypes.object,editor:React.PropTypes.object},draggedTabsBufId:null,currentTabDragPlacement:null,resize:function resize(){if(this.timeout){clearTimeout(this.timeout);}
this.timeout=setTimeout(function(){if(!this.isMounted()){return;}
this.props.editor.ace.resize(true);this.timeout=null;}.bind(this),100);},getInitialState:function getInitialState(){var _this=this;var tabs=[];this.props.editor.tabs.forEach(function(id){var name=void 0,path=void 0,type="buf",buf=_this.props.bufs.get(id);if(!buf){return;}
name=buf.path.split("/").pop();path=buf.path;tabs.push({path:path||name,fileName:name,active:true,id:id,type:type});});return{showEditor:true,showTerminal:false,tabs:tabs};},activateTab_:function activateTab_(type,id){var tab;this.state.tabs.forEach(function(t){t.active=false;});tab=_.find(this.state.tabs,function(t){return t.type===type&&t.id===id;});if(tab){tab.active=true;}
return tab;},openTab_:function openTab_(type,id,name,path){var tab=this.activateTab_(type,id);var tabs=[].concat(this.state.tabs);if(!tab){tabs.push({path:path||name,fileName:name,active:true,id:id,type:type});}
this.props.editor.set({activeTab:id},{silent:true});this.props.editor.tabs.set(_.map(tabs,"id"),{silent:true});this.setState({showEditor:type==="buf",showTerminal:type==="term",tabs:tabs});},closeTab_:function closeTab_(type,id){var index=-1,tab=void 0;var tabs=[].concat(this.state.tabs);tab=_.find(tabs,function(t,i){index=i;return t.id===id&&t.type===type;});if(!tab){return null;}
tabs.splice(index,1);this.props.editor.set({activeTab:tab.id},{silent:true});this.props.editor.tabs.set(_.map(tabs,"id"),{silent:true});this.setState({display:!!tabs.length,tabs:tabs},function(){if(!tab.active||!tabs.length){return editorAction.close_last();}
tab=tabs[index]||tabs[--index];if(tab.type==="term"){editorAction.open_term(tab.id);}else{editorAction.open(tab.id);}});},componentDidMount:function componentDidMount(){var _this2=this;panelAction.onRESIZE(this.resize);this.editorActionOnID=editorAction.on(function(event,bufOrTerm){if(!_this2.props.editor.active){return null;}
switch(event){case editorAction.OPEN_TERM:return _this2.openTab_("term",bufOrTerm.id,bufOrTerm.title);case editorAction.CLOSE_TERM:return _this2.closeTab_("term",bufOrTerm.id);case editorAction.OPEN:return _this2.openTab_("buf",bufOrTerm.id,bufOrTerm.path.split("/").pop(),bufOrTerm.path);case editorAction.CLOSE:if(_this2.props.editor.activeBuf===bufOrTerm.id){_this2.props.editor.activeBuf=null;}
return _this2.closeTab_("buf",bufOrTerm.id);default:break;}});this.editorActionOnRenameID=editorAction.onRENAME(function(buf){var tab=_.find(_this2.state.tabs,function(t){return t.id===buf.id;});if(!tab){return;}
tab.path=buf.path;tab.fileName=buf.path.split("/").pop();});if(this.state.tabs.length){this.props.editor.tabs.set(_.map(this.state.tabs,"id"),{silent:true});this.setState({showEditor:true,showTerminal:false});}},componentWillUnmount:function componentWillUnmount(){editorAction.off(this.editorActionOnID);editorAction.off(this.editorActionOnRenameID);},onDragEnd:function onDragEnd(){if(!this.currentTabDragPlacement){return;}
var droppedOnData=this.currentTabDragPlacement;this.clearDragOverState();var draggedTabsBufId=this.draggedTabsBufId;if(draggedTabsBufId===droppedOnData.bufId){console.log("User dropped dragged tab on itself, no order change.");return;}
this.draggedTabsBufId=null;var order=[];var tabs=[].concat(this.state.tabs);var beforeOrder=_.map(tabs,"id");tabs.forEach(function(tab){if(tab.id===draggedTabsBufId){return;}
if(tab.id===droppedOnData.bufId){if(droppedOnData.position===DRAG_POSITION.RIGHT){order.push(tab.id);order.push(draggedTabsBufId);}else{order.push(draggedTabsBufId);order.push(tab.id);}}else{order.push(tab.id);}}.bind(this));tabs.sort(function(bufA,bufB){for(var i=0;i<order.length;i++){if(bufA.id===order[i]){return-1;}
if(bufB.id===order[i]){return 1;}}
return 0;}.bind(this));var afterOrder=_.map(tabs,"id");console.log("New order",beforeOrder,afterOrder);if(_.eq(beforeOrder,afterOrder)){console.log("order did not change");return;}
this.props.editor.tabs.set(afterOrder);this.setState({tabs:tabs});},clearDragOverState:function clearDragOverState(){$(".drag-over").removeClass("drag-over");this.currentTabDragPlacement=null;},onDragOver:function onDragOver(bufId,event){this.clearDragOverState();var e=event.nativeEvent;var tabId=this.getTabId(bufId);var el=this.refs[tabId].getDOMNode();var $el=$(el);var dragPos=this.draggedTabsPosition({e:e,el:el});if(dragPos===DRAG_POSITION.RIGHT){$el.next().addClass("drag-over");}else{$el.prev().addClass("drag-over");}
this.currentTabDragPlacement=new TabDragPlacement(bufId,dragPos);e.preventDefault();},onDragStart:function onDragStart(bufId,event){this.draggedTabsBufId=bufId;var e=event.nativeEvent;e.dataTransfer.effectAllowed='move';e.dataTransfer.setData("buf-id",bufId);console.log("Tab dragging started",e.target,bufId);},getOffsetPos:function getOffsetPos(e,el){var target=e.target||e.srcElement;var elRect=el.getBoundingClientRect();var offsetX=elRect.left,offsetY=elRect.top;if(!target.getBoundingClientRect||$(target).hasClass("glyphicon")){return{offsetX:offsetX,offsetY:offsetY};}
var rect=target.getBoundingClientRect();offsetX=e.clientX-rect.left;offsetY=e.clientY-rect.top;return{offsetX:offsetX,offsetY:offsetY};},draggedTabsPosition:function draggedTabsPosition(_ref){var e=_ref.e;var el=_ref.el;var $el=$(el);var _getOffsetPos=this.getOffsetPos(e,el);var offsetX=_getOffsetPos.offsetX;var width=$el.width();if(offsetX>width/2){return DRAG_POSITION.RIGHT;}
return DRAG_POSITION.LEFT;},onClose:function onClose(bufId,tabType,event){event.preventDefault();event.stopPropagation();if(tabType==="term"){editorAction.close_term(bufId);}else{editorAction.close(bufId);}},onSelect:function onSelect(bufId,tabType,event){event.preventDefault();this.props.editor.ace.focus();if(tabType==="term"){editorAction.open_term(bufId);}else if(tabType==="buf"){editorAction.open(bufId);}},getTabId:function getTabId(bufId){return"editor-tab-"+bufId;},render:function render(){console.log("rendering with order",_.map(this.state.tabs,"id"));var editor=this.props.editor;var terms=editor.terminals.map(function(terminal){return React.createElement(TerminalView,{ref:"terminal"+editor.id,terminal:terminal,key:terminal.id});});var tabs=[React.createElement("li",{className:"tab-divider"},"")];this.state.tabs.forEach(function(tab){var tabId=this.getTabId(tab.id);tabs.push(React.createElement("li",{draggable:"true",className:"editor-tab"+(tab.active?" active":""),key:tabId,ref:tabId,onDragEnd:this.onDragEnd,onDragStart:this.onDragStart.bind(this,tab.id),onDragOver:this.onDragOver.bind(this,tab.id),onClick:this.onSelect.bind(this,tab.id,tab.type)},React.createElement("span",{className:"editor-tab-name-container",title:tab.path},React.createElement("span",{className:"editor-tab-name"},tab.fileName),React.createElement("span",{className:"glyphicon glyphicon-remove-circle editor-tab-close",onClick:this.onClose.bind(this,tab.id,tab.type)}))));tabs.push(React.createElement("li",{className:"tab-divider"},""));}.bind(this));return React.createElement("div",{className:"editor-container",style:{display:"block"}},React.createElement("div",{className:"editor-tabs"},React.createElement("ul",{className:"nav nav-tabs",style:{left:0}},tabs)),React.createElement("div",{style:{display:this.state.showTerminal?"block":"none"},className:"flootty"},terms),React.createElement("div",{style:{display:this.state.showEditor?"block":"none"}},React.createElement(AceEditorView,{ref:"ace"+editor.id,id:editor.id,editor:editor,bufs:this.props.bufs})));}});var TerminalView=React.createClass({propTypes:{terminal:React.PropTypes.object},getInitialState:function getInitialState(){return{display:"block"};},componentDidMount:function componentDidMount(){var _this3=this;this.getDOMNode().appendChild(this.props.terminal.div);this.onOpenTermId=editorAction.onOPEN_TERM(function(term){if(term.id===_this3.props.terminal.id){_this3.setState({display:"block"});return;}
if(_this3.state.display!=="none"){_this3.setState({display:"none"});}});},componentWillUnmount:function componentWillUnmount(){editorAction.off(this.onOpenTermId);},render:function render(){return React.createElement("div",{style:{display:this.state.display}});}});var AceEditorView=React.createClass({propTypes:{bufs:React.PropTypes.object,editor:React.PropTypes.object},aceEdit:null,isActive:function isActive(){return this.props.editor.active;},componentDidMount:function componentDidMount(){var _this4=this;var buf,es;this.highlights={};this.docs=this.props.editor.docs;this.editorSessions=this.props.editor.editorSessions;this.bufs=this.props.bufs;this.refs.editor.getDOMNode().appendChild(this.props.editor.elem);this.onPermsId=perms.on(function(){_this4.aceEdit.setReadOnly(perms.indexOf("patch")===-1);});this.aceEdit=this.props.editor.ace;this.aceEdit.renderer.setShowPrintMargin(false);this.aceEdit.getSession().setMode("ace/mode/text");this.aceEdit.setReadOnly(perms.indexOf("patch")===-1);this.themeName=prefs.theme;this.aceEdit.setTheme("ace/theme/"+prefs.theme);this.props.editor.tabs.forEach(function(id){buf=_this4.bufs.get(id);if(!buf){return;}
if(buf.id===_this4.props.editor.activeTab){return;}
_this4.openBuffer(buf);es=_this4.editorSessions[buf.id];es.setMode("ace/mode/"+util.modeForFile(buf.path));});buf=this.bufs.get(this.props.editor.activeTab);if(buf){this.openBuffer(buf);es=this.editorSessions[buf.id];es.setMode("ace/mode/"+util.modeForFile(buf.path));}
this.editorActionOnID=editorAction.on(function(event,arg0,arg1){var args=_.toArray(arguments).slice(1);if(event===editorAction.PREF&&arg1==="theme"){this.aceEdit.setTheme("ace/theme/"+arg0.theme);if(this.isActive()){$(document.body).removeClass("theme-"+this.themeName).addClass("theme-"+arg0.theme);}
this.themeName=arg0.theme;return;}
if(event===editorAction.IMAGIFY){this.imagify.apply(this,args);return;}
if(!this.isActive()){return;}
switch(event){case editorAction.OPEN:this.openBuffer.apply(this,args);break;case editorAction.CLOSE_LAST:if(!this.props.editor.activeBuf){this.aceEdit.setSession(new EditSession(""));this.aceEdit.setReadOnly(true);}
break;case editorAction.SUMMON:this.sendCurrentPosition();this.aceEdit.focus();break;default:break;}},this);this.configureEditor();editorAction.onTAB_SETTINGS_CHANGE(this.configureEditor);},configureEditor:function configureEditor(){console.log("configuring",this.editorSessions);if(_.isObject(this.editorSessions)){_.forEach(this.editorSessions,editorModel.configureEditSession);}},componentWillUnmount:function componentWillUnmount(){perms.off(this.onPermsId);editorAction.off(this.editorActionOnID);},sendCurrentPosition:function sendCurrentPosition(){var pos,doc,activeBuf=this.props.editor.activeBuf;if(!activeBuf){return;}
doc=this.docs[activeBuf];if(!doc){return;}
pos=doc.positionToIndex(this.aceEdit.getCursorPosition());handlerAction.send_highlight(activeBuf,[[pos,pos]],false,true);},render:function render(){return React.createElement("div",{ref:"editor"},React.createElement("img",{ref:"editor_image",className:"editor-image",style:{display:"none"}}));},imagify:function imagify(buf){var img;if(this.props.editor.activeBuf!==buf.id){return;}
img=this.refs.editor_image.getDOMNode();img.style.display="block";this.props.editor.elem.style.display="none";img.src=buf.img;},openBuffer:function openBuffer(buf,line){var es,doc,img,editorStyle;doc=this.docs[buf.id];if(!doc){console.error("no doc");}
es=this.editorSessions[buf.id];if(!es){console.error("no es");}
this.aceEdit.setSession(es);this.aceEdit.setReadOnly(perms.indexOf('patch')===-1);if(_.isFinite(line)){console.log("going to line",line);this.aceEdit.gotoLine(line);}
img=this.refs.editor_image.getDOMNode();editorStyle=this.props.editor.elem.style;editorStyle.display="block";img.style.display="none";if(buf.encoding==="base64"&&buf.img){img.style.display="block";editorStyle.display="none";if(this.props.editor.activeBuf!==buf.id&&buf.populated){img.src=buf.img;}}
this.props.editor.activeBuf=buf.id;if(document.activeElement&&_.includes("chat-input",document.activeElement.classList)){return;}
this.aceEdit.focus();}});module.exports=EditorView;},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var perms=__webpack_require__(22);var flux=__webpack_require__(7);var editorAction=__webpack_require__(14);var DelDirModalView=__webpack_require__(56);var TerminalModalView=__webpack_require__(57);var actions=new(flux.createActions({open:function open(path){return[path];},close:function close(path){return[path];}}))();var TermTreeUserView=React.createClass({propTypes:{openedTerm:React.PropTypes.number,terms:React.PropTypes.object,username:React.PropTypes.string},getInitialState:function getInitialState(){return{expanded:true};},render:function render(){var _this=this;var termTrees=_.map(this.props.terms,function(term){var highlighted=false;if(_this.props.openedTerm){highlighted=_this.props.openedTerm===term.id;}
return React.createElement("li",{id:"floobits-terminal-"+term.id,className:"buf-item tree-item "+(highlighted&&"highlighted"),key:term.id,onClick:function onClick(){editorAction.open_term(term.id);}},term.title,term.deleted&&React.createElement("span",{className:"item-delete glyphicon glyphicon-trash item-show",onClick:function onClick(){editorAction.close_term(term.id);}}));});return React.createElement("li",null,React.createElement("div",{className:"dir_name tree-item",onClick:function(){this.setState({expanded:!this.state.expanded});}.bind(this)},React.createElement("i",{className:"glyphicon glyphicon-"+(this.state.expanded?"chevron-down":"chevron-right")}),"",this.props.username),React.createElement("ol",{style:{display:this.state.expanded?"block":"none"}},termTrees));}});var TermTreeView=React.createClass({mixins:[flux.createAutoBinder(["terms"])],propTypes:{terms:React.PropTypes.object},getInitialState:function getInitialState(){return{openedTerm:null};},componentDidMount:function componentDidMount(){var _this2=this;editorAction.onOPEN(function(){_this2.setState({openedTerm:null});});editorAction.onOPEN_TERM(function(term){_this2.setState({openedTerm:term.id});});},onClick_:function onClick_(){if(this.props.terms.length===0){TerminalModalView.show();}},render:function render(){var _this3=this;var termUsers={},terms;this.props.terms.forEach(function(term){var username=term.username;termUsers[username]=termUsers[username]||[];termUsers[username].push(term);});terms=_.map(termUsers,function(t,username){return React.createElement(TermTreeUserView,{username:username,terms:t,key:username,openedTerm:_this3.state.openedTerm});});return React.createElement("ol",{id:"terms"},React.createElement("li",null,React.createElement("div",{className:"dir_name tree-item",onClick:this.onClick_},React.createElement("i",{className:"glyphicon glyphicon-console"})," ",this.props.terms.length," terminal",this.props.terms.length===1?"":"s"),React.createElement("ol",null,terms)));}});var FileView=React.createClass({componentName:"FileView",propTypes:{highlight:React.PropTypes.bool,id:React.PropTypes.number,name:React.PropTypes.string},openBuf:function openBuf(){editorAction.open(this.props.id);},deleteBuf:function deleteBuf(event){editorAction.close(this.props.id);editorAction.delete_buf(this.props.id);event.stopPropagation();event.preventDefault();},render:function render(){var canDelete=perms.indexOf("delete_buf")>=0;return React.createElement("li",{id:"floobits-buffer-"+this.props.id,ref:"bufitem",className:"buf-item tree-item"+(this.props.highlight?" highlighted":""),onClick:this.openBuf},React.createElement("span",{className:"buf_name"},"",this.props.name),React.createElement("span",{className:"buf-delete item-delete glyphicon glyphicon-trash"+(canDelete?" item-show":""),onClick:this.deleteBuf}));}});var FolderMixin={getPath:function getPath(){var prefix=[];if(this.props.getPath){prefix=this.props.getPath();}
return prefix.concat(this.props.name);},getViewablePath:function getViewablePath(){var pathParts;if(!this.props.getPath){return"/";}
pathParts=this.props.getPath();pathParts.shift();return pathParts.join("/")+"/"+this.props.name;},deleteDir_:function deleteDir_(event){var path;event.stopPropagation();event.preventDefault();path=this.getViewablePath();DelDirModalView.show(path,this.props.tree);},addBuff_:function addBuff_(event){var path;event.stopPropagation();event.preventDefault();path=this.getViewablePath();if(path[0]==="/"){path=path.substr(1);}
if(path.length){path=path+"/";}
editorAction.new_file_prompt(path);},render:function render(){var nodes=this.renderNodes(),canDelete=perms.indexOf("delete_buf")>=0,canEdit=perms.indexOf("patch")>=0;return React.createElement("li",null,React.createElement("div",{className:"dir_name tree-item",onClick:this.onClick_,style:{verticalAlign:"middle"}},React.createElement("i",{className:"glyphicon "+this.glyphicon}),"",this.props.name,React.createElement("i",{className:"item-add-buf glyphicon glyphicon-plus"+(canEdit?" item-show":""),onClick:this.addBuff_}),React.createElement("i",{className:"dir-delete item-delete glyphicon glyphicon-trash"+(canDelete?" item-show":""),onClick:this.deleteDir_})),nodes&&React.createElement("ol",null,nodes));}};var ClosedFolderView=React.createClass({glyphicon:"glyphicon-folder-close",mixins:[FolderMixin],renderNodes:function renderNodes(){},onClick_:function onClick_(){actions.open(this.getPath());}});var OpenFolderView=React.createClass({glyphicon:"glyphicon-folder-open",mixins:[FolderMixin],propTypes:{expandedTree:React.PropTypes.object,name:React.PropTypes.string,openBufID:React.PropTypes.number,tree:React.PropTypes.object},onClick_:function onClick_(){actions.close(this.getPath());},renderNodes:function renderNodes(){var _this4=this;var name=this.props.name,children=this.props.tree||{},nodes=[],fileNodes=[],expandedTree=this.props.expandedTree&&this.props.expandedTree[name];_.keys(children).sort().forEach(function(itemname){var bufIdOrFolder=children[itemname];if(_.isNumber(bufIdOrFolder)){return fileNodes.push(React.createElement(FileView,{name:itemname,id:bufIdOrFolder,highlight:_this4.props.openBufID===bufIdOrFolder,key:itemname}));}
if(!expandedTree||!expandedTree[itemname]){return nodes.push(React.createElement(ClosedFolderView,{name:itemname,getPath:_this4.getPath,tree:bufIdOrFolder,key:itemname}));}
return nodes.push(React.createElement(OpenFolderView,{tree:bufIdOrFolder,expandedTree:expandedTree,openBufID:_this4.props.openBufID,name:itemname,key:itemname,getPath:_this4.getPath}));});return nodes.concat(fileNodes);}});var FiletreeView=React.createClass({componentName:"FiletreeView",mixins:[flux.createAutoBinder(["tree"],[perms])],root:null,propTypes:{name:React.PropTypes.string,terminals:React.PropTypes.object,tree:React.PropTypes.object},getInitialState:function getInitialState(){var expandedTree={};expandedTree[this.props.name]=true;this.shouldScroll=true;return{openBufID:null,expandedTree:expandedTree};},expandPath_:function expandPath_(path_){var i,p,path={},currentPath_=path;for(i=0;i<path_.length-1;i++){p=path_[i];currentPath_[p]={};currentPath_=currentPath_[p];}
currentPath_[_.last(path_)]=true;return _.merge(this.state.expandedTree,path);},componentDidMount:function componentDidMount(){var _this5=this;editorAction.onOPEN(function(buf){var path=[_this5.props.name].concat(buf.path.split("/"));_this5.setState({openBufID:buf.id,expandedTree:_this5.expandPath_(path)},_this5.scroll.bind(_this5,"floobits-buffer-"+buf.id));});actions.onOPEN(function(path){_this5.setState({expandedTree:_this5.expandPath_(path)});});actions.onCLOSE(function(path){var i,p,tree=_this5.state.expandedTree,currentPath_=tree;for(i=0;i<path.length-1;i++){p=path[i];currentPath_=currentPath_[p];if(!currentPath_){return;}}
delete currentPath_[_.last(path)];_this5.setState({expandedTree:tree});});editorAction.onOPEN_TERM(function(term){_this5.setState({openBufID:null},_this5.scroll.bind(_this5,"floobits-terminal-"+term.id));});},scroll:function scroll(id){var bufferElement=document.getElementById(id);if(!bufferElement){return;}
if(_.isFunction(bufferElement.scrollIntoViewIfNeeded)){bufferElement.scrollIntoViewIfNeeded();}else{bufferElement.scrollIntoView();}},render:function render(){return React.createElement("div",null,React.createElement(TermTreeView,{terms:this.props.terminals}),React.createElement("ol",{id:"tree"},React.createElement(OpenFolderView,{name:this.props.name,tree:this.props.tree.tree,openBufID:this.state.openBufID,expandedTree:this.state.expandedTree})));}});module.exports=FiletreeView;},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var editorAction=__webpack_require__(14);var modal=__webpack_require__(12);var DeleteDirView=React.createClass({mixins:[modal.ReactModalMixin],propTypes:{path:React.PropTypes.string,tree:React.PropTypes.object},renderBody:function renderBody(){return React.createElement("p",{className:"alert-block alert-DeleteDir"},"Are you sure you want to delete "+this.props.path+" and all its contents?");},handleDelete:function handleDelete(){this.close();this.deleteBuffers_(this.props.tree);},deleteBuffers_:function deleteBuffers_(tree){var _this=this;_.each(tree,function(leaf){if(_.isNumber(leaf)){editorAction.close(leaf);editorAction.delete_buf(leaf);}else{_this.deleteBuffers_(leaf);}});},renderFooter:function renderFooter(){return React.createElement("div",null,React.createElement("button",{className:"btn btn-danger",onClick:this.handleDelete},"Delete Directory"),React.createElement("button",{className:"btn btn-default","data-dismiss":"modal"},"Cancel"));}});function show(path,tree){modal.showModal(DeleteDirView,{path:path,tree:tree,title:"Floobits DeleteDir"});}
module.exports={show:show};},function(module,exports,__webpack_require__){"use strict";var modal=__webpack_require__(12);var TerminalModalView=React.createClass({mixins:[modal.ReactModalMixin],renderBody:function renderBody(){var location=window.location,workspaceURL=location.protocol+"//"+location.hostname+"/"+fl.editor_settings.path;return React.createElement("div",null,React.createElement("p",{className:"alert alert-block alert-warning"},"This workspace has no terminals."),React.createElement("div",{className:"alert alert-block alert-info"},React.createElement("div",null,"You can use ",React.createElement("a",{href:"https://github.com/Floobits/flootty/",target:"_blank"},"Flootty")," to share and join terminals. Its very useful for collaborative debugging."),React.createElement("div",null,"If you have Flootty installed, you can create a terminal in this workspace by running:"),React.createElement("div",null,React.createElement("textarea",{type:"text",className:"code-input",disabled:"disabled",style:{"font-size":"14px"},value:"flootty --create --url=\""+workspaceURL+"\""}))));},renderFooter:function renderFooter(){return React.createElement("div",null,React.createElement("button",{className:"btn btn-default","data-dismiss":"modal"},"OK"));}});function show(){modal.showModal(TerminalModalView,{title:"Floobits Terminals"});}
module.exports={show:show};},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var PopoverMixin=__webpack_require__(59).PopoverMixin;var editorAction=__webpack_require__(14);var modal=__webpack_require__(12);var ModalMixin=modal.ReactModalMixin;var MenuItem=React.createClass({propTypes:{item:React.PropTypes.object,leave:React.PropTypes.func},itemClick:function itemClick(item,event){if(!item.enabled){return;}
if(item.action){item.action();if(!item.href){event.preventDefault();}}
this.props.leave();},render:function render(){var item=this.props.item;return React.createElement("li",{onClick:this.itemClick.bind(this,item),className:item.enabled?undefined:"disabled"},React.createElement("a",{href:item.href||"#",target:item.href?"_blank":undefined,tabIndex:"-1"},item.icon&&React.createElement("i",{className:"glyphicon glyphicon-"+item.icon}),item.name,item.selected&&React.createElement("i",{className:"glyphicon glyphicon-ok"})));}});var MenuView=React.createClass({mixins:[PopoverMixin],propTypes:{closeAllMenus:React.PropTypes.func,menu:React.PropTypes.object},getInitialState:function getInitialState(){return{showPopover:false};},handleMouseEnter_:function handleMouseEnter_(){this.props.closeAllMenus();this.handleMouseEnter();},render:function render(){var leave=this.leave;return React.createElement("div",{className:"menu-container",onMouseLeave:this.handleMouseLeave,onClick:this.handleClick},React.createElement("div",{className:"dropdown"},this.props.menu.name),React.createElement("ul",{className:"dropdown-menu",style:{display:this.state.showPopover?"block":"none"}},this.props.menu.items.map(function(item){return React.createElement(MenuItem,{key:item.name,item:item,leave:leave});})));}});var MenuBarView=React.createClass({propTypes:{menubar:React.PropTypes.object},closeAllMenus:function closeAllMenus(){_.each(this.refs,function(ref){return ref.leave&&ref.leave();});},render:function render(){var _this=this;this.menus=[];this.props.menubar.forEach(function(menu,id){_this.menus.push(React.createElement(MenuView,{menu:menu,key:menu.name,closeAllMenus:_this.closeAllMenus,ref:"menu"+id}));});return React.createElement("div",null,this.menus);}});var FileNameMixin={getInitialState:function getInitialState(){return{value:this.props.value||""};},onChange:function onChange(event){this.setState({value:event.target.value});},componentDidMount:function componentDidMount(){var len,node=this.refs.newFileName.getDOMNode();node.focus();if(node.setSelectionRange&&node.value){len=node.value.length*2;node.setSelectionRange(len,len);}else{node.value=node.value;}},renderBody:function renderBody(){return React.createElement("form",{onSubmit:this.onClick},React.createElement("label",{htmlFor:"newFileName"},"Path"),"",React.createElement("input",{ref:"newFileName",id:"newFileName",type:"text",value:this.state.value,onChange:this.onChange}));},renderFooter:function renderFooter(){return React.createElement("div",null,React.createElement("button",{className:"btn btn-success",onClick:this.onClick},this.okButtonText),React.createElement("button",{className:"btn btn-cancel","data-dismiss":"modal"},"Cancel"));}};var NewFileView=React.createClass({mixins:[ModalMixin,FileNameMixin],okButtonText:"Create",renderHeader:function renderHeader(){return"Create a New File";},onClick:function onClick(event){editorAction.new_file(this.state.value);this.close();event.preventDefault();}});var RenameFileView=React.createClass({mixins:[ModalMixin,FileNameMixin],okButtonText:"Rename",renderHeader:function renderHeader(){return"Rename File or Folder";},onClick:function onClick(event){editorAction.rename_request(this.state.value);this.close();event.preventDefault();}});editorAction.on(editorAction.NEW_FILE_PROMPT,function(pathPrefix){modal.showModal(NewFileView,{value:pathPrefix});});editorAction.on(editorAction.START_RENAME_PROMPT,function(oldPath){modal.showModal(RenameFileView,{value:oldPath});});module.exports={MenuView:MenuView,MenuBarView:MenuBarView,NewFileView:NewFileView};},function(module,exports){"use strict";var PopoverMixin;PopoverMixin={timeout:null,setState_:function setState_(state){if(!this.isMounted()){return;}
this.setState(state);},handleClick:function handleClick(event){console.log("clicking");if(this.state.showPopover){clearTimeout(this.timeout);this.setState_({showPopover:false});}else{this.handleMouseEnter(event);}},leave:function leave(){if(this.timeout){clearTimeout(this.timeout);this.timeout=null;}
this.setState_({showPopover:false});},handleMouseEnter:function handleMouseEnter(){this.setState_({showPopover:true});if(this.timeout){clearTimeout(this.timeout);this.timeout=null;}},handleMouseLeave:function handleMouseLeave(){var self=this;this.timeout=window.setTimeout(function(){self.leave();},300);}};module.exports={PopoverMixin:PopoverMixin};},function(module,exports,__webpack_require__){"use strict";var flux=__webpack_require__(7),editorAction=__webpack_require__(14),perms=__webpack_require__(22),prefs=__webpack_require__(10);var Menu,Item,Items,MenuBar,fields=flux.FieldTypes;Item=flux.createModel({fieldTypes:{id:fields.number,name:fields.string,icon:fields.string,action:fields.func,href:fields.string,perm:fields.string,pref:fields.string,theme:fields.string,selected:fields.bool.defaults(false),enabled:fields.bool.defaults(true)},init:function init(){var _this=this;if(this.theme){editorAction.onPREF(function(newPrefs){_this.selected=_this.theme===newPrefs.theme;});}
if(this.pref){prefs.on(function(){_this.selected=!!prefs[_this.pref];});}
if(this.perm){perms.on(function(){_this.enabled=perms.indexOf(_this.perm)!==-1;});}}});Items=flux.createCollection({model:Item,modelName:"Items"});Menu=flux.createModel({fieldTypes:{id:fields.number,items:Items,name:fields.string}});MenuBar=flux.createCollection({model:Menu,modelName:"MenuBar"});module.exports={Item:Item,Menu:Menu,MenuBar:MenuBar};},function(module,exports,__webpack_require__){"use strict";var editorActions=__webpack_require__(14);var BreadCrumbs=React.createClass({componentName:"BreadCrumbs",componentDidMount:function componentDidMount(){editorActions.onOPEN(function(data){this.setState({path:data.path});},this);},getInitialState:function getInitialState(){return{path:""};},render:function render(){return React.createElement("a",{href:"#buf-"+this.state.path},this.state.path);}});module.exports=BreadCrumbs;},function(module,exports,__webpack_require__){"use strict";var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"])_i["return"]();}finally{if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else{throw new TypeError("Invalid attempt to destructure non-iterable instance");}};}();var _=__webpack_require__(2);var appHistory=__webpack_require__(25);var editorAction=__webpack_require__(14);var ignoreNavigation=false;function initRoutes(owner,workspace){var re=new RegExp("/"+owner+"/"+workspace+"/file/(.+)");appHistory.addRoute(re,[function(path,data){ignoreNavigation=true;try{if(data){editorAction.open(data.state.bufId,data.state.line);}else{var _re$exec$1$split=re.exec(path)[1].split(":");var _re$exec$1$split2=_slicedToArray(_re$exec$1$split,2);var bufId=_re$exec$1$split2[0];var lineNum=_re$exec$1$split2[1];editorAction.open_from_path(bufId,+lineNum);}}finally{ignoreNavigation=false;}}]);editorAction.on(editorAction.OPEN,function(buf,line){if(ignoreNavigation){return;}
var p=void 0;if(line){p="/"+owner+"/"+workspace+"/file/"+buf.path+":"+line;}else{p="/"+owner+"/"+workspace+"/file/"+buf.path;}
appHistory.navigate(p,{bufId:buf.id,line:line});});editorAction.on(editorAction.CURSOR,function(buf,pos){if(ignoreNavigation){return;}
var line=pos.row+1;if(!_.isFinite(line)){console.log("Ignoring cursor change for",buf.path,"pos",pos);return;}
var p="/"+owner+"/"+workspace+"/file/"+buf.path+":"+line;appHistory.navigate(p,{bufId:buf.id,line:line},true);});}
module.exports={initRoutes:initRoutes};},function(module,exports){"use strict";var theme;theme={monokai:"Monokai",lowlight_customized:"Lowlight Customized",clouds:"Clouds"};module.exports={theme:theme};},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var editorAction=__webpack_require__(14);var Ignore=__webpack_require__(65);var messageAction=__webpack_require__(5);var modal=__webpack_require__(12);var util=__webpack_require__(9);var DEFAULT_BRANCH={git:"master",hg:"default",svn:"trunk"};var repoType="git";var repoURL="";var repoBranch="";function createBuf(fullpath,result,type){if(!fullpath){console.log("Tried to create a file with no name or path.");return;}
if(fullpath[fullpath.length-1]==="/"){console.log("Tried to create a directory.");return;}
editorAction.create_buf(fullpath,result,type);}
function readFile(file,opt_path){console.debug("Reading file",file);var d=new $.Deferred();var path=opt_path?opt_path:"";var fullpath=path+file.name;var reader=new FileReader();var text_reader=new FileReader();reader.onerror=function(e){messageAction.log("Failed to read "+fullpath+": "+(e&&e.toString()));d.reject();};text_reader.onerror=reader.onerror;reader.onload=function(e){var result=new Uint8Array(e.target.result);if(!util.is_binary(result,result.length)){console.log("tree file",fullpath,"is not binary");text_reader.readAsText(file);return;}
d.resolve(fullpath,StringView.bytesToBase64(result),"base64");};text_reader.onload=function(e){console.log("tree resolved text reader");d.resolve(fullpath,e.target.result,"utf8");};reader.readAsArrayBuffer(file);return d.promise();}
function uploadTree(filetree,opt_ignores,opt_switchToBuf){var ignores,switchToBuf,totalSize;ignores=opt_ignores;if(!ignores){ignores=[];_.each(filetree.contents,function(item){if(item.isDir){ignores.push(Ignore.buildIgnores(item));}});}
switchToBuf=_.isUndefined(opt_switchToBuf)?true:opt_switchToBuf;totalSize=_.reduce(ignores,function(sum,ignore){return ignore.size+sum;},0);if(totalSize>Ignore.TOTAL_MAXSIZE){messageAction.log("This project is too big too upload, try and ignore big binary files with a .flooignore. size:",totalSize,"max:",Ignore.TOTAL_MAXSIZE);}
_.each(filetree.contents,function(item){var ignored=!!_.find(ignores,function(ignore){return ignore.isIgnored(item);});if(ignored){console.log("stuff was ignored");messageAction.log(item.fullpath+" was ignored.");return;}
if(item.isDir){switchToBuf=uploadTree(item,ignores,switchToBuf);}
createBuf(item.fullpath,item.buf,item.type,switchToBuf);switchToBuf=false;});return switchToBuf;}
var AddFilesView=React.createClass({mixins:[modal.ReactModalMixin],propTypes:{repoBranch:React.PropTypes.string,repoType:React.PropTypes.string,repoURL:React.PropTypes.string},handlePullRepo_:function handlePullRepo_(event){event.preventDefault();if(this.refs.gitType.getDOMNode().checked){repoType="git";}else if(this.refs.hgType.getDOMNode().checked){repoType="hg";}else if(this.refs.svnType.getDOMNode().checked){repoType="svn";}
repoURL=this.refs.repoURL.getDOMNode().value;repoBranch=this.refs.repoBranch.getDOMNode().value;console.log("Pulling repo:",repoType,repoURL,repoBranch);if(repoType&&repoURL){editorAction.pull_repo(repoType,repoURL,repoBranch);}
this.close();},updateDefaultBranch:function updateDefaultBranch(){var repoType=void 0;if(this.refs.gitType.getDOMNode().checked){repoType="git";}else if(this.refs.hgType.getDOMNode().checked){repoType="hg";}else if(this.refs.svnType.getDOMNode().checked){repoType="svn";}
this.setState({defaultBranch:DEFAULT_BRANCH[repoType]});},handleDrop_:function handleDrop_(event){var _this=this;var length,i,entry,promises,filetree;event.preventDefault();event.stopPropagation();this.setState({over:false});event=event.nativeEvent;console.debug("Dropped stuff.",event);if(event.dataTransfer.mozItemCount){this.handleMozDrop_(event);return;}
try{length=event.dataTransfer.items.length;}catch(unused){length=0;}
promises=[];filetree={isDir:true,contents:{}};for(i=0;i<length;i++){entry=event.dataTransfer.items[i].webkitGetAsEntry();if(!entry){console.error("handleDrop_: No entry for item",i);continue;}
promises.push(this._traverseFileTree(entry,filetree.contents));}
$.when.apply(this,promises).then(function(){console.log("Finished tree traversal.",filetree);uploadTree(filetree);_this.close();});},handleMozDrop_:function handleMozDrop_(event){console.debug("Handling moz drop.");var files=event.dataTransfer.files;if(!files){this.close();return;}
var hasNoBytes=false;var overSize=false;_.each(files,function(file){if(file.size<1){hasNoBytes=true;return;}
if(file.size>Ignore.MAX_FILESIZE){overSize=true;return;}
readFile(file,"").then(function(fullpath,result,type){console.log("Creating file from mozilla.");createBuf(fullpath,result,type);});});this.close();if(hasNoBytes){messageAction.log("Not everything was uploaded, as one or more items had 0 bytes.");}else if(overSize){messageAction.warn("At least one file was too big and could not be uploaded.");}},_traverseFileTree:function _traverseFileTree(item,filetree,opt_path){var p;console.log("buffer result traverse file tree.");p=new $.Deferred();if(item.isFile){this._loadFileIntoTree(item,filetree,p,opt_path);}else if(item.isDirectory){this._loadDirectoryIntoTree(item,filetree,p,opt_path);}
return p.promise();},_loadFileIntoTree:function _loadFileIntoTree(item,filetree,p,opt_path){console.log("tree entry Is file",item.name);item.file(_.bind(function(file){console.log("tree calling tree read file");if(file.size>Ignore.MAX_FILESIZE){console.log("tree ignored too big file",item.name);p.reject();return;}
console.log("readfile start",item.name);readFile(file,opt_path).then(_.bind(function(fullpath,result,type){filetree[item.name]={isDir:false,fullpath:fullpath,buf:result,type:type,name:item.name,file:file};console.log("tree file resolved",item.name);p.resolve();},this)).fail(_.bind(function(){console.log("tree ignored file.",item.name,opt_path);p.resolve();},this));},this));},_loadDirectoryIntoTree:function _loadDirectoryIntoTree(item,filetree,p,opt_path){var directoryReader,fullpath,promises;console.log("readfile tree _loadDirectoryIntoTree",item.name);if(item.name&&item.name.length&&item.name[0]==="."){p.resolve();return;}
fullpath="";if(_.isUndefined(opt_path)){fullpath="";}else{fullpath=opt_path+item.name+"/";}
promises=[];directoryReader=item.createReader();directoryReader.readEntries(_.bind(function(entries){var entry,i,subtree;if(_.isEmpty(entries)){console.log("tree dir is empty what",item.name);p.resolve();return;}
subtree={};filetree[item.name]={isDir:true,name:item.name,fullpath:fullpath,contents:subtree};for(i=0;i<entries.length;i++){entry=entries[i];promises.push(this._traverseFileTree(entry,subtree,fullpath));}
$.when.apply(this,promises).always(_.bind(function(){console.log("calling done from dir tree read what!",item.name);p.resolve();},this));},this));},handleDragEnter_:function handleDragEnter_(event){event.preventDefault();console.debug("handle drag enter");this.setState({over:true});},handleDragLeave_:function handleDragLeave_(event){event.preventDefault();console.debug("handle drag leave");this.setState({over:false});},handleDragOver_:function handleDragOver_(event){event.preventDefault();},getInitialState:function getInitialState(){return{defaultBranch:DEFAULT_BRANCH[repoType],over:false};},renderHeader:function renderHeader(){return React.createElement("div",null,"Add Files");},renderBody:function renderBody(){console.log("addfiles repoURL?",this.props.repoURL);return React.createElement("div",{id:"add-content-wizard",className:"workspace-wizard"},React.createElement("div",{className:"wizard-section-no-border"},React.createElement("div",{id:"drag-directory-box",className:this.state.over,onDrop:this.handleDrop_,onDragDrop:this.handleDrop_,onDragEnter:this.handleDragEnter_,onDragLeave:this.handleDragLeave_,onDragOver:this.handleDragOver_},React.createElement("span",null,"Drag files or a directory (Chrome only) into this box."))),React.createElement("h5",{style:{margin:"15px 0",padding:"15px 0"}},React.createElement("i",null,"or")),React.createElement("div",{id:"pull-in-content",className:"wizard-section-no-border"},React.createElement("form",{onSubmit:this.handlePullRepo_},React.createElement("div",{className:"form-group"},React.createElement("label",null,"Clone Repository"),React.createElement("div",{onClick:this.updateDefaultBranch},React.createElement("label",null,React.createElement("input",{ref:"gitType",type:"radio",name:"repo_type",value:"git",defaultChecked:this.props.repoType==="git"})," git"),React.createElement("label",null,React.createElement("input",{ref:"hgType",type:"radio",name:"repo_type",value:"hg",defaultChecked:this.props.repoType==="hg"})," hg"),React.createElement("label",null,React.createElement("input",{ref:"svnType",type:"radio",name:"repo_type",value:"svn",defaultChecked:this.props.repoType==="svn"})," svn")),React.createElement("br",null),React.createElement("label",{forName:"repoURL"},"Repo URL"),React.createElement("input",{id:"repoURL",ref:"repoURL",placeholder:"Repo URL",type:"text",size:"",className:"form-control",defaultValue:this.props.repoURL}),React.createElement("br",null),React.createElement("label",{forName:"repoBranch"},"Branch name"),React.createElement("input",{id:"repoBranch",ref:"repoBranch",placeholder:this.state.defaultBranch,type:"text",size:"",className:"form-control",defaultValue:this.props.repoBranch}),React.createElement("br",null),React.createElement("button",{type:"submit",className:"btn btn-primary"},"Clone"),React.createElement("br",null),React.createElement("small",null,"If pulling over ",React.createElement("b",null,"ssh"),", you must authorize ",React.createElement("a",{href:"/static/pubkeys/floobot.pub.txt",target:"_blank"},"our public key"),".")))));},renderFooter:function renderFooter(){return React.createElement("div",null,React.createElement("button",{className:"btn btn-default","data-dismiss":"modal"},"Close"));}});function show(){modal.showModal(AddFilesView,{repoURL:repoURL,repoType:repoType,repoBranch:repoBranch});}
function init(repoInfo){console.debug("addfiles init",repoInfo);editorAction.on(editorAction.UPLOAD,show);if(repoInfo.hasOwnProperty("type")){repoType=repoInfo.type;}
if(repoInfo.hasOwnProperty("url")){repoURL=repoInfo.url;}
if(repoInfo.hasOwnProperty("branch")){repoBranch=repoInfo.branch;}}
module.exports={init:init,show:show};},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var MAX_FILESIZE=10000000;var MAX_DIRSIZE=MAX_FILESIZE*10;var IGNORE_FILES=[".gitignore",".hgignore",".flignore",".flooignore"];var HIDDEN_WHITELIST=IGNORE_FILES.concat(".floo");function Ignore(filetree,_path){console.log("Creating ignore",arguments);this.ignores={"/TOO_BIG/":[]};this.children={};this.filetree=filetree;this.path=_path;this.size=0;console.log("Initializing ignores for ",_path);_.each(IGNORE_FILES,_.bind(this.load,this));}
Ignore.prototype.recurse=function(){var _this=this;_.each(this.filetree.contents,function(item){var ignore;if(item.isDir){ignore=new Ignore(item,_this.path+item.name);ignore.recurse();_this.size+=ignore.size;_this.children[item.name]=ignore;return;}
console.log("ignore file",item,item.file,_this.filetree);_this.size+=item.file.size;if(item.file.size>MAX_FILESIZE){_this.ignores["/TOO_BIG/"].push(item.fullpath);}});if(this.size>MAX_DIRSIZE){this.ignores["/TOO_BIG/"].push(this.path);}};Ignore.prototype.load=function(ignoreFilename){var _this2=this;var ignores,ignoreFile;ignoreFile=this.filetree.contents[ignoreFilename];if(!ignoreFile){return;}
ignores=ignoreFile.buf.split("\n");this.ignores[ignoreFile.name]=[];_.each(ignores,function(ignore){ignore=ignore.trim();if(ignore.length===0||ignore[0]==="#"){return;}
console.log("Adding %s to ignore patterns",ignore);_this2.ignores[ignoreFile.name].push(ignore);});};Ignore.prototype.isIgnored=function(treeitem){var parts,path,i,j,keys,ignoreFile,patterns,basePath,filename,pattern,newPath,ignore,visited;keys=_.keys(this.ignores);path=treeitem.fullpath;parts=path.split("/");parts.pop();basePath=parts.join("/");filename=treeitem.name;if(filename[0]==="."){console.log("Ignore hidden file or directory.");return true;}
console.log("ignore keys checked",keys,this.ignores);for(i=0;i<keys.length;i++){ignoreFile=keys[i];patterns=this.ignores[ignoreFile];console.log("ignore patterns",patterns,ignoreFile);for(j=0;j<patterns.length;j++){pattern=patterns[j];console.log("ignore checking",filename,"against",pattern);if(pattern.length&&_.last(pattern)==="/"&&treeitem.isDir){pattern=pattern.substr(0,pattern.length-1);}
if(pattern.length&&pattern[0]==="/"){if(basePath===this.path&&minimatch(filename,pattern.slice(1))){console.log("Ignored item on /",filename,pattern);return true;}}else if(minimatch(filename,pattern)||minimatch(path,pattern)){console.log("Ignored item",filename,pattern);return true;}}}
parts=path.split("/");visited=this.path.split("/");while(true){if(_.isEmpty(parts)){return false;}
newPath=parts.shift();if(visited.shift()===newPath){continue;}
break;}
if(_.isEmpty(newPath)){return false;}
ignore=this.children[newPath];if(ignore){return ignore.isIgnored(treeitem);}
return false;};function buildIgnores(filetree){var ignore;ignore=new Ignore(filetree,"");ignore.recurse();return ignore;}
module.exports={buildIgnores:buildIgnores,HIDDEN_WHITELIST:HIDDEN_WHITELIST,MAX_FILESIZE:MAX_FILESIZE,MAX_DIRSIZE:MAX_DIRSIZE,TOTAL_MAXSIZE:0,Ignore:Ignore};},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var modal=__webpack_require__(12);var editorAction=__webpack_require__(14);var EditorSettingsView=React.createClass({mixins:[modal.ReactModalMixin],getInitialState:function getInitialState(){return{softTabs:_.isNull(localStorage.getItem("softTabs"))?true:localStorage.getItem("softTabs")==="true",tabSize:parseInt(localStorage.getItem("tabSize"),10)||2};},handleSoftTabs:function handleSoftTabs(){localStorage.setItem("softTabs",""+this.refs.softTabs.getDOMNode().checked);editorAction.tab_settings_change();},handleTabSize:function handleTabSize(){localStorage.setItem("tabSize",this.refs.tabSize.getDOMNode().value);editorAction.tab_settings_change();},renderHeader:function renderHeader(){return React.createElement("strong",null,"Editor Settings");},renderBody:function renderBody(){console.log("rendering",this.state.softTabs);return React.createElement("div",{id:"add-content-wizard",className:"workspace-wizard"},React.createElement("div",{className:"editor-settings-container"},React.createElement("div",{className:"row"},React.createElement("label",null,React.createElement("span",{className:"col-md-6 settings-label"},"Soft Tabs"),React.createElement("span",{className:"col-md-6"},React.createElement("input",{ref:"softTabs",type:"checkbox",name:"soft_tabs",defaultChecked:this.state.softTabs,onChange:this.handleSoftTabs})))),React.createElement("div",{className:"row"},React.createElement("label",null,React.createElement("span",{className:"col-md-6 settings-label"},"Tab Size"),React.createElement("span",{className:"col-md-6"},React.createElement("input",{ref:"tabSize",type:"text",name:"tab_size",defaultValue:this.state.tabSize,onChange:this.handleTabSize}))))));},renderFooter:function renderFooter(){return React.createElement("div",null,React.createElement("button",{className:"btn btn-default","data-dismiss":"modal"},"Close"));}});function show(){modal.showModal(EditorSettingsView,{});}
function init(){editorAction.on(editorAction.EDITOR_SETTINGS,show);}
module.exports={show:show,init:init};},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);var handlerAction=__webpack_require__(15);var flio=__webpack_require__(4);var types=["admin_room","edit_room","request_perms","view_room"];var modal=__webpack_require__(12);var owner=void 0;var workspace=void 0;var EditPermissionsView=React.createClass({mixins:[modal.ReactModalMixin],permissions:null,getInitialState:function getInitialState(){return{secret:null,usernames:[],perms:[],selectedIndex:-1,newUser:null,anonUser:null};},componentWillMount:function componentWillMount(){this.loadData();},loadData:function loadData(){$.get(flio.apiURL("room",owner,workspace),function(data){var anonUser,perms=[];if(!this.isMounted()){return;}
_.map(data.perms,function(permissions,username){var user={id:username,permissions:permissions};if(username==="AnonymousUser"){anonUser=user;}else{perms.push(user);}});if(this.refs.editAutocomplete){this.refs.editAutocomplete.getDOMNode().value="";this.refs.new_admin_room.getDOMNode().checked=false;this.refs.new_edit_room.getDOMNode().checked=false;this.refs.new_request_perms.getDOMNode().checked=false;this.refs.new_view_room.getDOMNode().checked=false;}
this.setState({selectedIndex:-1,usernames:[],newUser:null,secret:data.secret,perms:perms,anonUser:anonUser});}.bind(this));},componentDidUpdate:function componentDidUpdate(){var selected,el;selected=this.refs.selected;if(selected){el=selected.getDOMNode();if(_.isFunction(el.scrollIntoViewIfNeeded)){el.scrollIntoViewIfNeeded();}else{el.scrollIntoView();}}},save:function save(){var _this=this,_arguments=arguments;var data={perms:{},secret:this.refs.isSecret.getDOMNode().checked,name:workspace,owner:owner};this.state.perms.forEach(function(user,index){data.perms[user.id]=types.filter(function(type){return _this.refs[""+index+type].getDOMNode().checked;});});if(this.state.newUser){data.perms[this.state.newUser.user]=types.filter(function(type){return _this.refs["new_"+type].getDOMNode().checked;});}
data.perms.AnonymousUser=types.filter(function(type){if(type==="admin_room"){return false;}
return _this.refs["anon_"+type].getDOMNode().checked;});$.ajax({type:"put",url:"/api/workspace/"+data.owner+"/"+data.name,contentType:"application/json",data:JSON.stringify(data),success:function success(){console.log("success saving permission data",_arguments);_this.loadData();_this.close();},error:function error(){console.log("error saving permission data");}});},addSelectedUserFromLi_:function addSelectedUserFromLi_(index){this.addSelectedUser_(index);},addSelectedUser:function addSelectedUser(){if(this.state.selectedIndex<0){this.setState({usernames:[]});return;}
this.addSelectedUser_(this.state.selectedIndex);},addSelectedUser_:function addSelectedUser_(index){var newUser;newUser=this.state.usernames[index];if(!newUser){this.setState({newUser:null,usernames:[],selectedIndex:-1});return;}
this.refs.editAutocomplete.getDOMNode().value=newUser.user;this.setState({newUser:newUser,usernames:[],selectedIndex:-1});this.refs.new_admin_room.getDOMNode().focus();},preAutoComplete_:function preAutoComplete_(event){var tab;tab=9;if(event.keyCode===tab&&!event.shiftKey){event.preventDefault();return;}},autoComplete_:function autoComplete_(event){var keyCode,down,up,tab,enter,selectedIndex;up=38;down=40;tab=9;enter=13;keyCode=event.keyCode;switch(keyCode){case down:selectedIndex=this.state.selectedIndex+1;if(selectedIndex>=this.state.usernames.length){selectedIndex=0;}
this.setState({selectedIndex:selectedIndex});break;case up:selectedIndex=this.state.selectedIndex-1;if(selectedIndex<0){selectedIndex=this.state.usernames.length-1;}
this.setState({selectedIndex:selectedIndex});break;case enter:case tab:this.addSelectedUser();break;default:this.fetchAutoComplete_();break;}},fetchAutoComplete_:function fetchAutoComplete_(){var value,input=this.refs.editAutocomplete.getDOMNode();value=input.value||"";value=value.trim();if(!value){this.setState({newUser:null,usernames:[],selectedIndex:-1});input.value="";return;}
$.get("/autocomplete/json_username/"+value,function(users){if(!(users&&users.length&&this.isMounted())){return;}
this.setState({"usernames":users,selectedIndex:0});}.bind(this)).error(function(){if(!this.isMounted()){return;}
this.setState({"usernames":[],selectedIndex:-1});}.bind(this));},handlePermissionChange_:function handlePermissionChange_(type,index){var _this2=this;var checked,refKey,permIndex=types.indexOf(type);refKey=""+index+type;checked=this.refs[refKey].getDOMNode().checked;types.forEach(function(t,i){if(index==="anon_"&&t==="admin_room"){return;}
refKey=""+index+t;if(checked&&i>permIndex){_this2.refs[refKey].getDOMNode().checked=true;}else if(!checked&&i<permIndex){_this2.refs[refKey].getDOMNode().checked=false;}});},getInput:function getInput(index,user,type){var labels={"admin_room":"Admin","edit_room":"Edit","request_perms":"Request permissions","view_room":"View"};return React.createElement("td",{key:index+type},React.createElement("label",null,labels[type]," ",React.createElement("input",{type:"checkbox",className:"perm-cb",onChange:this.handlePermissionChange_.bind(this,type,index),defaultChecked:user&&user.permissions.indexOf(type)!==-1,ref:index+type})));},renderBody:function renderBody(){var _this3=this;var users,anonUser,usernames,newInputs,anonInputs;if(this.state.secret===null){return React.createElement("p",null,"Loading");}
anonUser=this.state.anonUser;users=this.state.perms.map(function(user,index){var inputs=types.map(function(type){return _this3.getInput(index,user,type);});return React.createElement("tr",{key:user.id},React.createElement("td",{className:"user-with-perms"},user.id),inputs);});usernames=this.state.usernames.map(function(user,index){return React.createElement("li",{key:user.user+index,onClick:_this3.addSelectedUserFromLi_.bind(_this3,index),ref:_this3.state.selectedIndex===index?"selected":"notSelected"+index,className:_this3.state.selectedIndex===index?"selected":""},React.createElement("img",{style:{height:30,width:30},src:"https://secure.gravatar.com/avatar/"+user.email_hash}),React.createElement("span",{className:"username"},user.user));});newInputs=types.map(this.getInput.bind(this,"new_",null));anonInputs=types.filter(function(type){return type!=="admin_room";}).map(this.getInput.bind(this,"anon_",anonUser));return React.createElement("div",{id:"edit-perms-content-wizard",className:"workspace-wizard"},React.createElement("p",{className:"wizard-section no-content"},React.createElement("strong",null,"Edit Permissions for this Workspace")),React.createElement("div",{id:"secret-content",className:"wizard-section"},React.createElement("label",null,"This workspace is secret ",React.createElement("input",{type:"checkbox",id:"secret-workspace",ref:"isSecret",defaultChecked:this.state.secret})),React.createElement("br",null),React.createElement("small",null,"Secret workspaces are unlisted. They count towards private workspaces.")),anonUser&&React.createElement("div",{id:"all-perms-content",className:"wizard-section"},"Everyone can:",React.createElement("div",{className:"everyone-can"},React.createElement("table",null,React.createElement("tr",null,anonInputs)))),React.createElement("div",{id:"user-perms-content",className:"wizard-section"},React.createElement("table",null,React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"User"),React.createElement("th",{colSpan:"4"},"Permissions"))),React.createElement("tbody",null,users,React.createElement("tr",null,React.createElement("td",null,React.createElement("input",{type:"text",ref:"editAutocomplete",className:"edit-autocomplete autocomplete",onKeyDown:this.preAutoComplete_,onKeyUp:this.autoComplete_}),React.createElement("div",{className:"autocomplete-content",style:{display:usernames.length?"block":"none"}},React.createElement("div",{ref:"autoCompleteResults",className:"edit-perms-autocomplete-results"},React.createElement("ul",{className:"autocomplete_results"},usernames)))),newInputs)))),fl.editor_settings.is_org&&React.createElement("div",null,React.createElement("div",null,React.createElement("a",{href:"/"+owner+"/members"},"Add a member to your organization.")),React.createElement("div",null,React.createElement("a",{href:"/"+owner+"/invite"},"Invite users to your organization."))));},renderFooter:function renderFooter(){return React.createElement("div",null,React.createElement("button",{className:"btn btn-default btn-danger",onClick:this.save},"Save"),React.createElement("button",{className:"btn btn-default","data-dismiss":"modal"},"Close"));}});function show(){modal.showModal(EditPermissionsView);}
function init(owner_,workspace_){owner=owner_;workspace=workspace_;handlerAction.on(handlerAction.EDIT_PERMISSIONS,show);}
module.exports={init:init};},function(module,exports,__webpack_require__){"use strict";var flux=__webpack_require__(7);var Actions=flux.createActions({message:function message(msg){return msg;},send:function send(m){return m;}});module.exports=new Actions();}]);